# CardBattleGame

3Dボード上でクリーチャーを召喚し、スペルやアイテムを駆使して領地を奪い合うカードバトルゲームです。
カルドセプトシリーズに着想を得て、Godot 4.5 + GDScript で開発しています。

<!-- スクリーンショットを追加予定
![ゲーム画面](screenshots/gameplay.png)
-->

## ゲーム概要

ボードゲーム × カードゲーム × 戦略RPG を組み合わせたターン制ゲームです。

プレイヤーはダイスを振ってボード上を移動し、手札のクリーチャーカードをマスに召喚します。
相手のクリーチャーが置かれたマスに止まると戦闘が発生し、敗北すると通行料を支払います。
スペルカードで戦況を操り、領地を広げて勝利条件を目指します。

### ターンの流れ

```
スペルフェーズ → ダイスロール → 移動 → マス到着
  → 空きマス: クリーチャー召喚
  → 敵マス:   戦闘（攻撃側 vs 防御側 + 地形ボーナス）
  → 自マス:   レベルアップ / 配置換え
→ カードドロー → ターン終了
```

### カード

全 415 枚のカードをデータ駆動で管理しています。

| 種類 | 枚数 | 概要 |
|------|------|------|
| クリーチャー | 149 枚 | 5属性（火・水・地・風・無）。召喚してマスを確保する |
| スペル | 191 枚 | 109種の効果。属性変更、呪い、移動、ドロー等 |
| アイテム | 75 枚 | 戦闘時に装備。ステータス補正やスキル付与 |

### 戦闘

攻撃側と防御側が1対1で戦います。

- **地形ボーナス**: クリーチャーの属性とマスの属性が一致すると HP にボーナス
- **スキル**: 先制、貫通、2回攻撃、即死、反射、再生など 29 種
- **アイテム**: 戦闘前に装備して AP/HP を補正、スキルを付与
- **アルカナアーツ**: クリーチャー固有の特殊能力

## システム構成

```
GameSystemManager（初期化・システム間の接続）
│
├── GameFlowManager（ターン・フェーズ管理）
│   ├── SpellPhaseHandler    ... スペル使用の制御
│   ├── DicePhaseHandler     ... ダイスロール
│   ├── ItemPhaseHandler     ... アイテム使用
│   ├── TollPaymentHandler   ... 通行料支払い
│   ├── DiscardHandler       ... 手札調整
│   └── BankruptcyHandler    ... 破産処理
│
├── BoardSystem3D（3Dボード）
│   ├── MovementController3D ... プレイヤー移動
│   ├── TileNeighborSystem   ... マス隣接判定
│   ├── TileDataManager      ... マス状態管理
│   └── TileActionProcessor  ... 召喚・戦闘等の実行
│
├── BattleSystem（戦闘）
│   ├── BattlePreparation    ... 参加者の準備・バフ計算
│   ├── BattleExecution      ... ダメージ計算・勝敗判定
│   └── BattleSkillProcessor ... スキル発動処理
│
├── SpellSystemContainer（スペル効果 10システム）
│   ├── spell_draw           ... カードドロー
│   ├── spell_magic          ... EP操作
│   ├── spell_land           ... 属性・レベル変更
│   ├── spell_curse          ... 呪い付与
│   └── ...他6システム
│
├── CardSystem       ... デッキ・手札・捨て札管理
├── PlayerSystem     ... プレイヤーの状態・リソース
├── UIManager        ... UI制御（5サービス + 32コンポーネント）
└── CPU AI           ... CPU プレイヤーの意思決定
```

各システムは Signal（イベント通知）と Callable 注入（依存性の注入）で接続しており、
システム間の直接参照を最小限に抑えています。

## 技術スタック

| 項目 | 内容 |
|------|------|
| エンジン | Godot 4.5（Forward+ レンダリング） |
| 言語 | GDScript |
| データ管理 | JSON（カード・マップ定義） |
| ビルド | Web（WASM）対応 |

## プロジェクト構成

```
cardbattlegame/
├── scripts/           ... GDScript（301 ファイル）
│   ├── game_flow/     ... ターン進行・フェーズハンドラー
│   ├── battle/        ... 戦闘システム
│   ├── spells/        ... スペル効果（25 ファイル）
│   ├── cpu_ai/        ... CPU AI（戦略判断・スペルAI）
│   ├── tiles/         ... ボード・マス管理
│   ├── ui_components/ ... UIコンポーネント（32 ファイル）
│   ├── ui_services/   ... UIサービス層
│   ├── skills/        ... スキル効果処理
│   └── ...他14ディレクトリ
├── data/              ... カードデータ（JSON）
├── scenes/            ... シーンファイル（54 シーン）
├── assets/            ... 3Dモデル・テクスチャ・UI素材
├── docs/              ... 設計ドキュメント（130 ファイル）
└── web_build/         ... Web ビルド出力
```

## 起動方法

### 必要なもの

- [Godot 4.5](https://godotengine.org/download/) 以上

### 手順

```bash
git clone https://github.com/your-username/cardbattlegame.git
cd cardbattlegame
```

Godot エディタで `project.godot` を開き、F5 で実行します。

## 開発状況

2025年9月から開発中。

### 実装済み

- ターン制ボードゲームの基本フロー（移動・召喚・戦闘・通行料）
- 415枚のカード（クリーチャー・スペル・アイテム）
- 29種のスキルシステム
- 109種のスペル効果
- CPU AI（スペル判断・戦闘判断・召喚判断）
- デッキ編集・ガチャシステム
- クエストモード
- チュートリアル
- バトルテストツール（最大40,000戦の自動テスト）

### 今後の予定

- 分岐マップ対応
- マップエディタ
- 対戦モード

## ドキュメント

設計ドキュメントは `docs/` にまとめています。

- `docs/design/` - システム設計書（バトル、スキル、スペル、効果等）
- `docs/implementation/` - 実装パターン、シグナルカタログ
- `docs/progress/` - 開発ログ

## ライセンス

このプロジェクトは個人開発のポートフォリオ作品です。
