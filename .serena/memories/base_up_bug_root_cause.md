# ãƒ™ãƒ¼ã‚¹ã‚¢ãƒƒãƒ—ãƒã‚°ã®æ ¹æœ¬åŸå› ç‰¹å®š (2025-11-16 è¿½åŠ æƒ…å ±)

## ğŸ”´ ãƒã‚°ã®å…·ä½“çš„ç¾è±¡

**ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼2**: ãƒ€ã‚¹ã‚¯ãƒ‰ã‚¦ã‚§ãƒ©ãƒ¼ã§æ•µã‚’å€’ã—ç¶šã‘ã‚‹
- 1å›ç›®: base_up_hp +10
- 2å›ç›®: base_up_hp +10 ï¼ˆåˆè¨ˆ+20ï¼‰
- 3å›ç›®: base_up_hp +10 ï¼ˆåˆè¨ˆ+30ï¼‰

**ãã®å¾Œãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼1**: åˆ¥ã®ãƒ€ã‚¹ã‚¯ãƒ‰ã‚¦ã‚§ãƒ©ãƒ¼ã‚’ä½¿ç”¨
- base_up_hp ãŒ +30ã®çŠ¶æ…‹ã§å‡ºç¾ï¼

## ğŸ¯ é‡è¦ãªç™ºè¦‹

### 1. **ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼é–“ã®åŒºåˆ¥ãŒãªã„**
   - ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼2ã®ãƒ€ã‚¹ã‚¯ãƒ‰ã‚¦ã‚§ãƒ©ãƒ¼ãŒ+30ã«ãªã£ãŸ
   - ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼1ã®åŒã˜ã‚«ãƒ¼ãƒ‰ï¼ˆãƒ€ã‚¹ã‚¯ãƒ‰ã‚¦ã‚§ãƒ©ãƒ¼ï¼‰ã‚‚+30ã«ãªã£ã¦ã„ã‚‹
   - ã¤ã¾ã‚Šï¼šã€Œã‚«ãƒ¼ãƒ‰ ID ãƒ™ãƒ¼ã‚¹ã€ã§ãƒ‡ãƒ¼ã‚¿ãŒå…±æœ‰ã•ã‚Œã¦ã„ã‚‹

### 2. **æ¯å›ä¸Šæ˜‡ã™ã‚‹ã‚ã‘ã§ã¯ãªã„**ï¼ˆã“ã‚ŒãŒé‡è¦ï¼ï¼‰
   - ä¸Šæ˜‡ã™ã‚‹æ™‚ã¨ä¸Šæ˜‡ã—ãªã„æ™‚ãŒã‚ã‚‹
   - ã“ã‚Œã¯ã€Œæ‰‹æœ­å†…ã®è¤‡è£½çŠ¶æ³ã€ã«ä¾å­˜ã—ã¦ã„ã‚‹å¯èƒ½æ€§

## ğŸ” æ ¹æœ¬åŸå› ç¢ºå®šã€å®Œå…¨ãªå‚ç…§æ±šæŸ“ï¼ã€‘

### å‚ç…§ãƒã‚§ãƒ¼ãƒ³ã®å®Œå…¨è¿½è·¡

1. **CardLoader.load_all_cards()** (scripts/card_loader.gd)
   ```gdscript
   all_cards.append_array(cards)  // JSONãƒ‡ãƒ¼ã‚¿ã‚’ãƒ¡ãƒ¢ãƒªã«ä¸€åº¦ã ã‘èª­ã¿è¾¼ã¿
   ```
   - `all_cards` ã¯ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ‡ãƒ¼ã‚¿ï¼ˆã‚²ãƒ¼ãƒ å…¨ä½“ã§1ã¤ã ã‘ï¼‰
   - ã™ã¹ã¦ã®ã‚«ãƒ¼ãƒ‰IDã®ãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿

2. **CardLoader.get_card_by_id(card_id)** (line 96-100)
   ```gdscript
   for card in all_cards:
       if check_id == card_id:
           return card  // â† all_cardsã®ä¸­ã®cardã‚’ç›´æ¥è¿”ã™ï¼
   ```
   - **ã‚³ãƒ”ãƒ¼ãªã—ã€å‚ç…§ã‚’ãã®ã¾ã¾è¿”ã™**

3. **CardSystem._load_card_data(card_id)** (scripts/card_system.gd line 154-176)
   ```gdscript
   var card_data = CardLoader.get_card_by_id(card_id)
   // costã®æ­£è¦åŒ–ã‚’è¡Œã†ãŒã€å‚ç…§ã®ã¾ã¾
   return card_data  // â† å‚ç…§ã‚’ãã®ã¾ã¾è¿”ã™
   ```

4. **CardSystem.draw_card_for_player()** (line 178-188)
   ```gdscript
   var card_data = draw_card_data_v2(player_id)
   player_hands[player_id]["data"].append(card_data)  // â† å‚ç…§ã‚’æ‰‹æœ­ã«è¿½åŠ 
   ```
   - ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼0ãŒå¼•ãï¼š`player_hands[0]["data"] = [card_ref_A, ...]`
   - ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼1ãŒåŒã˜ã‚«ãƒ¼ãƒ‰ã‚’å¼•ãï¼š`player_hands[1]["data"] = [card_ref_A, ...]` â† **åŒã˜å‚ç…§ï¼**

5. **BattleSystem.execute_3d_battle()** (scripts/battle_system.gd)
   ```gdscript
   var card_data = card_system_ref.get_card_data_for_player(attacker_index, card_index)
   // BattlePreparationã¸æ¸¡ã•ã‚Œã‚‹
   var attacker = BattleParticipant.new(card_data, ...)  // â† å‚ç…§ã‚’ä¿æŒ
   ```

6. **BattleParticipant._init()**
   ```gdscript
   creature_data = p_creature_data  // â† å‚ç…§ã‚’ä¿æŒ
   ```

7. **BattleSystem._apply_on_destroy_permanent_buffs()** (line 647-669)
   ```gdscript
   participant.creature_data["base_up_hp"] += value  // â† ã‚°ãƒ­ãƒ¼ãƒãƒ«ãªCardLoader.all_cardsã‚’ç›´æ¥ä¿®æ­£ï¼
   ```

### ãƒã‚°ã®çµæœ

- **ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼2ã®ãƒ€ã‚¹ã‚¯ãƒ‰ã‚¦ã‚§ãƒ©ãƒ¼** (card_ref_A) ã« base_up_hp +30 åŠ ç®—
  ```
  card_ref_A["base_up_hp"] = 30
  ```
- **ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼1ãŒãƒ€ã‚¹ã‚¯ãƒ‰ã‚¦ã‚§ãƒ©ãƒ¼ã‚’ä½¿ç”¨**
  - åŒã˜ card_ref_A ã‚’å‚ç…§
  - ã™ã§ã« base_up_hp = 30 ã«ãªã£ã¦ã„ã‚‹ï¼
  - card_ref_A["base_up_hp"] += 10 ã§ +40 ã«ãªã‚‹

### ã€Œæ¯å›ä¸Šæ˜‡ã™ã‚‹ã‚ã‘ã§ã¯ãªã„ã€ç†ç”±

ãƒãƒˆãƒ«ãƒ†ã‚¹ãƒˆç­‰ã§:
- `duplicate(true)` ãŒã©ã“ã‹ã§å‘¼ã°ã‚Œã¦ã„ã‚‹å¯èƒ½æ€§
- battle_test_executor.gd line 109-110:
  ```gdscript
  var att_card_data = CardLoader.get_card_by_id(att_creature_id).duplicate(true)
  var def_card_data = CardLoader.get_card_by_id(def_creature_id).duplicate(true)
  ```
- ã¤ã¾ã‚Šãƒãƒˆãƒ«ãƒ†ã‚¹ãƒˆæ™‚ã¯ã‚³ãƒ”ãƒ¼ã•ã‚Œã¦ã„ã‚‹ã®ã§å•é¡Œãªã—
- ã‚²ãƒ¼ãƒ æœ¬ä½“ã§å‘¼ã°ã‚Œã‚‹execute_3d_battle()ã§ã¯å‚ç…§ã®ã¾ã¾

## ğŸ“‹ ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼ç¢ºèªçµæœ

### é˜²å¾¡å´ï¼ˆã‚¿ã‚¤ãƒ«ä¸Šï¼‰ï¼šæ­£å¸¸ã«æ©Ÿèƒ½ã—ã¦ã„ã‚‹ âœ…

ã‚¿ã‚¤ãƒ«ä¸Šã«é…ç½®ã•ã‚ŒãŸã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ã¯ï¼š
- ãƒãƒˆãƒ«å¾Œã€place_creature_data = duplicate(true)ã§ã‚³ãƒ”ãƒ¼
- CreatureManagerã«ä¿å­˜
- æ¬¡ã®ãƒãƒˆãƒ«ã§é˜²å¾¡å´ã¨ã—ã¦ä½¿ç”¨æ™‚ã€get_data_ref()ã§å‚ç…§ã‚’å–å¾—
- é˜²å¾¡å´ãŒå€’ã•ã‚ŒãŸå ´åˆã€ã‚¿ã‚¤ãƒ«ä¸Šã®ãƒ‡ãƒ¼ã‚¿ã‚’ç›´æ¥ä¿®æ­£
- **å„ã‚¿ã‚¤ãƒ«ã§ç‹¬ç«‹ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’ä¿æœ‰**

### æ”»æ’ƒå´ï¼ˆæ‰‹æœ­ï¼‰ï¼šå‚ç…§æ±šæŸ“ãŒç™ºç”Ÿã—ã¦ã„ã‚‹ âŒ

```
1. åˆæœŸåŒ–: CardLoader.get_card_by_id() â†’ all_cardsã‹ã‚‰å‚ç…§ã‚’è¿”ã™
2. æ‰‹æœ­è¿½åŠ : player_hands[player_id]["data"].append(å‚ç…§)
3. ãƒãƒˆãƒ«: get_card_data_for_player() â†’ å‚ç…§ã‚’è¿”ã™
4. æ•µå€’æ™‚: attacker.creature_data["base_up_hp"] += 10
   â†’ CardLoader.all_cardsã‚’ç›´æ¥ä¿®æ­£ï¼

å…¨ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®åŒã˜ã‚«ãƒ¼ãƒ‰ID = åŒã˜å‚ç…§ = å…¨å“¡ã®base_up_hpãŒå…±æœ‰ã•ã‚Œã‚‹
```

## ğŸ¯ æœ€ã‚‚å¯èƒ½æ€§ã®é«˜ã„åŸå› 

**CardSystemå†…ã§ã€è¤‡æ•°ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒåŒã˜ã‚«ãƒ¼ãƒ‰IDã®å ´åˆã€åŒã˜ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå‚ç…§ã‚’ä¿æŒã—ã¦ã„ã‚‹**

ã¤ã¾ã‚Šï¼š
```
player_hands[0]["data"] = [..., ãƒ€ã‚¹ã‚¯ãƒ‰ã‚¦ã‚§ãƒ©ãƒ¼_ref_A, ...]
player_hands[1]["data"] = [..., ãƒ€ã‚¹ã‚¯ãƒ‰ã‚¦ã‚§ãƒ©ãƒ¼_ref_A, ...]  // åŒã˜å‚ç…§ï¼

battle_system ã§:
  participant.creature_data["base_up_hp"] += 10
  // ã“ã®ä¿®æ­£ãŒ ref_A ã«ç›´æ¥åŠ ç®—ã•ã‚Œã‚‹
  // å…¨ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã€å…¨ãƒ€ã‚¹ã‚¯ãƒ‰ã‚¦ã‚§ãƒ©ãƒ¼ã«å½±éŸ¿
```

**ã€Œæ¯å›ä¸Šæ˜‡ã™ã‚‹ã‚ã‘ã§ã¯ãªã„ã€ã¨ã„ã†ç¾è±¡ã®ç†ç”±:**
- å‚ç…§ãŒæ­£ã—ãã‚³ãƒ”ãƒ¼ã•ã‚Œã¦ã„ã‚‹ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚‚ã‚ã‚Œã°ã€ã•ã‚Œã¦ã„ãªã„ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚‚ã‚ã‚‹
- ä¾‹: æ‰‹æœ­ã‹ã‚‰å‡ºã™ â†’ ã‚³ãƒ”ãƒ¼ â†’ å‚ç…§
- å ´åˆã«ã‚ˆã£ã¦å‡¦ç†é †åºãŒç•°ãªã‚‹
