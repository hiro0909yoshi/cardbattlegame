# ã‚¿ã‚¤ãƒ«ãƒ»ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼åˆ†é›¢ã®æ¤œè¨¼çµæœï¼ˆ2025å¹´11æœˆ16æ—¥ï¼‰

## æ¤œæŸ»ã‚¹ã‚³ãƒ¼ãƒ—
- ãƒãƒˆãƒ«ã‚·ã‚¹ãƒ†ãƒ : BattleExecution, BattleParticipant, ãƒãƒˆãƒ«å‘¨è¾ºã‚¹ã‚­ãƒ«
- ãƒãƒƒãƒ—ã‚·ã‚¹ãƒ†ãƒ : TileActionProcessor, BoardSystem3D, BaseTile, CreatureManager
- ç§»å‹•ã‚·ã‚¹ãƒ†ãƒ : MovementController, MovementHelperï¼ˆåˆæœŸæ®µéšï¼‰

## âœ… è‰¯å¥½ãªéƒ¨åˆ†

### 1. CreatureManagerå®Ÿè£…
- **çŠ¶æ…‹**: å®Œæˆåº¦é«˜
- **ç‰¹å¾´**: å‚ç…§æ–¹å¼ï¼ˆget_data_refãŒå‚ç…§ã‚’è¿”ã™ï¼‰ã§é€éçš„ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆå®Ÿè£…æ¸ˆã¿
- **3Dç®¡ç†**: visual_nodesã§3Dè¡¨ç¤ºã‚‚ç®¡ç†äºˆå®šï¼ˆinfrastructure readyï¼‰
- **æ‹¡å¼µæ©Ÿèƒ½**: find_by_player, find_by_elementç­‰æ¤œç´¢æ©Ÿèƒ½ã‚ã‚Š
- **å‚™è€ƒ**: ã‚»ãƒ¼ãƒ–/ãƒ­ãƒ¼ãƒ‰ç”¨ãƒ¡ã‚½ãƒƒãƒ‰(get_save_data/load_from_save_data)ã¯å®Ÿè£…æ¸ˆã¿ã ãŒã€å®Ÿè£…ã¯æœªç¢ºèª

### 2. BaseTile ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£åŒ–
- **çŠ¶æ…‹**: âœ… å®Œå…¨å®Ÿè£…
- **å†…å®¹**: creature_dataãŒãƒ—ãƒ­ãƒ‘ãƒ†ã‚£åŒ–â†’CreatureManagerã¸ã®é€éçš„ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆå®Ÿè£…
- **å‘¼ã³å‡ºã—å½¢å¼**:
  - getæ™‚: `CreatureManager.get_data_ref(tile_index)`
  - setæ™‚: `CreatureManager.set_data(tile_index, value)`
- **ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯**: ç„¡ã„ï¼ˆCreatureManageræœªåˆæœŸåŒ–æ™‚ã¯push_errorï¼‰

### 3. place_creature/remove_creature
- **BaseTileå®Ÿè£…**: å®Œå…¨ã«æ­£å¸¸å‹•ä½œ
  - place_creature(): ãƒ‡ãƒ¼ã‚¿ã‚³ãƒ”ãƒ¼å¾Œã€3Dã‚«ãƒ¼ãƒ‰ä½œæˆã€ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«æ›´æ–°
  - remove_creature(): ãƒ‡ãƒ¼ã‚¿å‰Šé™¤ã€3Dã‚«ãƒ¼ãƒ‰å‰Šé™¤
  - update_creature_data(): ãƒãƒˆãƒ«ä¸­ãƒ‡ãƒ¼ã‚¿æ›´æ–°ç”¨ï¼ˆå¤‰èº«å¯¾å¿œï¼‰
- **BoardSystem3D**: place_creature()â†’TileDataManagerâ†’BaseTile.place_creature()ã®æµã‚Œæ­£å¸¸

### 4. æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã®äº’æ›æ€§
- **BattleExecution**: creature_dataã¯èª­ã¿å–ã‚Šå°‚ç”¨ï¼ˆnameå–å¾—ãªã©ï¼‰
- **BattleParticipant**: ãƒãƒˆãƒ«é–‹å§‹æ™‚ã«creature_dataã®ã‚³ãƒ”ãƒ¼ã‚’ä¿æœ‰ã€ãƒãƒˆãƒ«ä¸­ã¯ãã®ã‚³ãƒ”ãƒ¼æ“ä½œ
- **TileActionProcessor**: place_creature/remove_creatureã®å‘¼ã³å‡ºã—ã¯æ­£å¸¸

## ğŸš¨ è¦ç¢ºèªãƒ»æ½œåœ¨ãƒªã‚¹ã‚¯

### 1. **ã‚»ãƒ¼ãƒ–/ãƒ­ãƒ¼ãƒ‰æ©Ÿæ§‹ã¨ã®åŒæœŸã€HIGHã€‘**
- **å•é¡Œ**: CreatureManagerã¯ã‚»ãƒ¼ãƒ–/ãƒ­ãƒ¼ãƒ‰ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè£…ã—ã¦ã„ã‚‹ãŒã€å®Ÿéš›ã®ã‚²ãƒ¼ãƒ ãƒ•ãƒ­ãƒ¼ã«çµ±åˆã•ã‚Œã¦ã„ã‚‹ã‹æœªç¢ºèª
- **ãƒªã‚¹ã‚¯**: ã‚²ãƒ¼ãƒ å†é–‹æ™‚ã«ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ãƒ‡ãƒ¼ã‚¿ãŒå¾©å…ƒã•ã‚Œãªã„
- **ç¢ºèªå¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«**:
  - game_flow_manager.gd
  - ã©ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§CreatureManagerå‚ç…§ãŒä¿æŒã•ã‚Œã¦ã„ã‚‹ã‹
  - _ready()ã§ã©ã†åˆæœŸåŒ–ã•ã‚Œã¦ã„ã‚‹ã‹

### 2. **ãƒãƒˆãƒ«å®Œäº†å¾Œã®ãƒ‡ãƒ¼ã‚¿åæ˜ ã€MEDIUMã€‘**
- **å•é¡Œ**: BattleParticipantã¯creature_dataã®ã‚³ãƒ”ãƒ¼ã‚’æŒã¤ãŒã€ãƒãƒˆãƒ«å¾Œã«ã‚¿ã‚¤ãƒ«ã®å®Ÿãƒ‡ãƒ¼ã‚¿ã¸åæ˜ ã•ã‚Œã‚‹ã‹ä¸æ˜
- **ã‚·ãƒŠãƒªã‚ª**:
  - é˜²å¾¡å´ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ã®base_upãŒå¢—åŠ  â†’ tile.creature_dataã«åæ˜ ã•ã‚Œã‚‹ï¼Ÿ
  - æ”»æ’ƒå´ãŒã‚¢ã‚¤ãƒ†ãƒ ç²å¾— â†’ æ‰‹æœ­å¾©å¸°æ™‚ã«æ­£ã—ããƒ‡ãƒ¼ã‚¿ãŒæˆ»ã‚‹ï¼Ÿ
- **ç¢ºèªå¯¾è±¡**: BattleExecutionã¾ãŸã¯ãƒãƒˆãƒ«å®Œäº†å‡¦ç†ã§ã®ãƒ‡ãƒ¼ã‚¿æ›¸ãæˆ»ã—

### 3. **ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼å‰Šé™¤ï¼ˆå€’ã•ã‚ŒãŸæ™‚ï¼‰ã€MEDIUMã€‘**
- **å•é¡Œ**: å€’ã•ã‚ŒãŸã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ãŒCardSystemã«è¿”å´ã•ã‚Œã‚‹ãŒã€ã‚¿ã‚¤ãƒ«ã‹ã‚‰ã®å‰Šé™¤ãŒæ­£ã—ãåŒæœŸã•ã‚Œã‚‹ã‹
- **ãƒ•ãƒ­ãƒ¼**:
  1. defender_p.creature_dataãŒå‚ç…§ â†’ ã‚¿ã‚¤ãƒ«ã®ãƒ‡ãƒ¼ã‚¿
  2. card_system.return_card_to_hand(player_id, creature_data)
  3. board_system.remove_creature(tile_index) â†’ CreatureManager.clear_data()ãŒå‘¼ã°ã‚Œã‚‹ï¼Ÿ
- **ãƒªã‚¹ã‚¯**: äºŒé‡å‰Šé™¤ã¾ãŸã¯å‰Šé™¤æ¼ã‚Œ

### 4. **ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼äº¤æ›å‡¦ç†ï¼ˆexecute_swapï¼‰ã€MEDIUMã€‘**
- **å•é¡Œ**: TileActionProcessor.execute_swap()ã§ã®ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼å–å¾—ã¨è¿”å´ãŒæ­£å¸¸ã‹
- **ã‚³ãƒ¼ãƒ‰**: `var actual_creature_data = tile_info.get("creature", {})`
- **ãƒªã‚¹ã‚¯**: tile_infoãŒå¤ã„ãƒ‡ãƒ¼ã‚¿ã‚’æŒã¤å ´åˆãŒã‚ã‚‹ï¼ˆå¤‰èº«å¾Œãªã©ï¼‰
- **ç¢ºèª**: tile_info.get("creature")ãŒCreatureManagerã®å‚ç…§ã‚’è¿”ã™ã‹ã€ãã‚Œã¨ã‚‚è¤‡è£½ã‹

### 5. **CreatureManageræœªåˆæœŸåŒ–æ™‚ã®æŒ™å‹•ã€HIGHã€‘**
- **å•é¡Œ**: BaseTile.creature_dataã®getterãŒCreatureManageræœªåˆæœŸåŒ–æ™‚push_errorã§ç©ºè¾æ›¸ã‚’è¿”ã™
- **ãƒªã‚¹ã‚¯**: åˆæœŸåŒ–é †åºã®å•é¡Œã§ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ãƒ‡ãƒ¼ã‚¿ãŒå¤±ã‚ã‚Œã‚‹
- **ç¢ºèª**:
  - BoardSystem3D._ready()ã§BaseTile.creature_managerãŒæ˜ç¤ºçš„ã«è¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹
  - ã‚¿ã‚¤ãƒ«ãƒãƒ¼ãƒ‰ç”Ÿæˆã‚¿ã‚¤ãƒŸãƒ³ã‚°ã¨CreatureManageråˆæœŸåŒ–ã‚¿ã‚¤ãƒŸãƒ³ã‚°

### 6. **3Dè¡¨ç¤ºãƒãƒ¼ãƒ‰ã®åŒæœŸã€MEDIUMã€‘**
- **å•é¡Œ**: creature_card_3dã®ç”Ÿæˆã‚¿ã‚¤ãƒŸãƒ³ã‚°ã¨CreatureManagerã®3Dç®¡ç†ã®é–¢ä¿‚
- **è¦³å¯Ÿ**: BaseTile._create_creature_card_3d()ã§ãƒãƒ¼ãƒ‰ã‚’ä½œæˆã™ã‚‹ãŒã€CreatureManager.visual_nodesã¨ã®é€£å‹•ãŒä¸æ˜
- **ãƒªã‚¹ã‚¯**: 3Dè¡¨ç¤ºãŒæ›´æ–°ã•ã‚Œãªã„ã¾ã¾è¡¨ç¤ºã•ã‚Œã‚‹ã€ã¾ãŸã¯äºŒé‡ä½œæˆ

### 7. **movement_helperã§ã®ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼å‚ç…§ã€MEDIUMã€‘**
- **æœªç¢ºèª**: movement_helper.gdå†…ã§ã®`creature_data`ä½¿ç”¨ãƒ‘ã‚¿ãƒ¼ãƒ³
- **å¯èƒ½æ€§**: ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ç§»å‹•æ™‚ã®å‚ç…§ãŒCreatureManagerã¨åŒæœŸã•ã‚Œã¦ã„ã‚‹ã‹

### 8. **land_action_helperå†…ã§ã®å‰Šé™¤å‡¦ç†ã€MEDIUMã€‘**
- **æœªç¢ºèª**: åœŸåœ°ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å†…ã§ã®`remove_creature()`å‘¼ã³å‡ºã—ãƒ‘ã‚¿ãƒ¼ãƒ³
- **ãƒªã‚¹ã‚¯**: å¤ã„ã‚³ãƒ¼ãƒ‰ã§ç›´æ¥tile.creature_data = {}ã¨ã„ã†æ›¸ãæ–¹ãŒæ®‹ã£ã¦ã„ãªã„ã‹

## ğŸ“‹ æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆä¿®æ­£å‰ã®ç¢ºèªé …ç›®ï¼‰

1. **board_system_3d.gd ã®_ready()** 
   - BaseTile.creature_manager = cm ãŒæ˜ç¤ºçš„ã«è¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹

2. **game_flow_manager.gdå†…ã§ã®CreatureManagerå‚ç…§**
   - CreatureManagerãŒä¿æŒãƒ»åˆæœŸåŒ–ã•ã‚Œã¦ã„ã‚‹ã‹
   - ã‚»ãƒ¼ãƒ–/ãƒ­ãƒ¼ãƒ‰æ™‚ã«get_save_data/load_from_save_dataãŒå‘¼ã°ã‚Œã¦ã„ã‚‹ã‹

3. **ãƒãƒˆãƒ«å®Œäº†å¾Œã®å‡¦ç†ãƒã‚§ãƒƒã‚¯**
   - BattleExecutionã¾ãŸã¯ãã®å‘¼ã³å‡ºã—å…ƒã§ã€creature_dataã®æ›¸ãæˆ»ã—ãŒå­˜åœ¨ã™ã‚‹ã‹

4. **movement_helper.gdå†…ã®è©³ç´°**
   - creature_dataä½¿ç”¨ç®‡æ‰€ã®ç¢ºèª

5. **land_action_helper.gdå†…ã®è©³ç´°**
   - remove_creature()ã¨tile.creature_dataã®ç›´æ¥æ“ä½œãƒ‘ã‚¿ãƒ¼ãƒ³ç¢ºèª

## åˆ¤å®š
- **å…¨ä½“çš„**: ãƒ‡ãƒ¼ã‚¿åˆ†é›¢ã®æ§‹é€ ã¯è‰¯å¥½
- **ãŸã ã—**: å‘¨è¾ºã‚·ã‚¹ãƒ†ãƒ ï¼ˆã‚»ãƒ¼ãƒ–/ãƒ­ãƒ¼ãƒ‰ã€ãƒãƒˆãƒ«å®Œäº†å¾Œã€ç§»å‹•ï¼‰ã¨ã®é€£æºç¢ºèªãŒå¿…è¦
- **é«˜ãƒªã‚¹ã‚¯**: CreatureManageræœªåˆæœŸåŒ–å•é¡Œã€ã‚»ãƒ¼ãƒ–/ãƒ­ãƒ¼ãƒ‰æœªçµ±åˆ
