# 🐛 課題管理

**最終更新**: 2025年10月15日

---

## 📊 現在の状況

| 優先度 | 未対応 | 対応中 | 合計 |
|--------|--------|--------|------|
| 🔴 Critical | 0 | 1 | 1 |
| 🟡 High | 4 | 0 | 4 |
| 🟢 Medium | 3 | 0 | 3 |
| ⚪ Low | 2 | 0 | 2 |

---

## 🔴 Critical（即時対応）

### BUG-004: アクション処理フラグの二重管理
- **報告**: 2025/10/16
- **影響**: BoardSystem3D, TileActionProcessor
- **症状**: 領地コマンド実行後、次のプレイヤーがカードを選択しても召喚できない
- **原因**: アクション処理中を示すフラグが2箇所で管理されている
  - `BoardSystem3D.is_waiting_for_action`
  - `TileActionProcessor.is_action_processing`
- **問題点**: 
  - 片方だけリセットされるとフラグの整合性が取れなくなる
  - 領地コマンドなど外部からアクション完了を通知する際に両方を意識する必要がある
  - バグの温床になっている
- **暫定対応**: `TileActionProcessor._complete_action()`を経由して両方のフラグをリセット
- **恒久対応**: フラグを1箇所に統一する（TECH-002として設計改善に登録）
- **ステータス**: 🚧 暫定対応済み、恒久対応待ち

---

## 🟡 High（今週対応）

### BUG-001: カードドロー時の表示ズレ
- **報告**: 2025/01/09
- **影響**: CardSystem, UI
- **症状**: 6枚目カード使用後に新しいカードの配置がずれる
- **原因**: `_rearrange_player_hand()`でノード削除が反映されていない
- **対応**: ノード有効性チェック強化 + `await process_frame`追加
- **ステータス**: 🚧 調査中

---

### BUG-002: CPU AIの無限ループ
- **報告**: 2025/01/08
- **影響**: CPUAIHandler
- **症状**: 魔力不足時にCPUターンが終わらない
- **原因**: カード使用可能判定でループ脱出条件がない
- **対応**: 最大試行回数設定、空の場合は即座にスキップ
- **ステータス**: ⚠️ 要対応

---

### BUG-003: 属性連鎖の誤判定
- **報告**: 2025/01/10
- **影響**: BoardSystem
- **症状**: 隣接していない土地が連鎖としてカウントされる（特に菱形マップの角）
- **原因**: 菱形配置での隣接判定ロジックが不完全
- **対応**: 隣接テーブルの見直し、菱形配置専用の判定関数作成
- **ステータス**: 📋 計画中

---

### UI-004: ターン終了ボタンがない
- **報告**: 2025/01/10
- **影響**: ユーザビリティ
- **症状**: プレイヤーのターンを任意に終了できない
- **対応**: 「ターン終了」ボタン追加、Escキーでも終了可能に
- **ステータス**: 📋 計画中

---

## 🟢 Medium（来週以降）

### BUG-004: スキル効果の重複適用
- **報告**: 2025/01/10
- **影響**: SkillSystem, BattleSystem
- **症状**: 強打スキルが複数回適用される
- **原因**: 既に修正済みのAPに対して再度倍率適用
- **対応**: `power_strike_applied`フラグ確認、元のAP値を保持
- **ステータス**: 🚧 調査中

---

### BALANCE-001: 初期魔力が低すぎる
- **報告**: 2025/01/09
- **現状**: 3000G → 平均カードコスト 500-1000G
- **問題**: 最初の数ターンでカードが使えない
- **提案**: 初期魔力を4000Gに増加
- **対応**: プレイテスト10回実施、3ターン目までのカード使用率を測定
- **ステータス**: 📋 計画中

---

### UI-001: カード選択時のフィードバック不足
- **報告**: 2025/01/10
- **症状**: カードホバー時に視覚的変化なし、選択可能なカードが不明瞭
- **対応**: ホバー時拡大(scale: 1.1)、選択可能カードに光るエフェクト、選択不可をグレーアウト
- **ステータス**: 📋 計画中

---

## ⚪ Low（優先度低）

### BUG-005: デバッグパネルの文字が小さい
- **報告**: 2025/01/09
- **症状**: 高解像度ディスプレイでデバッグテキストが読みづらい（12px）
- **対応**: フォントサイズを16pxに変更、または解像度に応じた動的調整
- **ステータス**: 📋 計画中

---

### BUG-006: カードコストの表示が辞書形式
- **報告**: 2025/01/10
- **症状**: カードコストが`{"mp": 50}`と表示される
- **対応**: `card.gd`で`card_data.cost`が辞書の場合は`.mp`を取り出して表示
- **ステータス**: 📋 計画中

---

## 📝 最近解決した課題（直近5件）

### ✅ FEAT-004: レベルアップ機能完全実装
- **解決**: 2025/10/15
- **内容**: アクションメニュー・レベル選択UIパネル作成、LandCommandHandler修正
- **対応**: 右側パネル配置、Lv2-5選択、コスト表示、魔力判定、ターン終了統合
- **苦労した点**: シグナル発火時の`selected_tile_for_action = -1`問題、`modify_magic_power`関数名エラー

### ✅ WARN-006〜009: Godot警告修正
- **解決**: 2025/10/15
- **内容**: シャドウイング、未使用パラメータ、到達不能コード、整数除算
- **対応**: パラメータ名変更、`_`プレフィックス追加、不要なreturn削除、明示的型変換

### ✅ TECH-007: ドキュメント構造整理
- **解決**: 2025/10/15
- **内容**: `docs/`ディレクトリの構造化と運用ルール明確化
- **対応**: design/progress/issues/に分類、README作成、更新権限明記

### ✅ BUG-008〜011: デバッグモード関連
- **解決**: 2025/01/12
- **内容**: CPU手動操作不可、手札表示が固定、手札重なり、ドラッグ&ドロップ
- **対応**: 初期化順序修正、player_id動的取得、全プレイヤー手札削除、ドラッグ無効化

### ✅ FEAT-001〜002: 隣接判定・土地ボーナス
- **解決**: 2025/01/11
- **内容**: TileNeighborSystem実装、土地ボーナスシステム実装
- **対応**: 座標ベース隣接判定、属性一致時HP+(レベル×10)

### ✅ BUG-000: ターン終了処理の重複
- **解決**: 2025/01/11
- **内容**: ターン飛ばし、`end_turn()`重複実行
- **対応**: シグナル経路一本化、2D版コード削除

📚 **全解決済み課題**: [`resolved_issues.md`](resolved_issues.md) を参照

---

## 🎯 今週の対応予定

### 優先順位
1. 🟡 **BUG-002**: CPU AIの無限ループ → ゲーム進行に影響
2. 🟡 **UI-004**: ターン終了ボタン → ユーザビリティ向上
3. 🟡 **BUG-003**: 属性連鎖の誤判定 → ゲームバランスに影響

---

## 📋 バグ報告テンプレート

```markdown
### BUG-XXX: [タイトル]
- **報告**: YYYY/MM/DD
- **影響**: [システム名]
- **症状**: [簡潔な説明]
- **原因**: [推測される原因]
- **対応**: [修正方法]
- **ステータス**: 🚧 調査中 / ⚠️ 要対応 / 📋 計画中 / ✅ 解決済み
```

---

## 🔍 ステータス凡例

| アイコン | 意味 |
|---------|------|
| 🚧 | 調査中・デバッグ中 |
| ⚠️ | 対応方法確定・実装待ち |
| 📋 | 計画中・優先度待ち |
| ✅ | 解決済み |

---

**管理者**: プロジェクトチーム  
**アーカイブ**: 解決済み課題は [`resolved_issues.md`](resolved_issues.md) に移動
