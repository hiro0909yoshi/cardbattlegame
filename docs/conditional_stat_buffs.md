# 条件付きステータス上昇スキル仕様書

## 概要
クリーチャーが特定の条件下でステータス（ST/HP/MHP）が増減するスキルの仕様をまとめたドキュメント。

## 全体像
- **対象クリーチャー数**: 38体
- **実装状況**: 2体実装済み（アームドパラディン、サンダースポーン）
- **未実装**: 36体

---

## カテゴリ別分類

### 🔵 カテゴリ1: 配置数比例（land_count_multiplier）

#### 1-A: 単一属性の配置数
配置されている特定属性の領地数に比例してステータスが変動。

| ID | 名前 | 条件 | 効果タイプ |
|----|------|------|-----------|
| 37 | ファイアードレイク | ST+火配置数×5 | 加算 |
| 236 | ブランチアーミー | ST+地配置数×5 | 加算 |
| 238 | マッドマン | HP+地配置数×5 | 加算 |
| 307 | ガルーダ | ST&HP=風配置数×10 | 代入 |
| 318 | サンダースポーン | ST+水自領地数×10 | 加算（✅実装済み） |
| 109 | アンダイン | HP=水自領地数×20 | 代入 |

**実装メモ:**
- `land_count_multiplier` effectを使用
- `stat`: "ap" または "hp"
- `elements`: 対象属性の配列
- `multiplier`: 乗数
- `operation`: "add"（加算）または "set"（代入）

#### 1-B: 複数属性の配置数
複数の属性の合計配置数に比例。

| ID | 名前 | 条件 |
|----|------|------|
| 1 | アームドパラディン | ST=火地配置数×10（✅実装済み） |

**実装メモ:**
- `elements`: ["fire", "earth"] のように複数指定

#### 1-C: 他属性の配置数
自分以外の属性の配置数に比例。

| ID | 名前 | 条件 |
|----|------|------|
| 440 | リビングクローブ | ST&HP=他属性の配置数×5 |

**実装メモ:**
- 新しい条件タイプ `other_elements` が必要
- 自分の属性を除外してカウント

#### 1-D: 特定クリーチャー種族の配置数
特定のクリーチャー名の配置数に比例。

| ID | 名前 | 条件 |
|----|------|------|
| 32 | ハイプワーカー | ST&HP+ハイプワーカー配置数×10 |

**実装メモ:**
- 新しいeffect_type: `creature_count_multiplier` が必要
- `target_creature_name`: "ハイプワーカー"

#### 1-E: MHP条件付き配置数
特定のMHP以上/以下のクリーチャー配置数に比例。

| ID | 名前 | 条件 |
|----|------|------|
| 15 | ジェネラルカン | ST+MHP50以上配置数×5 |

**実装メモ:**
- `land_count_multiplier` に条件追加
- `creature_condition`: {"mhp_check": {"operator": ">=", "value": 50}}

---

### 🟡 カテゴリ2: 周回・ラウンド数

#### 2-A: 周回ごとに永続上昇
周回を重ねるごとに永続的にステータスが上昇。

| ID | 名前 | 条件 | 特記事項 |
|----|------|------|---------|
| 7 | キメラ | 周回ごとにST+10 | 永続蓄積 |
| 240 | モスタイタン | 周回ごとにMHP+10 | MHP80以上で30にリセット |

**実装メモ:**
- 新しいeffect_type: `per_lap_permanent_bonus`
- `stat`: "ap" または "max_hp"
- `value`: 増加量
- `reset_condition`: {"max_hp_check": {"operator": ">=", "value": 80, "reset_to": 30}}（モスタイタンのみ）

**データ保存:**
- クリーチャーごとに周回数カウンターを保持
- ゲームデータに永続的に保存

#### 2-B: 現在ラウンド数=ステータス
現在のラウンド数がそのままステータスになる。

| ID | 名前 | 条件 |
|----|------|------|
| 47 | ラーバキン | ST=現R数、HP+現R数 |

**実装メモ:**
- 新しいeffect_type: `round_number_bonus`
- `stat`: "ap" または "hp"
- `operation`: "set" または "add"

---

### 🟢 カテゴリ3: 領地条件

#### 3-A: 自領地数
自分の所有領地数による条件。

| ID | 名前 | 条件 |
|----|------|------|
| 30 | バーンタイタン | 自領地が5つ以上の場合、ST&HP-30 |

**実装メモ:**
- 新しいeffect_type: `owned_land_count_bonus`
- `condition`: {"operator": ">=", "value": 5}
- `stat_changes`: {"ap": -30, "hp": -30}

#### 3-B: 隣接領地条件
隣接する領地の状態による条件。

| ID | 名前 | 条件 |
|----|------|------|
| 226 | タイガーヴェタ | 隣接領地が自領地の場合、ST&HP+20 |
| 49 | ローンビースト | HP+基本ST；隣が自領地なら強打 |

**実装メモ:**
- 新しいeffect_type: `adjacent_land_bonus`
- `condition`: "all_adjacent_owned" または "any_adjacent_owned"
- `stat_changes`: {"ap": 20, "hp": 20}

#### 3-C: 領地レベル
戦闘地の領地レベルに依存。

| ID | 名前 | 条件 |
|----|------|------|
| 131 | ネッシー | 水で戦闘中、HP+領地レベル×10 |

**実装メモ:**
- 新しいeffect_type: `battle_land_level_bonus`
- `element_condition`: ["water"]
- `stat`: "hp"
- `multiplier`: 10

#### 3-D: 領地変化時
領地のレベルアップや地形変化時にトリガー。

| ID | 名前 | 条件 | 効果 |
|----|------|------|------|
| 200 | アースズピリット | 配置領地でレベルアップか地形変化時 | MHP+10 |
| 328 | デュータイタン | 配置領地でレベルアップまたは地形変化時 | MHP-10 |

**実装メモ:**
- 新しいeffect_type: `on_land_change`
- `trigger`: "level_up" または "terrain_change"
- `stat_change`: {"max_hp": 10} または {"max_hp": -10}
- イベントベースの処理が必要

#### 3-E: マーク付き領地
特定のマーク（♡など）が付いた領地での戦闘。

| ID | 名前 | 条件 |
|----|------|------|
| 206 | ギガンテリウム | ♡付き領地で戦闘中、HP-20 |

**実装メモ:**
- 新しいeffect_type: `marked_land_bonus`
- `mark_type`: "heart" など
- `stat_change`: {"hp": -20}

---

### 🔴 カテゴリ4: 戦闘イベント

#### 4-A: 敵破壊時（永続上昇）
敵クリーチャーを破壊するたびに永続的にステータスが上昇。

| ID | 名前 | 条件 |
|----|------|------|
| 35 | バルキリー | 敵破壊時、ST+10 |
| 227 | ダスクドウェラー | 敵破壊時、ST&MHP+10 |

**実装メモ:**
- 新しいeffect_type: `on_enemy_destroy_permanent`
- `stat_changes`: {"ap": 10} または {"ap": 10, "max_hp": 10}
- 破壊成功時のイベントハンドラーが必要
- クリーチャーごとに累積カウンターを保持

#### 4-B: 破壊数カウント
累計破壊数に比例してステータスが変動。

| ID | 名前 | 条件 |
|----|------|------|
| 323 | ソウルコレクター | ST+クリーチャー破壊数×5 |

**実装メモ:**
- 新しいeffect_type: `destroy_count_multiplier`
- `stat`: "ap"
- `multiplier`: 5
- グローバルまたはプレイヤーごとの破壊数カウンターが必要

#### 4-C: 戦闘後
戦闘終了後にステータスが変動。

| ID | 名前 | 条件 |
|----|------|------|
| 446 | ロックタイタン | 戦闘後、ST&MHP-10 |
| 34 | バイロマンサー | 敵攻撃成功の戦闘後、ST=20、MHP-30 |

**実装メモ:**
- 新しいeffect_type: `after_battle_change`
- `trigger`: "any" または "enemy_attack_success"
- `stat_changes`: {"ap": -10, "max_hp": -10}
- `operation`: "add" または "set"

---

### 🟣 カテゴリ5: 戦闘地・地形条件

#### 5-A: 戦闘地の属性
戦闘が行われる地形の属性による条件。

| ID | 名前 | 条件 |
|----|------|------|
| 110 | アンフィビアン | 戦闘地が水風の場合、ST+20 |

**実装メモ:**
- 既存の条件システムを拡張
- `battle_land_element_check`: {"elements": ["water", "wind"]}

#### 5-B: 敵の属性
対戦相手の属性による条件。

| ID | 名前 | 条件 |
|----|------|------|
| 205 | カクタスウォール | 敵が水風の場合、HP+50 |

**実装メモ:**
- 既存の `enemy_is_element` を使用
- 防御型と組み合わせた条件

---

### 🟠 カテゴリ6: 手札・ブック条件

#### 6-A: 手札数
自分の手札枚数に依存。

| ID | 名前 | 条件 |
|----|------|------|
| 146 | リリス | ST=自手札数×10 |

**実装メモ:**
- 新しいeffect_type: `hand_count_multiplier`
- `stat`: "ap"
- `multiplier`: 10
- `operation`: "set"

#### 6-B: ブック数
ブック（デッキ）の残り枚数の比較。

| ID | 名前 | 条件 |
|----|------|------|
| 214 | コアトリクエ | ブックが相手より多い場合、ST&HP+20 |

**実装メモ:**
- 新しいeffect_type: `deck_comparison_bonus`
- `comparison`: "greater_than_opponent"
- `stat_changes`: {"ap": 20, "hp": 20}

---

### 🟤 カテゴリ7: ダイス条件

| ID | 名前 | 条件 |
|----|------|------|
| 23 | ドゥームデボラー | 自ダイス3以下の場合、ST&MHP+10 |

**実装メモ:**
- 新しいeffect_type: `dice_condition_bonus`
- `dice_check`: {"operator": "<=", "value": 3}
- `stat_changes`: {"ap": 10, "max_hp": 10}

---

### ⚫ カテゴリ8: 役割・状態条件

#### 8-A: 防御時
防御側として戦闘する時のみ有効。

| ID | 名前 | 条件 |
|----|------|------|
| 204 | ガーゴイル | 防御時、ST=50 |

**実装メモ:**
- 新しいeffect_type: `defensive_stat_override`
- `stat`: "ap"
- `value`: 50
- `operation`: "set"

#### 8-B: 常時補正
常に有効な固定補正。

| ID | 名前 | 条件 |
|----|------|------|
| 102 | アイスウォール | HP+20（常時） |
| 330 | トルネード | ST+20、HP-10（常時） |

**実装メモ:**
- 既存の基本ステータスに含めるか、シンプルなボーナスとして実装
- `constant_stat_bonus`: {"ap": 20, "hp": -10}

---

### ⚪ カテゴリ9: アイテム関連

#### 9-A: アイテムクリーチャー特殊
アイテムとしてではなくクリーチャーとして戦闘時。

| ID | 名前 | 条件 |
|----|------|------|
| 438 | リビングアーマー | クリーチャーとして戦闘中、ST+50 |

**実装メモ:**
- 新しいeffect_type: `as_creature_bonus`
- `stat_changes`: {"ap": 50}
- アイテムクリーチャーシステムと連動

#### 9-B: アイテム使用時
アイテムを使用した戦闘時。

| ID | 名前 | 条件 |
|----|------|------|
| 339 | ブルガサリ | アイテム使用時、ST+20；敵アイテム使用の戦闘後、MHP+10 |

**実装メモ:**
- 新しいeffect_type: `on_item_use_bonus`
- `trigger`: "self_item_use" または "enemy_item_use"
- `timing`: "during_battle" または "after_battle"

---

### 🎲 カテゴリ10: 特殊・複雑

#### 10-A: ランダム
毎回ランダムにステータスが決定。

| ID | 名前 | 条件 |
|----|------|------|
| 321 | スペクター | ST&HP=10~70 |

**実装メモ:**
- 新しいeffect_type: `random_stat`
- `stat`: "both"
- `min`: 10, `max`: 70

#### 10-B: 援護クリーチャー依存
援護しているクリーチャーのステータスに依存。

| ID | 名前 | 条件 |
|----|------|------|
| 137 | ブラッドプリン | 戦闘前、MHP+援護クリーチャーのHP |

**実応メモ:**
- 新しいeffect_type: `support_creature_stat_copy`
- `source_stat`: "hp"
- `target_stat`: "max_hp"
- 援護システムとの統合が必要

#### 10-C: オーガ種族配置時
特定種族（オーガ）の配置時。

| ID | 名前 | 条件 |
|----|------|------|
| 407 | オーガロード | 火風オーガ配置時ST+20、水地オーガ配置時HP+20 |

**実装メモ:**
- 新しいeffect_type: `tribe_placement_bonus`
- `tribe`: "オーガ"
- `conditions`: [
  - {"elements": ["fire", "wind"], "stat_changes": {"ap": 20}},
  - {"elements": ["water", "earth"], "stat_changes": {"hp": 20}}
- ]

---

## 実装優先度

### 🔥 最優先（シンプルで影響大）
1. **カテゴリ1-A**: 単一属性配置数（6体）
   - 既存のland_count_multiplierを活用
   - 比較的簡単に実装可能

2. **カテゴリ2-A**: 周回ごと永続上昇（2体）
   - 新システムだが仕様が明確
   - ゲームの戦略性を大きく向上

3. **カテゴリ4-A**: 敵破壊時永続上昇（2体）
   - 戦闘の達成感を向上
   - イベントシステムの実装が必要

### 🟡 次に実装（やや複雑）
4. **カテゴリ1-E**: MHP条件付き配置数（1体）
5. **カテゴリ3-B**: 隣接領地条件（2体）
6. **カテゴリ6-A**: 手札数（1体）
7. **カテゴリ2-B**: 現在ラウンド数（1体）

### 🔵 中優先度（複雑だが重要）
8. **カテゴリ4-B**: 破壊数カウント（1体）
9. **カテゴリ3-A**: 自領地数（1体）
10. **カテゴリ8-B**: 常時補正（2体）

### ⚪ 後回し（特殊ケース）
11. カテゴリ9, 10の複雑な条件
12. カテゴリ3-D, 3-E（イベント駆動）
13. カテゴリ7（ダイス条件）

---

## 技術的考慮事項

### データ永続化
以下のデータはゲームセーブデータに保存が必要：
- **周回カウンター**（キメラ、モスタイタン）
- **敵破壊時累積ボーナス**（バルキリー、ダスクドウェラー）
- **破壊数カウンター**（ソウルコレクター）

### イベントシステム
以下のイベントハンドラーが必要：
- `on_enemy_destroyed`: 敵破壊時
- `on_battle_end`: 戦闘終了時
- `on_land_level_up`: 領地レベルアップ時
- `on_terrain_change`: 地形変化時
- `on_lap_complete`: 周回完了時

### 計算タイミング
- **戦闘前**: 配置数、手札数、領地条件など
- **戦闘中**: 戦闘地条件、防御時条件など
- **戦闘後**: 戦闘後変動、破壊時ボーナスなど
- **永続**: 周回ごと、破壊時累積など

---

## 既存システムとの統合

### 既に実装されている関連システム
- `land_count_multiplier`: 配置数比例（カテゴリ1-A, 1-Bで使用）
- `power_strike`: 強打条件（MHP/ST条件と組み合わせ）
- `enemy_is_element`: 敵属性条件（カテゴリ5-Bで使用）

### 新規に必要なシステム
- 永続データ保存機構
- イベント駆動システム
- 動的ステータス計算システムの拡張

---

## 実装ロードマップ

### Phase 1: 配置数比例の完成
- [ ] カテゴリ1-Aの残り5体を実装
- [ ] カテゴリ1-Cの他属性配置数を実装
- [ ] カテゴリ1-EのMHP条件付き配置数を実装

### Phase 2: 永続蓄積システム
- [ ] 周回カウンターシステムの実装
- [ ] カテゴリ2-Aを実装（キメラ、モスタイタン）
- [ ] 敵破壊時イベントハンドラーの実装
- [ ] カテゴリ4-Aを実装（バルキリー、ダスクドウェラー）

### Phase 3: 領地・戦闘条件
- [ ] カテゴリ3-A, 3-Bの実装
- [ ] カテゴリ2-Bのラウンド数依存を実装
- [ ] カテゴリ6-Aの手札数依存を実装

### Phase 4: 複雑な条件
- [ ] カテゴリ4-B, 4-Cの実装
- [ ] カテゴリ9, 10の特殊ケースを実装
- [ ] カテゴリ3-D, 3-Eのイベント駆動を実装

---

## 参考リンク
- [既存のステータス計算システム](./stats_calculation.md)
- [援護システム仕様](./support_system.md)
- [イベントシステム設計](./event_system.md)（未作成）
