# ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°å®Œäº†ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ï¼ˆPhase 0ã€œ9ï¼‰

**æœ€çµ‚æ›´æ–°**: 2026-02-19
**å¯¾è±¡æœŸé–“**: 2026-02-13 ã€œ 2026-02-19
**çŠ¶æ…‹**: âœ… Phase 0ã€œ9 å®Œäº†

---

## å…¨ä½“ã‚µãƒãƒªãƒ¼

### ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ç§»è¡Œã®æˆæœ

| æŒ‡æ¨™ | Beforeï¼ˆPhase 0å‰ï¼‰ | Afterï¼ˆPhase 9å¾Œï¼‰ | æ”¹å–„ |
|------|-------------------|-------------------|------|
| UI ã‚µãƒ¼ãƒ“ã‚¹ | 0 | 4ï¼ˆ551è¡Œï¼‰ | æ–°è¦ä½œæˆ |
| UI Signals | 4 | 37 | +33 |
| ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ UI åˆ†é›¢ | 0/8 | 8/8 | 100% |
| 3æ®µä»¥ä¸Šãƒã‚§ãƒ¼ãƒ³ã‚¢ã‚¯ã‚»ã‚¹ | è¤‡æ•° | 0 | 100%è§£æ¶ˆ |
| private å¤–éƒ¨ã‚¢ã‚¯ã‚»ã‚¹ | è¤‡æ•° | 0 | 100%è§£æ¶ˆ |
| restore_current_phase | 58è¡Œï¼ˆ5åˆ†å²ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰ | 1è¡Œ | çŠ¶æ…‹ãƒ«ãƒ¼ã‚¿ãƒ¼è§£ä½“ |
| UIManager å¾Œæ–¹å‚ç…§ | 6 | 5 | SPHå‰Šé™¤ |
| SpellPhaseHandler è¡Œæ•° | 982è¡Œ | 724è¡Œ | 258è¡Œå‰Šæ¸› |
| SpellSystemContainer | ãªã—ï¼ˆå€‹åˆ¥å¤‰æ•°ï¼‰ | 10+2ã‚·ã‚¹ãƒ†ãƒ çµ±åˆ | æ–°è¦ |

### ç¢ºç«‹ã—ãŸè¨­è¨ˆåŸå‰‡

```
Business Logic Layer (GFM, Handlers, Systems)
    â†“ Signal ONLY
UI Service Layer (NavigationService, MessageService, CardSelectionService, InfoPanelService)
    â†“ Direct callï¼ˆè¦ªâ†’å­ï¼‰
UI Component Layer (GlobalActionButtons, GlobalCommentUI, CardSelectionUI, InfoPanels...)
```

**4ã¤ã®çµ¶å¯¾ãƒ«ãƒ¼ãƒ«**:
1. ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ â†’ UIã‚µãƒ¼ãƒ“ã‚¹: **Signal ã®ã¿**
2. UIã‚µãƒ¼ãƒ“ã‚¹ â†’ UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ: **ç›´æ¥ãƒ¡ã‚½ãƒƒãƒ‰å‘¼ã³å‡ºã—**ï¼ˆè¦ªâ†’å­ã¯æ­£å½“ï¼‰
3. UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ â†’ ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯: **ç¦æ­¢**
4. UIã‚µãƒ¼ãƒ“ã‚¹ â†’ UIã‚µãƒ¼ãƒ“ã‚¹: **ç¦æ­¢**ï¼ˆèª¿åœã¯ä¸Šä½ã®ã¿ï¼‰

**ã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³**:
- ServiceLocatoråŒ– / ãƒãƒ³ãƒ‰ãƒ«ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆé…å¸ƒã®ç¦æ­¢
- UIContext ã‚¯ãƒ©ã‚¹ã¯ä½œã‚‰ãªã„ï¼ˆå„ãƒ•ã‚¡ã‚¤ãƒ«ã«å¿…è¦ãªã‚µãƒ¼ãƒ“ã‚¹ã ã‘æ¸¡ã™ï¼‰
- ã‚µãƒ¼ãƒ“ã‚¹é–“æ¨ªæ–­ã®ç¦æ­¢

---

## Phase ä¸€è¦§

### Phase 0ã€œ4: ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£åŸºç›¤

| Phase | å†…å®¹ | ä¸»ãªæˆæœ | å®Ÿæ–½æ—¥ |
|-------|------|---------|--------|
| 0 | ãƒ„ãƒªãƒ¼æ§‹é€ å®šç¾© | TREE_STRUCTURE.md, dependency_map.md ä½œæˆ | 2026-02-13 |
| 1 | SpellSystemManager å°å…¥ | 10+2å€‹ã®ã‚¹ãƒšãƒ«ã‚·ã‚¹ãƒ†ãƒ ã‚’ä¸€å…ƒç®¡ç† | 2026-02-13 |
| 2 | ã‚·ã‚°ãƒŠãƒ«ãƒªãƒ¬ãƒ¼æ•´å‚™ | æ¨ªæ–­çš„ã‚·ã‚°ãƒŠãƒ«æ¥ç¶š 12ç®‡æ‰€ â†’ 2ç®‡æ‰€ï¼ˆ83%å‰Šæ¸›ï¼‰ | 2026-02-14 |
| 3-B | BoardSystem3D SSoT åŒ– | creature_updated ã‚·ã‚°ãƒŠãƒ«ãƒã‚§ãƒ¼ãƒ³ã€UIè‡ªå‹•æ›´æ–° | 2026-02-14 |
| 3-A | SPH Strategy ãƒ‘ã‚¿ãƒ¼ãƒ³åŒ– | 22 Strategies, 109 effect_types | 2026-02-15 |
| 4 | SPH è²¬å‹™åˆ†é›¢ | 5ã‚µãƒ–ãƒ•ã‚§ãƒ¼ã‚ºã€~280è¡Œå‰Šæ¸› | 2026-02-15 |

### Phase 5: æ®µéšçš„æœ€é©åŒ–ï¼ˆ2026-02-16ï¼‰

| ã‚µãƒ–ãƒ•ã‚§ãƒ¼ã‚º | å†…å®¹ | æˆæœ |
|------------|------|------|
| 5-1 | SpellUIManager æ–°è¦ä½œæˆ | 274è¡Œã€14ãƒ¡ã‚½ãƒƒãƒ‰ |
| 5-2 | CPUSpellAIContainer æ–°è¦ä½œæˆ | 79è¡Œã€4ãƒ¡ã‚½ãƒƒãƒ‰ |
| 5-3 | ã‚°ãƒ«ãƒ¼ãƒ—3é‡è¤‡å‚ç…§å‰Šé™¤ | 25è¡Œå‰Šæ¸› |
| 5-5 | GameSystemManager æœ€é©åŒ– | 35è¡Œå‰Šæ¸› |

### Phase 6: å®Œå…¨UIå±¤åˆ†é›¢ï¼ˆ2026-02-17ï¼‰

| ã‚µãƒ–ãƒ•ã‚§ãƒ¼ã‚º | å†…å®¹ | Signalæ•° |
|------------|------|---------|
| 6-A | SpellPhaseHandler UI Signalåˆ†é›¢ | 16 Signalsï¼ˆSpellFlow 11 + MysticArts 5ï¼‰ |
| 6-B | DicePhaseHandler UIåˆ†é›¢ | 8 Signals |
| 6-C | Toll + Discard + Bankruptcy UIåˆ†é›¢ | 9 Signalsï¼ˆToll 2 + Discard 2 + Bankruptcy 5ï¼‰ |

### Phase 7: ä¾å­˜é€†è»¢ï¼ˆ2026-02-17ï¼‰

| ã‚µãƒ–ãƒ•ã‚§ãƒ¼ã‚º | å†…å®¹ | æˆæœ |
|------------|------|------|
| 7-A | CPU AI ãƒ‘ã‚¹ã‚¹ãƒ«ãƒ¼é™¤å» | SPHâ†’CPU AI ãƒã‚§ãƒ¼ãƒ³ã‚¢ã‚¯ã‚»ã‚¹è§£æ¶ˆã€ç›´æ¥æ³¨å…¥ |
| 7-B | SPH UIä¾å­˜é€†è»¢ | spell_ui_manager ç›´æ¥å‘¼ã³å‡ºã—ã‚¼ãƒ­ |

### Phase 8: UIManager ä¾å­˜æ–¹å‘ã®æ­£è¦åŒ–ï¼ˆ2026-02-18ï¼‰

| ã‚µãƒ–ãƒ•ã‚§ãƒ¼ã‚º | å†…å®¹ | æˆæœ |
|------------|------|------|
| 8-F | UIManager å†…éƒ¨4ã‚µãƒ¼ãƒ“ã‚¹åˆ†å‰² | NavigationService, MessageService, CardSelectionService, InfoPanelService |
| 8-G | ãƒ˜ãƒ«ãƒ‘ãƒ¼ ã‚µãƒ¼ãƒ“ã‚¹ç›´æ¥æ³¨å…¥ï¼ˆ5/6ï¼‰ | CSH 63%æ¸›ã€LAH 67%æ¸› |
| 8-A | ItemPhaseHandler SignalåŒ– | 4 Signalsã€ui_managerå®Œå…¨å‰Šé™¤ |
| 8-B | DominioCommandHandler ã‚µãƒ¼ãƒ“ã‚¹æ³¨å…¥ | 90â†’49 refsï¼ˆ46%å‰Šæ¸›ï¼‰ |
| 8-E | å…„å¼Ÿã‚·ã‚¹ãƒ†ãƒ  ã‚µãƒ¼ãƒ“ã‚¹æ³¨å…¥ | TileActionProcessor 74%ã€BattleSystem 100%å‰Šæ¸› |
| 8-I | ã‚¿ã‚¤ãƒ«ç³» contextçµŒç”±ã‚µãƒ¼ãƒ“ã‚¹ | 6ã‚¿ã‚¤ãƒ«å®Œäº† |
| 8-J | Spellç³» ã‚µãƒ¼ãƒ“ã‚¹æ³¨å…¥ | 3ãƒ•ã‚¡ã‚¤ãƒ«å®Œäº† |
| 8-K | ç§»å‹•ç³» ã‚µãƒ¼ãƒ“ã‚¹ç§»è¡Œ | 3ãƒ•ã‚¡ã‚¤ãƒ«ã€movement_controller ui_managerå®Œå…¨å‰Šé™¤ |
| 8-L | å°è¦æ¨¡ãƒ•ã‚¡ã‚¤ãƒ« ã‚µãƒ¼ãƒ“ã‚¹æ³¨å…¥ | lap_system, cpu_turn_processor, target_ui_helper |
| 8-N | STSH + LSH ã‚µãƒ¼ãƒ“ã‚¹æ³¨å…¥ | 28â†’18 refs, 9â†’2 refs |
| 8-O | SMA + DC ã‚µãƒ¼ãƒ“ã‚¹æ³¨å…¥ | 46â†’29 refs, 31â†’11 refs |
| 8-M | CardSelectionService SSoTåŒ– | ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£é‡è¤‡è§£æ¶ˆã€card_selectedçµ±ä¸€ |
| 8-P | Spellç³» 3æ®µãƒã‚§ãƒ¼ãƒ³è§£æ¶ˆ | 4ãƒ•ã‚¡ã‚¤ãƒ«ã€68â†’~34 refs |
| 8-D2 | private ã‚¢ã‚¯ã‚»ã‚¹è§£æ¶ˆ | _ui_manager å¤–éƒ¨ã‚¢ã‚¯ã‚»ã‚¹ 0ä»¶ |

**Phase 8 åˆè¨ˆ**: ~182 refs â†’ ~94 refsï¼ˆ48%å‰Šæ¸›ï¼‰

### Phase 9: çŠ¶æ…‹ãƒ«ãƒ¼ã‚¿ãƒ¼è§£ä½“ï¼ˆ2026-02-19ï¼‰

| ã‚µãƒ–ãƒ•ã‚§ãƒ¼ã‚º | å†…å®¹ | æˆæœ |
|------------|------|------|
| 9-A | ui_tap_handler is_nav_state_saved() ã‚¬ãƒ¼ãƒ‰è¿½åŠ  | ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯åˆ°é”ã‚¼ãƒ­ç¢ºèª |
| 9-B | restore_current_phase ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‰Šé™¤ | 58è¡Œâ†’1è¡Œã€spell_phase_handler_refå®Œå…¨å‰Šé™¤ |

### Phase 10-A: PlayerInfoService ã‚µãƒ¼ãƒ“ã‚¹åŒ–ï¼ˆ2026-02-19ï¼‰

| å†…å®¹ | æˆæœ |
|------|------|
| PlayerInfoService æ–°è¦ä½œæˆ | scripts/ui_services/player_info_service.gdï¼ˆæç”»æ›´æ–°ã®ã¿ï¼‰ |
| UIManager çµ±åˆ | 5ç•ªç›®ã®ã‚µãƒ¼ãƒ“ã‚¹ã¨ã—ã¦è¿½åŠ ã€Facadeãƒ¡ã‚½ãƒƒãƒ‰å‰Šé™¤ |
| å‘¼ã³å‡ºã—å…ƒå¤‰æ›´ | 16ãƒ•ã‚¡ã‚¤ãƒ«ãƒ»23ç®‡æ‰€ã‚’ player_info_service.update_panels() ã«å¤‰æ›´ |
| BankruptcyHandler Signal | PlayerInfoService çµŒç”±ã«å¤‰æ›´ |

### Phase 10-B: card.gd å†å¸°çš„è¦ªæ¢ç´¢å»ƒæ­¢ï¼ˆ2026-02-19ï¼‰

| å†…å®¹ | æˆæœ |
|------|------|
| find_ui_manager_recursive å®Œå…¨å‰Šé™¤ | æ¯ãƒã‚¦ã‚¹ã‚¤ãƒ™ãƒ³ãƒˆã®ãƒ„ãƒªãƒ¼å…¨ä½“å†å¸°æ¢ç´¢ã‚’è§£æ¶ˆ |
| Signal 2è¿½åŠ  | card_button_pressed, card_info_requested |
| 3å‚ç…§å¤‰æ•°æ³¨å…¥ | CardSelectionService, CardSelectionUI, GFM |
| hand_display Callable ãƒ‘ã‚¿ãƒ¼ãƒ³ | UIManager ã‚’çŸ¥ã‚‰ãšã« Signal æ¥ç¶š |
| ui_manager æ–°ãƒ¡ã‚½ãƒƒãƒ‰ | _on_card_info_from_hand() |
| å¤‰æ›´ãƒ•ã‚¡ã‚¤ãƒ« | card.gd, hand_display.gd, ui_manager.gdï¼ˆ3ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰ |

---

## å»¶æœŸãƒ»å–ã‚Šä¸‹ã’ãŸé …ç›®ã¨ç†ç”±

| é …ç›® | ç†ç”± |
|------|------|
| 8-H: UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆé€†å‚ç…§é™¤å» | ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„å¤‰æ›´ï¼ˆ2æ®µãƒã‚§ãƒ¼ãƒ³è¨±å®¹ï¼‰ã«ã‚ˆã‚Šå¤§éƒ¨åˆ†ä¸è¦ |
| 8-C: BankruptcyHandler ãƒ‘ãƒãƒ«åˆ†é›¢ | 56è¡Œã€5 SignalåŒ–æ¸ˆã¿ã€‚æŠ•è³‡å¯¾åŠ¹æœä½ |
| UIManager 200è¡ŒåŒ– | 47å§”è­²ãƒ¡ã‚½ãƒƒãƒ‰å‰Šé™¤ã¯47ãƒ•ã‚¡ã‚¤ãƒ«å¤‰æ›´ãŒå¿…è¦ã€‚ãƒªã‚¹ã‚¯å¯¾åŠ¹æœä¸é‡£ã‚Šåˆã„ |
| card.gd å†å¸°æ¢ç´¢è§£æ¶ˆ | 32ç®‡æ‰€ã®å¤§å¹…æ”¹ä¿®ãŒå¿…è¦ã€‚æ©Ÿèƒ½ã«å•é¡Œãªã— |
| tutorialç³»ç§»è¡Œ | ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã®å†è¨­è¨ˆãŒå‰æ |

---

## Phase 8 æœ€çµ‚è©•ä¾¡ï¼ˆGod Object åˆ†æï¼‰

### UIManager ã®ç¾çŠ¶ï¼ˆPhase 9 å¾Œï¼‰

```
UIManagerï¼ˆ~970è¡Œï¼‰
â”œâ”€ UIãƒ«ãƒ¼ãƒˆãƒãƒ¼ãƒ‰ç®¡ç†ï¼ˆåˆæœŸåŒ–ãƒ»ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆç”Ÿæˆï¼‰  âœ… æ­£å½“
â”œâ”€ äº’æ›ãƒ¬ã‚¤ãƒ¤ãƒ¼/Facadeï¼ˆ47å§”è­²ãƒ¡ã‚½ãƒƒãƒ‰ï¼‰            âš ï¸ ç§»è¡ŒæœŸæ®‹å­˜ç‰©
â”œâ”€ å…¥åŠ›ãƒ‡ã‚£ã‚¹ãƒ‘ãƒƒãƒãƒ£ãƒ¼ï¼ˆon_card_button_pressed 27è¡Œï¼‰âš ï¸ card.gd ä¾å­˜
â”œâ”€ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆç®¡ç†ãƒ¡ã‚½ãƒƒãƒ‰ ~30å€‹                   âœ… æ­£å½“
â””â”€ çŠ¶æ…‹ãƒ«ãƒ¼ã‚¿ãƒ¼ï¼ˆrestore_current_phaseï¼‰            âœ… Phase 9 ã§è§£ä½“æ¸ˆã¿
```

### UIManager å¾Œæ–¹å‚ç…§ï¼ˆ5ä»¶ï¼‰

| å‚ç…§å…ˆ | ç”¨é€” | å•é¡Œåº¦ |
|-------|------|--------|
| game_flow_manager_ref | on_card_button_pressed å…¥åŠ›ãƒ­ãƒƒã‚¯ã€UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆåˆæœŸåŒ– | ğŸ”´ |
| board_system_ref | UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆåˆæœŸåŒ–ï¼ˆ6ç®‡æ‰€ä»¥ä¸Šï¼‰ | ğŸ”´ |
| dominio_command_handler_ref | dominio_order_ui åˆæœŸåŒ– | ğŸŸ¡ |
| card_system_ref | Signalæ¥ç¶š | ğŸŸ¢ ç‰‡æ–¹å‘ |
| player_system_ref | update_player_info_panels | ğŸŸ¢ ç‰‡æ–¹å‘ |

### UIManager æœªã‚µãƒ¼ãƒ“ã‚¹åŒ–ãƒ¡ã‚½ãƒƒãƒ‰ï¼ˆæ®‹å­˜ï¼‰

| ãƒ¡ã‚½ãƒƒãƒ‰ | ä½¿ç”¨ãƒ•ã‚¡ã‚¤ãƒ«æ•° | ã‚µãƒ¼ãƒ“ã‚¹åŒ–å€™è£œ |
|---------|-------------|-------------|
| update_player_info_panels() | 8+ | PlayerInfoService |
| tap_target_manager | 2 | TapTargetService |
| on_card_button_pressed() | 1 (card.gd) | SignalåŒ– |
| show_dominio_order_button() / hide | 3 | DominioService |
| set_message() | 3 | MessageServiceæ‹¡å¼µ |
| show_win/lose_screen | 1 | GameResultService |
| toggle_debug_mode() | 1 | DebugService |
| show_level_up_ui() | 1 | LevelUpService |

---

## è¨­è¨ˆåˆ¶ç´„ï¼ˆå°†æ¥ä½œæ¥­ã§ã‚‚éµå®ˆï¼‰

1. **CardSelectionService ã®è²¬å‹™è‚¥å¤§åŒ–é˜²æ­¢**: ã‚«ãƒ¼ãƒ‰é¸æŠUIã®æ“ä½œä»£è¡Œã«é™å®šã€‚ãƒ•ã‚£ãƒ«ã‚¿åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯ã¯ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯å´
2. **PlayerInfoService ã¯æç”»æ›´æ–°ã®ã¿**: ã‚²ãƒ¼ãƒ ãƒ­ã‚¸ãƒƒã‚¯åˆ¤å®šã¯çµ¶å¯¾ã«æŒãŸã›ãªã„
3. **signal await ç§»è¡Œã¯1ãƒ•ã‚¡ã‚¤ãƒ«ãšã¤**: ä¸€æ‹¬ç½®æ›ç¦æ­¢ã€é¸æŠâ†’æ±ºå®š/ã‚­ãƒ£ãƒ³ã‚»ãƒ«ä¸¡ãƒ‘ã‚¹ç¢ºèª

---

## å‚ç…§ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- `docs/design/TREE_STRUCTURE.md` â€” ãƒ„ãƒªãƒ¼æ§‹é€ 
- `docs/design/dependency_map.md` â€” ä¾å­˜é–¢ä¿‚ãƒãƒƒãƒ—
- `docs/progress/refactoring_next_steps_2.md` â€” ä»Šå¾Œã®ä½œæ¥­è¨ˆç”»
