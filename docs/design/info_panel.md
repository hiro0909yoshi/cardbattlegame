# ã‚¤ãƒ³ãƒ•ã‚©ãƒ‘ãƒãƒ«ã‚·ã‚¹ãƒ†ãƒ 

**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.1  
**æœ€çµ‚æ›´æ–°**: 2025å¹´12æœˆ16æ—¥

---

## ğŸ“‹ ç›®æ¬¡

1. [æ¦‚è¦](#æ¦‚è¦)
2. [ãƒ‘ãƒãƒ«ä¸€è¦§](#ãƒ‘ãƒãƒ«ä¸€è¦§)
3. [ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ã‚¤ãƒ³ãƒ•ã‚©ãƒ‘ãƒãƒ«](#ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ã‚¤ãƒ³ãƒ•ã‚©ãƒ‘ãƒãƒ«)
4. [ã‚¹ãƒšãƒ«ã‚¤ãƒ³ãƒ•ã‚©ãƒ‘ãƒãƒ«](#ã‚¹ãƒšãƒ«ã‚¤ãƒ³ãƒ•ã‚©ãƒ‘ãƒãƒ«)
5. [ã‚¢ã‚¤ãƒ†ãƒ ã‚¤ãƒ³ãƒ•ã‚©ãƒ‘ãƒãƒ«](#ã‚¢ã‚¤ãƒ†ãƒ ã‚¤ãƒ³ãƒ•ã‚©ãƒ‘ãƒãƒ«)
6. [ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚¤ãƒ³ãƒ•ã‚©ãƒ‘ãƒãƒ«](#ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚¤ãƒ³ãƒ•ã‚©ãƒ‘ãƒãƒ«)
7. [å…±é€šè¨­è¨ˆãƒ‘ã‚¿ãƒ¼ãƒ³](#å…±é€šè¨­è¨ˆãƒ‘ã‚¿ãƒ¼ãƒ³)
8. [å®Ÿè£…ä¸Šã®æ³¨æ„ç‚¹](#å®Ÿè£…ä¸Šã®æ³¨æ„ç‚¹)

---

## æ¦‚è¦

ã‚¤ãƒ³ãƒ•ã‚©ãƒ‘ãƒãƒ«ã¯ã€ã‚«ãƒ¼ãƒ‰ã‚„ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®è©³ç´°æƒ…å ±ã‚’è¡¨ç¤ºã™ã‚‹UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆç¾¤ã€‚é¸æŠç¢ºèªæ©Ÿèƒ½ï¼ˆæ±ºå®š/æˆ»ã‚‹ãƒœã‚¿ãƒ³ï¼‰ã‚’çµ±åˆã—ã€1ã‚¯ãƒªãƒƒã‚¯ã§æƒ…å ±è¡¨ç¤ºâ†’æ±ºå®šãƒœã‚¿ãƒ³ã§ç¢ºå®šã¨ã„ã†æ“ä½œãƒ•ãƒ­ãƒ¼ã‚’å®Ÿç¾ã€‚

**å…±é€šãƒ‡ã‚¶ã‚¤ãƒ³**:
- å·¦å´: ã‚«ãƒ¼ãƒ‰ç”»åƒè¡¨ç¤º
- å³å´: è©³ç´°æƒ…å ±ï¼ˆç¾Šçš®ç´™é¢¨èƒŒæ™¯ï¼‰
- GlobalActionButtonsã¨é€£æºï¼ˆæ±ºå®š/æˆ»ã‚‹ãƒœã‚¿ãƒ³ï¼‰

---

## ãƒ‘ãƒãƒ«ä¸€è¦§

| ãƒ‘ãƒãƒ«å | ã‚·ãƒ¼ãƒ³ãƒ•ã‚¡ã‚¤ãƒ« | ã‚¹ã‚¯ãƒªãƒ—ãƒˆ | ç”¨é€” |
|---------|---------------|-----------|------|
| CreatureInfoPanel | `scenes/ui/creature_info_panel.tscn` | `creature_info_panel_ui.gd` | ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼è©³ç´°è¡¨ç¤ºãƒ»å¬å–š/ãƒãƒˆãƒ«ç¢ºèª |
| SpellInfoPanel | `scenes/ui/spell_info_panel.tscn` | `spell_info_panel_ui.gd` | ã‚¹ãƒšãƒ«è©³ç´°è¡¨ç¤ºãƒ»ä½¿ç”¨ç¢ºèª |
| ItemInfoPanel | `scenes/ui/item_info_panel.tscn` | `item_info_panel_ui.gd` | ã‚¢ã‚¤ãƒ†ãƒ è©³ç´°è¡¨ç¤ºãƒ»ä½¿ç”¨ç¢ºèª |
| PlayerInfoPanel | - (ã‚³ãƒ¼ãƒ‰ã§ç”Ÿæˆ) | `player_info_panel.gd` | ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º |

---

## ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ã‚¤ãƒ³ãƒ•ã‚©ãƒ‘ãƒãƒ«

**è©³ç´°è¨­è¨ˆ**: [card_info_panels.md](card_info_panels.md#ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼æƒ…å ±ãƒ‘ãƒãƒ«)

### ç”¨é€”
- **å¬å–šãƒ•ã‚§ãƒ¼ã‚º**: å¬å–šã™ã‚‹ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ã®ç¢ºèª
- **ãƒãƒˆãƒ«ãƒ•ã‚§ãƒ¼ã‚º**: ãƒãƒˆãƒ«ã«å‡ºã™ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ã®ç¢ºèª
- **äº¤æ›ãƒ•ã‚§ãƒ¼ã‚º**: äº¤æ›ã™ã‚‹ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ã®ç¢ºèª
- **ã‚¢ã‚¤ãƒ†ãƒ ãƒ•ã‚§ãƒ¼ã‚º**: ã‚¢ã‚¤ãƒ†ãƒ ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼/æ´è­·ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ã®ç¢ºèª
- **é–²è¦§ãƒ¢ãƒ¼ãƒ‰**: ç›¤é¢ä¸Šã®ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼æƒ…å ±è¡¨ç¤ºï¼ˆã‚¿ãƒ¼ã‚²ãƒƒãƒˆé¸æŠæ™‚ãªã©ï¼‰

### è¡¨ç¤ºå†…å®¹
- åå‰ + ãƒ¬ã‚¢ãƒªãƒ†ã‚£
- å±æ€§
- ã‚³ã‚¹ãƒˆï¼ˆMP + å¿…è¦åœŸåœ°ï¼‰
- AP / HP
- èƒ½åŠ›ãƒ†ã‚­ã‚¹ãƒˆ

### ãƒ•ã‚¡ã‚¤ãƒ«
- **ã‚·ãƒ¼ãƒ³**: `scenes/ui/creature_info_panel.tscn`
- **ã‚¹ã‚¯ãƒªãƒ—ãƒˆ**: `scripts/ui_components/creature_info_panel_ui.gd`

### ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰
```gdscript
# é¸æŠãƒ¢ãƒ¼ãƒ‰ï¼ˆå¬å–š/ãƒãƒˆãƒ«æ™‚ï¼‰- æ±ºå®š/æˆ»ã‚‹ãƒœã‚¿ãƒ³ä»˜ã
show_selection_mode(creature_data: Dictionary, confirmation_text: String)

# é–²è¦§ãƒ¢ãƒ¼ãƒ‰ï¼ˆæƒ…å ±è¡¨ç¤ºã®ã¿ï¼‰- æˆ»ã‚‹ãƒœã‚¿ãƒ³ã®ã¿
show_view_mode(creature_data: Dictionary, tile_index: int, setup_buttons: bool)

# ãƒ‘ãƒãƒ«ã‚’é–‰ã˜ã‚‹
hide_panel(clear_buttons: bool = true)
```

### ã‚·ã‚°ãƒŠãƒ«
- `selection_confirmed(card_data)` - æ±ºå®šæ™‚
- `selection_cancelled` - ã‚­ãƒ£ãƒ³ã‚»ãƒ«æ™‚
- `panel_closed` - ãƒ‘ãƒãƒ«é–‰ã˜ãŸæ™‚

### å‘¼ã³å‡ºã—å…ƒ
- `CardSelectionUI._show_creature_info_panel()` - å¬å–š/ãƒãƒˆãƒ«ç”¨
- `CardSelectionUI._show_creature_info_panel_for_item()` - ã‚¢ã‚¤ãƒ†ãƒ ãƒ•ã‚§ãƒ¼ã‚ºç”¨
- `SpellTargetSelection` - ã‚¿ãƒ¼ã‚²ãƒƒãƒˆé¸æŠæ™‚ã®é–²è¦§ç”¨
- `LandActionHelper` - ç§»å‹•å…ˆé¸æŠæ™‚ã®é–²è¦§ç”¨

---

## ã‚¹ãƒšãƒ«ã‚¤ãƒ³ãƒ•ã‚©ãƒ‘ãƒãƒ«

**è©³ç´°è¨­è¨ˆ**: [card_info_panels.md](card_info_panels.md#ã‚¹ãƒšãƒ«æƒ…å ±ãƒ‘ãƒãƒ«)

### ç”¨é€”
- **ã‚¹ãƒšãƒ«ãƒ•ã‚§ãƒ¼ã‚º**: ä½¿ç”¨ã™ã‚‹ã‚¹ãƒšãƒ«ã®ç¢ºèª

### è¡¨ç¤ºå†…å®¹
- åå‰ + ãƒ¬ã‚¢ãƒªãƒ†ã‚£
- ã‚³ã‚¹ãƒˆ
- ã‚¹ãƒšãƒ«ã‚¿ã‚¤ãƒ—ï¼ˆå¯¾è±¡ã‚¿ã‚¤ãƒ—ï¼‰
- åŠ¹æœãƒ†ã‚­ã‚¹ãƒˆ

### ãƒ•ã‚¡ã‚¤ãƒ«
- **ã‚·ãƒ¼ãƒ³**: `scenes/ui/spell_info_panel.tscn`
- **ã‚¹ã‚¯ãƒªãƒ—ãƒˆ**: `scripts/ui_components/spell_info_panel_ui.gd`

### ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰
```gdscript
# ã‚¹ãƒšãƒ«æƒ…å ±ãƒ‘ãƒãƒ«ã‚’è¡¨ç¤ºï¼ˆä½¿ç”¨ç¢ºèªãƒ¢ãƒ¼ãƒ‰ï¼‰
show_spell_info(spell_data: Dictionary, hand_index: int = -1)

# ãƒ‘ãƒãƒ«ã‚’é–‰ã˜ã‚‹
hide_panel(clear_buttons: bool = true)
```

### ã‚·ã‚°ãƒŠãƒ«
- `selection_confirmed(card_data)` - æ±ºå®šæ™‚
- `selection_cancelled` - ã‚­ãƒ£ãƒ³ã‚»ãƒ«æ™‚
- `panel_closed` - ãƒ‘ãƒãƒ«é–‰ã˜ãŸæ™‚

### å‘¼ã³å‡ºã—å…ƒ
- `CardSelectionUI._show_spell_info_panel()` - ã‚¹ãƒšãƒ«ãƒ•ã‚§ãƒ¼ã‚ºæ™‚

---

## ã‚¢ã‚¤ãƒ†ãƒ ã‚¤ãƒ³ãƒ•ã‚©ãƒ‘ãƒãƒ«

**è©³ç´°è¨­è¨ˆ**: [card_info_panels.md](card_info_panels.md#ã‚¢ã‚¤ãƒ†ãƒ æƒ…å ±ãƒ‘ãƒãƒ«)

### ç”¨é€”
- **ã‚¢ã‚¤ãƒ†ãƒ ãƒ•ã‚§ãƒ¼ã‚º**: ä½¿ç”¨ã™ã‚‹ã‚¢ã‚¤ãƒ†ãƒ ã®ç¢ºèª

### è¡¨ç¤ºå†…å®¹
- åå‰ + ãƒ¬ã‚¢ãƒªãƒ†ã‚£
- ã‚³ã‚¹ãƒˆ
- ã‚¢ã‚¤ãƒ†ãƒ ã‚¿ã‚¤ãƒ—ï¼ˆæ­¦å™¨/é˜²å…·/é“å…·/å·»ç‰©/ã‚¢ã‚¯ã‚»ã‚µãƒªï¼‰
- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å¤‰åŒ–ï¼ˆAP+X, HP+Xï¼‰
- åŠ¹æœãƒ†ã‚­ã‚¹ãƒˆ

### ãƒ•ã‚¡ã‚¤ãƒ«
- **ã‚·ãƒ¼ãƒ³**: `scenes/ui/item_info_panel.tscn`
- **ã‚¹ã‚¯ãƒªãƒ—ãƒˆ**: `scripts/ui_components/item_info_panel_ui.gd`

### ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰
```gdscript
# ã‚¢ã‚¤ãƒ†ãƒ æƒ…å ±ãƒ‘ãƒãƒ«ã‚’è¡¨ç¤ºï¼ˆä½¿ç”¨ç¢ºèªãƒ¢ãƒ¼ãƒ‰ï¼‰
show_item_info(item_data: Dictionary, hand_index: int = -1)

# ãƒ‘ãƒãƒ«ã‚’é–‰ã˜ã‚‹
hide_panel(clear_buttons: bool = true)
```

### ã‚·ã‚°ãƒŠãƒ«
- `selection_confirmed(card_data)` - æ±ºå®šæ™‚
- `selection_cancelled` - ã‚­ãƒ£ãƒ³ã‚»ãƒ«æ™‚
- `panel_closed` - ãƒ‘ãƒãƒ«é–‰ã˜ãŸæ™‚

### å‘¼ã³å‡ºã—å…ƒ
- `CardSelectionUI._show_item_info_panel()` - ã‚¢ã‚¤ãƒ†ãƒ ãƒ•ã‚§ãƒ¼ã‚ºæ™‚

### æ³¨æ„: ã‚¢ã‚¤ãƒ†ãƒ ãƒ•ã‚§ãƒ¼ã‚ºã§ã®ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼è¡¨ç¤º
ã‚¢ã‚¤ãƒ†ãƒ ãƒ•ã‚§ãƒ¼ã‚ºã§ã¯ä»¥ä¸‹ã®ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ã‚‚é¸æŠå¯èƒ½ï¼š
- **ã‚¢ã‚¤ãƒ†ãƒ ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼**: `SkillItemCreature.is_item_creature(card_data)`ã§åˆ¤å®š
- **æ´è­·ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼**: ãƒãƒˆãƒ«å‚åŠ ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ãŒæ´è­·ã‚¹ã‚­ãƒ«ã‚’æŒã¤å ´åˆ

ã“ã‚Œã‚‰ã¯**ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ã‚¤ãƒ³ãƒ•ã‚©ãƒ‘ãƒãƒ«**ã§è¡¨ç¤ºã™ã‚‹ï¼ˆç¢ºèªãƒ†ã‚­ã‚¹ãƒˆãŒå¤‰ã‚ã‚‹ï¼‰ã€‚

---

## ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚¤ãƒ³ãƒ•ã‚©ãƒ‘ãƒãƒ«

**è©³ç´°è¨­è¨ˆ**: [player_info_panel_redesign.md](player_info_panel_redesign.md)

### ç”¨é€”
- ç”»é¢ä¸Šéƒ¨ã«å¸¸æ™‚è¡¨ç¤º
- å„ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º

### è¡¨ç¤ºå†…å®¹
- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼å
- EPï¼ˆç¾åœ¨å€¤ï¼‰
- TEP
- åœŸåœ°æ•°
- ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼æ•°

### ãƒ•ã‚¡ã‚¤ãƒ«
- **ã‚¹ã‚¯ãƒªãƒ—ãƒˆ**: `scripts/ui_components/player_info_panel.gd`
- ã‚·ãƒ¼ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ãªã—ï¼ˆã‚³ãƒ¼ãƒ‰ã§å‹•çš„ç”Ÿæˆï¼‰

### ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰
```gdscript
# ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æƒ…å ±ã‚’æ›´æ–°
update_player_info(players: Array, player_system)

# ç¾åœ¨ã®ã‚¿ãƒ¼ãƒ³ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’è¨­å®šï¼ˆãƒã‚¤ãƒ©ã‚¤ãƒˆè¡¨ç¤ºï¼‰
set_current_turn(player_id: int)
```

---

## å…±é€šè¨­è¨ˆãƒ‘ã‚¿ãƒ¼ãƒ³

### UIManagerçµ±åˆ
å…¨ãƒ‘ãƒãƒ«ã¯`UIManager`ã§ç®¡ç†ã•ã‚Œã‚‹ï¼š
```gdscript
# UIManagerå¤‰æ•°
var creature_info_panel_ui: CreatureInfoPanelUI = null
var spell_info_panel_ui: SpellInfoPanelUI = null
var item_info_panel_ui: ItemInfoPanelUI = null
var player_info_panel = null
```

### ã‚·ãƒ¼ãƒ³æ§‹é€ ï¼ˆã‚«ãƒ¼ãƒ‰ç³»ãƒ‘ãƒãƒ«å…±é€šï¼‰
```
Panel (Control)
â”œâ”€â”€ MainContainer (HBoxContainer)
â”‚   â”œâ”€â”€ LeftPanel (Control) - ã‚«ãƒ¼ãƒ‰ç”»åƒè¡¨ç¤ºã‚¨ãƒªã‚¢
â”‚   â””â”€â”€ RightPanel (Control)
â”‚       â”œâ”€â”€ ParchmentBg (TextureRect) - ç¾Šçš®ç´™èƒŒæ™¯
â”‚       â””â”€â”€ ContentMargin (MarginContainer)
â”‚           â””â”€â”€ VBoxContainer
â”‚               â”œâ”€â”€ NameLabel
â”‚               â”œâ”€â”€ CostLabel
â”‚               â”œâ”€â”€ TypeLabel (Spell/Item) or ElementLabel (Creature)
â”‚               â”œâ”€â”€ HSeparator
â”‚               â””â”€â”€ EffectContainer
```

### ä½ç½®ï¼ˆçµ¶å¯¾åº§æ¨™ï¼‰
- offset_left: 137
- offset_top: 149
- `stretch/mode="viewport"`ã«ã‚ˆã‚Šè‡ªå‹•ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°

### ãƒœã‚¿ãƒ³é€£æº
`GlobalActionButtons`ã¨é€£æºï¼š
```gdscript
# é¸æŠãƒ¢ãƒ¼ãƒ‰æ™‚
ui_manager_ref.enable_navigation(
	func(): _on_confirm_action(),  # æ±ºå®š
	func(): _on_back_action()      # æˆ»ã‚‹
)

# ã¾ãŸã¯ register_global_actionsï¼ˆã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ãƒ‘ãƒãƒ«ï¼‰
ui_manager_ref.register_global_actions(confirm_callback, back_callback, confirm_text, back_text)
```

---

## å®Ÿè£…ä¸Šã®æ³¨æ„ç‚¹

### 1. ã‚«ãƒ¼ãƒ‰è¡¨ç¤ºã®ã‚¯ãƒªã‚¢
ãƒ‘ãƒãƒ«åˆ‡ã‚Šæ›¿ãˆæ™‚ã«å¤ã„ã‚«ãƒ¼ãƒ‰ãŒæ®‹ã‚‹å•é¡Œã‚’é˜²ããŸã‚ã€`remove_child()`ã§å³åº§ã«å‰Šé™¤ï¼š
```gdscript
if card_display and is_instance_valid(card_display):
	card_display.get_parent().remove_child(card_display)
	card_display.queue_free()
	card_display = null
```

### 2. ãƒ‘ãƒãƒ«åˆ‡ã‚Šæ›¿ãˆæ™‚ã®ç›¸äº’ã‚¯ãƒ­ãƒ¼ã‚º
ã‚¢ã‚¤ãƒ†ãƒ ãƒ•ã‚§ãƒ¼ã‚ºã§ã‚¢ã‚¤ãƒ†ãƒ â‡”ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼åˆ‡ã‚Šæ›¿ãˆæ™‚ã€ä»–æ–¹ã‚’é–‰ã˜ã‚‹ï¼š
```gdscript
# ã‚¢ã‚¤ãƒ†ãƒ ãƒ‘ãƒãƒ«è¡¨ç¤ºæ™‚
if ui_manager_ref.creature_info_panel_ui and ui_manager_ref.creature_info_panel_ui.is_visible_panel:
	ui_manager_ref.creature_info_panel_ui.hide_panel(false)
```

### 3. ã‚·ã‚°ãƒŠãƒ«æ¥ç¶šã®æ’ä»–åˆ¶å¾¡
ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ãƒ‘ãƒãƒ«ã¯å¬å–šç”¨ã¨ã‚¢ã‚¤ãƒ†ãƒ ç”¨ã§ç•°ãªã‚‹ãƒãƒ³ãƒ‰ãƒ©ã‚’ä½¿ç”¨ã€‚åˆ‡ã‚Šæ›¿ãˆæ™‚ã«ä¸€æ–¹ã‚’åˆ‡æ–­ï¼š
```gdscript
# ã‚¢ã‚¤ãƒ†ãƒ ç”¨è¡¨ç¤ºæ™‚ã€å¬å–šç”¨ã®ã‚·ã‚°ãƒŠãƒ«ã‚’åˆ‡æ–­
if creature_info_panel_connected:
	ui_manager_ref.creature_info_panel_ui.selection_confirmed.disconnect(_on_creature_panel_confirmed)
	creature_info_panel_connected = false
```

### 4. ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼IDç®¡ç†ï¼ˆé˜²è¡›å´å¯¾å¿œï¼‰
`CardSelectionUI`ã¯`current_selection_player_id`ã‚’ä¿å­˜ã—ã¦ã€é˜²è¡›å´ã‚¢ã‚¤ãƒ†ãƒ ãƒ•ã‚§ãƒ¼ã‚ºã§ã‚‚æ­£ã—ã„ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®æ‰‹æœ­ã‚’å‚ç…§ï¼š
```gdscript
# show_selection()ã§ä¿å­˜
current_selection_player_id = current_player.id

# _get_card_data_for_index()ã§ä½¿ç”¨
var hand_data = card_system_ref.get_all_cards_for_player(current_selection_player_id)
```

### 5. 1ã‚¯ãƒªãƒƒã‚¯æ±ºå®šå¯¾å¿œ
`card.gd`ã§æƒ…å ±ãƒ‘ãƒãƒ«è¡¨ç¤ºãŒå¿…è¦ãªã‚±ãƒ¼ã‚¹ã¯1ã‚¯ãƒªãƒƒã‚¯ã§å³`on_card_confirmed()`ã‚’å‘¼ã¶ï¼š
```gdscript
var is_creature_with_panel = card_type == "creature" and GameSettings.use_creature_info_panel
var is_spell_in_spell_phase = card_type == "spell" and _is_spell_phase_active()
var is_item_phase = _is_item_phase_active()

if is_creature_with_panel or is_spell_in_spell_phase or is_item_phase:
	select_card()
	on_card_confirmed()
```

---

## ã‚¹ãƒšãƒ«ä½¿ç”¨å¾Œã®æ‰‹æœ­é¸æŠæ™‚

ãƒã‚¤ã‚ºãƒ³ãƒã‚¤ãƒ³ãƒ‰ã€ã‚·ãƒ£ãƒƒã‚¿ãƒ¼ã€ã‚»ãƒ•ãƒˆç­‰ã®ã‚¹ãƒšãƒ«ä½¿ç”¨å¾Œã«æ•µæ‰‹æœ­ã‚„ãƒ‡ãƒƒã‚­ã‹ã‚‰ã‚«ãƒ¼ãƒ‰ã‚’é¸æŠã™ã‚‹éš›ã‚‚ã‚¤ãƒ³ãƒ•ã‚©ãƒ‘ãƒãƒ«ã‚’è¡¨ç¤ºã™ã‚‹ã€‚

### å¯¾è±¡ã‚¹ãƒšãƒ«

| ã‚¹ãƒšãƒ« | filter_mode | é¸æŠå¯¾è±¡ |
|--------|-------------|---------|
| ã‚·ãƒ£ãƒƒã‚¿ãƒ¼ | `destroy_item_spell` | æ•µæ‰‹æœ­ã®ã‚¢ã‚¤ãƒ†ãƒ /ã‚¹ãƒšãƒ« |
| ã‚¹ã‚¯ã‚¤ãƒ¼ã‚º | `destroy_any` | æ•µæ‰‹æœ­ã®å…¨ã‚«ãƒ¼ãƒ‰ |
| ã‚»ãƒ•ãƒˆ | `destroy_spell` | æ•µæ‰‹æœ­ã®ã‚¹ãƒšãƒ« |
| ãƒã‚¤ã‚ºãƒ³ãƒã‚¤ãƒ³ãƒ‰ | - | æ•µãƒ‡ãƒƒã‚­ä¸Šéƒ¨6æš |
| ãƒ•ã‚©ãƒ¼ã‚µã‚¤ãƒˆ | - | è‡ªãƒ‡ãƒƒã‚­ä¸Šéƒ¨6æš |
| ãƒ¡ã‚¿ãƒ¢ãƒ«ãƒ•ã‚©ã‚·ã‚¹ | `item_or_spell` | æ•µæ‰‹æœ­ã®ã‚¢ã‚¤ãƒ†ãƒ /ã‚¹ãƒšãƒ« |

### å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«

| ãƒ•ã‚¡ã‚¤ãƒ« | å½¹å‰² |
|---------|------|
| `scripts/card.gd` | ãƒ¯ãƒ³ã‚¯ãƒªãƒƒã‚¯åˆ¤å®šï¼ˆ`_is_handler_card_selection_active()`ï¼‰ |
| `scripts/ui_manager.gd` | ã‚«ãƒ¼ãƒ‰é¸æŠãƒãƒ³ãƒ‰ãƒ©ãƒ¼çµŒç”±ã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚° |
| `scripts/spells/card_selection_handler.gd` | ã‚¤ãƒ³ãƒ•ã‚©ãƒ‘ãƒãƒ«è¡¨ç¤ºãƒ»ç¢ºèªå‡¦ç† |

### ãƒ•ãƒ­ãƒ¼

1. ã‚«ãƒ¼ãƒ‰ã‚’ã‚¯ãƒªãƒƒã‚¯ â†’ `card.gd`ãŒ`_is_handler_card_selection_active()`ã§ãƒãƒ³ãƒ‰ãƒ©ãƒ¼é¸æŠä¸­ã‹åˆ¤å®š
2. ãƒãƒ³ãƒ‰ãƒ©ãƒ¼é¸æŠä¸­ãªã‚‰`ui_manager._on_card_button_pressed()`ãŒ`game_flow_manager.on_card_selected()`çµŒç”±ã§å‡¦ç†
3. `card_selection_handler`ã®`on_enemy_card_selected()`ç­‰ãŒå‘¼ã°ã‚Œã‚‹
4. `_request_card_confirmation()`ã§ã‚«ãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ—ã«å¿œã˜ãŸã‚¤ãƒ³ãƒ•ã‚©ãƒ‘ãƒãƒ«è¡¨ç¤º
5. ç¢ºèªãƒœã‚¿ãƒ³ â†’ ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å®Ÿè¡Œã€ã‚­ãƒ£ãƒ³ã‚»ãƒ« â†’ é¸æŠç”»é¢ã«æˆ»ã‚‹ï¼ˆæˆ»ã‚‹ãƒœã‚¿ãƒ³å†ç™»éŒ²ï¼‰

### æ³¨æ„ç‚¹

- ç•°ãªã‚‹ã‚«ãƒ¼ãƒ‰ã‚’é¸æŠã—ãŸå ´åˆã€æ—¢å­˜ãƒ‘ãƒãƒ«ã‚’é–‰ã˜ã¦ã‹ã‚‰æ–°ã—ã„ãƒ‘ãƒãƒ«ã‚’è¡¨ç¤ºï¼ˆ`_hide_all_info_panels(false)`ï¼‰
- ã‚­ãƒ£ãƒ³ã‚»ãƒ«æ™‚ã¯æˆ»ã‚‹ãƒœã‚¿ãƒ³ã‚’å†ç™»éŒ²ã—ã¦é¸æŠç”»é¢ã«æˆ»ã‚Œã‚‹ã‚ˆã†ã«ã™ã‚‹
- ãƒ‘ãƒãƒ«å†…ã®ã‚«ãƒ¼ãƒ‰è¡¨ç¤ºã¯`remove_child()`ã§å³åº§ã«å‰Šé™¤ï¼ˆ`queue_free()`ã ã‘ã§ã¯é…å»¶ã‚ã‚Šï¼‰

### é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [æ‰‹æœ­æ“ä½œã‚¹ãƒšãƒ«](spells/æ‰‹æœ­æ“ä½œ.md) - è©³ç´°ãªå®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³

---

## ã‚¤ãƒ³ãƒ•ã‚©ãƒ‘ãƒãƒ«ä¸€å…ƒåŒ–ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ï¼ˆé€²è¡Œä¸­ï¼‰

### å®Œäº†æ¸ˆã¿

#### Step 1-4: å‚ç…§ä¸€å…ƒåŒ–
- ã‚¤ãƒ³ãƒ•ã‚©ãƒ‘ãƒãƒ«å‚ç…§: 181ç®‡æ‰€ â†’ 35ç®‡æ‰€ï¼ˆ81%å‰Šæ¸›ï¼‰
- ui_managerã«çµ±åˆãƒ¡ã‚½ãƒƒãƒ‰è¿½åŠ : `show_card_info`, `show_card_selection`, `hide_all_info_panels`

#### ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ä¿å­˜/å¾©å…ƒ
- `save_navigation_state()` / `restore_navigation_state()` / `clear_navigation_saved_state()`
- ä¿å­˜å¯¾è±¡: 4æ–¹å‘ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ + special_button + ãƒ•ã‚§ãƒ¼ã‚ºã‚³ãƒ¡ãƒ³ãƒˆ
- `_hide_all_info_panels_raw()`: saved stateã‚’é€€é¿/å¾©å…ƒã—ã¤ã¤ãƒ‘ãƒãƒ«ã‚’é–‰ã˜ã‚‹

#### é–²è¦§ãƒ¢ãƒ¼ãƒ‰ã®å®Ÿè£…
- ã‚«ãƒ¼ãƒ‰ã‚¿ãƒƒãƒ— â†’ `show_card_info(setup_buttons=false)` â†’ Ã—ãƒœã‚¿ãƒ³ã§å…ƒã®çŠ¶æ…‹ã«å¾©å…ƒ
- ã‚«ãƒ¼ãƒ‰é¸æŠãƒ•ã‚§ãƒ¼ã‚ºä¸­ï¼ˆã‚¹ãƒšãƒ«/å¬å–š/ãƒãƒˆãƒ«/ã‚¢ã‚¤ãƒ†ãƒ ï¼‰: æ­£å¸¸å‹•ä½œ
- ã‚°ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚«ãƒ¼ãƒ‰ã®é–²è¦§: `_show_info_panel_only()`çµŒç”±ã§å¯¾å¿œ

#### ãƒ‰ãƒŸãƒ‹ã‚ªã‚³ãƒãƒ³ãƒ‰ä¸­ã®é–²è¦§ãƒ¢ãƒ¼ãƒ‰
- åœŸåœ°é¸æŠä¸­: Ã—ã§å¾©å…ƒOKï¼ˆ`_restore_current_phase` â†’ `dominio.restore_navigation()`ï¼‰
- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³é¸æŠä¸­: Ã—ã§å¾©å…ƒOKï¼ˆ`action_menu_ui.restore_navigation()`ï¼‰
- ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—/ç§»å‹•å…ˆ/åœ°å½¢/äº¤æ›: ãƒ†ã‚¹ãƒˆæ¸ˆã¿

### æœªè§£æ±ºã®è¨­è¨ˆèª²é¡Œ

#### show_card_info(setup_buttons=false)ã®äºŒé‡ç”¨é€”
- **é–²è¦§ãƒ¢ãƒ¼ãƒ‰**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚«ãƒ¼ãƒ‰ã‚¿ãƒƒãƒ— â†’ Ã—ãƒœã‚¿ãƒ³/save/ãƒ•ã‚§ãƒ¼ã‚ºã‚³ãƒ¡ãƒ³ãƒˆå¤‰æ›´ãŒå¿…è¦
- **è¡¨ç¤ºã®ä¸€éƒ¨**: ãƒ‰ãƒŸãƒ‹ã‚ªã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³é¸æŠæ™‚ã«ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼æƒ…å ±ã‚’è¡¨ç¤º â†’ ä¸Šè¨˜ã¯ä¸è¦
- ç¾çŠ¶: dominio_order_uiã®`show_action_menu`å†…ã§show_card_infoå¾Œã«ãƒ•ã‚§ãƒ¼ã‚ºã‚³ãƒ¡ãƒ³ãƒˆã‚’ä¸Šæ›¸ãã—ã¦å¯¾å‡¦
- ç†æƒ³: ã€Œè¡¨ç¤ºã®ã¿ãƒ¢ãƒ¼ãƒ‰ã€ã‚’show_card_infoã«è¿½åŠ ã™ã‚‹ã‹ã€ç›´æ¥ãƒ‘ãƒãƒ«ã®show_view_modeã‚’å‘¼ã¶

#### å¾©å…ƒæ–¹å¼ã®æ··åœ¨
- ã‚«ãƒ¼ãƒ‰é¸æŠUIç³»: `_restore_current_phase` â†’ `card_selection_ui.restore_phase_comment()`
- ãƒ‰ãƒŸãƒ‹ã‚ª: `_restore_current_phase` â†’ `dominio.restore_navigation()` + `dominio.restore_phase_comment()`
- ã‚µã‚¤ã‚³ãƒ­ãƒ•ã‚§ãƒ¼ã‚ºç­‰: `restore_navigation_state()`ï¼ˆsave/restoreãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰
- ç†æƒ³: å…¨ãƒ•ã‚§ãƒ¼ã‚ºãŒçµ±ä¸€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ï¼ˆrestore_navigation + restore_phase_commentï¼‰ã§å¾©å…ƒ

#### special_buttonã®visibleåˆ¶å¾¡
- `_update_button_states()`ã§`visible = _special_callback.is_valid()`ã‚’è¿½åŠ 
- ä»¥å‰ã¯disabledã®ã¿ã§visibleã¯å¤‰æ›´ã—ã¦ã„ãªã‹ã£ãŸãŸã‚ã€Dãƒœã‚¿ãƒ³ãŒè¦‹ãˆãŸã¾ã¾æ®‹ã‚‹å•é¡ŒãŒã‚ã£ãŸ

### é–¢é€£ã™ã‚‹å¤‰æ›´ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§
- `scripts/ui_manager.gd`: show_card_info, _hide_all_info_panels_raw, save/restore, _restore_current_phase
- `scripts/ui_components/card_selection_ui.gd`: saveè¿½åŠ ã€ã‚­ãƒ£ãƒ³ã‚»ãƒ«/ç¢ºèªæ™‚ã«clear
- `scripts/ui_components/global_action_buttons.gd`: special_button.visibleåˆ¶å¾¡è¿½åŠ 
- `scripts/ui_components/action_menu_ui.gd`: restore_navigation()è¿½åŠ 
- `scripts/ui_components/dominio_order_ui.gd`: show_action_menuã«ãƒ•ã‚§ãƒ¼ã‚ºã‚³ãƒ¡ãƒ³ãƒˆè¿½åŠ ã€_close_creature_info_panel_if_openã§ã‚³ãƒ¡ãƒ³ãƒˆã‚¯ãƒªã‚¢
- `scripts/ui_tap_handler.gd`: _close_info_panel_and_restore, is_card_selection_activeåˆ¤å®šè¿½åŠ 
- `scripts/card.gd`: _show_info_panel_onlyç°¡ç´ åŒ–ã€is_activeåˆ¤å®šè¿½åŠ 
- `scripts/game_flow/dominio_command_handler.gd`: restore_phase_commentè¿½åŠ ã€openæ™‚ã«clear_navigation_saved_state
- `scripts/game_flow/spell_phase_handler.gd`: ã‚¹ãƒšãƒ«ã‚«ãƒ¼ãƒ‰0æšæ™‚ã‚‚show_selectionå‘¼ã³å‡ºã—
- `scripts/ui_components/phase_display.gd`: get_current_action_prompt()è¿½åŠ 

---

## å¤‰æ›´å±¥æ­´

| æ—¥ä»˜ | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | å¤‰æ›´å†…å®¹ |
|------|-----------|---------|
| 2025/12/14 | 1.0 | åˆç‰ˆä½œæˆï¼ˆã‚¢ã‚¤ãƒ†ãƒ ã‚¤ãƒ³ãƒ•ã‚©ãƒ‘ãƒãƒ«è¿½åŠ ã«ä¼´ã„æ•´ç†ï¼‰ |
| 2025/12/16 | 1.1 | è©³ç´°è¨­è¨ˆã¸ã®ãƒªãƒ³ã‚¯è¿½åŠ  |
| 2025/12/17 | 1.2 | ã‚¹ãƒšãƒ«ä½¿ç”¨å¾Œã®æ‰‹æœ­é¸æŠæ™‚ã®ã‚¤ãƒ³ãƒ•ã‚©ãƒ‘ãƒãƒ«è¡¨ç¤ºã‚’è¿½åŠ  |
| 2026/02/12 | 2.0 | ã‚¤ãƒ³ãƒ•ã‚©ãƒ‘ãƒãƒ«ä¸€å…ƒåŒ–ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°é€²æ—ã‚’è¿½åŠ  |