# ğŸ® ã‚«ãƒ«ãƒ‰ã‚»ãƒ—ãƒˆé¢¨ã‚«ãƒ¼ãƒ‰ãƒãƒˆãƒ«ã‚²ãƒ¼ãƒ  - è¨­è¨ˆæ›¸

## ğŸ“‹ ç›®æ¬¡
1. [æ–°ã‚·ã‚¹ãƒ†ãƒ è©³ç´°ä»•æ§˜](#æ–°ã‚·ã‚¹ãƒ†ãƒ è©³ç´°ä»•æ§˜)
2. [é ˜åœ°ã‚³ãƒãƒ³ãƒ‰è©³ç´°](#é ˜åœ°ã‚³ãƒãƒ³ãƒ‰è©³ç´°)
3. [UIé…ç½®ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³](#uié…ç½®ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³)
4. [å°†æ¥è¨ˆç”»](#å°†æ¥è¨ˆç”»)
5. [é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](#é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ)

> **æ³¨**: åŸºæœ¬çš„ãªã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã€ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„ã€ãƒãƒˆãƒ«ãƒ•ãƒ­ãƒ¼ãªã©ã¯å„ãƒ¡ãƒ¢ãƒªãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯design.mdç‹¬è‡ªã®è©³ç´°ä»•æ§˜ã®ã¿ã‚’è¨˜è¼‰ã—ã¦ã„ã¾ã™ã€‚

---

## æ–°ã‚·ã‚¹ãƒ†ãƒ è©³ç´°ä»•æ§˜

### 1. ç¨®æ—ã‚·ã‚¹ãƒ†ãƒ 

#### æ¦‚è¦
ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ã«`race`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è¿½åŠ ã—ã€ç¨®æ—ãƒ™ãƒ¼ã‚¹ã®ã‚¹ã‚­ãƒ«åˆ¤å®šï¼ˆå¿œæ´ã‚¹ã‚­ãƒ«ãªã©ï¼‰ã‚’å¯èƒ½ã«ã™ã‚‹ã‚·ã‚¹ãƒ†ãƒ ã€‚

#### å®Ÿè£…ä¾‹
```json
{
  "id": 414,
  "race": "ã‚´ãƒ–ãƒªãƒ³"
}
```

**å®Ÿè£…æ¸ˆã¿**: ã‚´ãƒ–ãƒªãƒ³ç¨®æ—ï¼ˆ2ä½“ï¼‰ã§å¿œæ´ã‚¹ã‚­ãƒ«ã®å¯¾è±¡åˆ¤å®šã«ä½¿ç”¨
- ID: 414 - ã‚´ãƒ–ãƒªãƒ³
- ID: 445 - ãƒ¬ãƒƒãƒ‰ã‚­ãƒ£ãƒƒãƒ—ï¼ˆã‚´ãƒ–ãƒªãƒ³å…¨å“¡ã«AP+20ï¼‰

**å°†æ¥æ‹¡å¼µ**: ãƒ‰ãƒ©ã‚´ãƒ³ã€ã‚¢ãƒ³ãƒ‡ãƒƒãƒ‰ã€ãƒ‡ãƒ¼ãƒ¢ãƒ³ãªã©ä»–ç¨®æ—è¿½åŠ äºˆå®š

---

### 2. åŠ¹æœã‚·ã‚¹ãƒ†ãƒ  (EffectSystem)

#### æ¦‚è¦
ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å¤‰æ›´åŠ¹æœã‚’çµ±ä¸€ç®¡ç†ã™ã‚‹ã‚·ã‚¹ãƒ†ãƒ ã€‚

#### åŠ¹æœã®ç¨®é¡

**1. ãƒãƒˆãƒ«ä¸­ã®ã¿ã®åŠ¹æœ**
- ã‚¢ã‚¤ãƒ†ãƒ åŠ¹æœï¼ˆAP+30ã€HP+40ãªã©ï¼‰
- ãƒãƒˆãƒ«çµ‚äº†æ™‚ã«è‡ªå‹•å‰Šé™¤

**2. ä¸€æ™‚åŠ¹æœï¼ˆç§»å‹•ã§æ¶ˆãˆã‚‹ï¼‰**
- ã‚¹ãƒšãƒ«ã€Œãƒ–ãƒ¬ãƒƒã‚·ãƒ³ã‚°ã€ï¼ˆHP+10ï¼‰
- é ˜åœ°ã‚³ãƒãƒ³ãƒ‰ã§ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ç§»å‹•æ™‚ã«å‰Šé™¤

**3. æ°¸ç¶šåŠ¹æœï¼ˆç§»å‹•ã§æ¶ˆãˆãªã„ï¼‰**
- ãƒã‚¹ã‚°ãƒ­ãƒ¼ã‚¹ï¼ˆå…¨ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼MHP+5ï¼‰
- ãƒ‰ãƒŸãƒŠãƒ³ãƒˆã‚°ãƒ­ãƒ¼ã‚¹ï¼ˆç‰¹å®šå±æ€§MHP+10ï¼‰
- äº¤æ›æ™‚ã‚„ã‚²ãƒ¼ãƒ çµ‚äº†ã¾ã§ç¶­æŒ

**4. åœŸåœ°æ•°æ¯”ä¾‹åŠ¹æœ**
- ã‚¢ãƒ¼ãƒ ãƒ‰ãƒ‘ãƒ©ãƒ‡ã‚£ãƒ³ã€Œç«ã¨åœŸã®åœŸåœ°æ•°Ã—10ã€
- ãƒãƒˆãƒ«æ™‚ã«å‹•çš„è¨ˆç®—

#### ãƒ‡ãƒ¼ã‚¿æ§‹é€ 
```gdscript
creature_data = {
	"base_up_hp": 0,           # æ°¸ç¶šçš„ãªåŸºç¤HPä¸Šæ˜‡
	"base_up_ap": 0,           # æ°¸ç¶šçš„ãªåŸºç¤APä¸Šæ˜‡
	"permanent_effects": [],   # æ°¸ç¶šåŠ¹æœé…åˆ—
	"temporary_effects": [],   # ä¸€æ™‚åŠ¹æœé…åˆ—
	"map_lap_count": 0         # å‘¨å›ã‚«ã‚¦ãƒ³ãƒˆ
}

# åŠ¹æœã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
effect = {
	"type": "stat_bonus",
	"stat": "hp",              # ã¾ãŸã¯ "ap"
	"value": 10,
	"source": "spell",
	"source_name": "ãƒ–ãƒ¬ãƒƒã‚·ãƒ³ã‚°",
	"removable": true,         # æ‰“ã¡æ¶ˆã—å¯èƒ½ã‹
	"lost_on_move": true       # ç§»å‹•ã§æ¶ˆãˆã‚‹ã‹
}
```

#### ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰
```gdscript
# ã‚¹ãƒšãƒ«åŠ¹æœ
func add_spell_effect_to_creature(tile_index: int, effect: Dictionary)
func apply_mass_growth(player_id: int, bonus_hp: int = 5)
func apply_dominant_growth(player_id: int, element: String, bonus_hp: int = 10)

# åŠ¹æœå‰Šé™¤
func clear_temporary_effects_on_move(tile_index: int)
func remove_effects_from_creature(tile_index: int, removable_only: bool = true)
```

#### ability_parsedã®æ‹¡å¼µ

**åœŸåœ°æ•°æ¯”ä¾‹åŠ¹æœã®ä¾‹**:
```json
{
  "effects": [
	{
	  "effect_type": "land_count_multiplier",
	  "stat": "ap",
	  "elements": ["fire", "earth"],
	  "multiplier": 10
	}
  ]
}
```

**ã‚¢ã‚¤ãƒ†ãƒ åŠ¹æœã®ä¾‹**:
```json
{
  "effects": [
	{
	  "effect_type": "debuff_ap",
	  "value": 10
	},
	{
	  "effect_type": "buff_hp",
	  "value": 40
	}
  ]
}
```

è©³ç´°ã¯ `docs/design/effect_system.md` ã‚’å‚ç…§ã€‚

---

### 5. ãƒ€ã‚¦ãƒ³çŠ¶æ…‹ã‚·ã‚¹ãƒ†ãƒ 

#### æ¦‚è¦
åœŸåœ°ã§ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆå¬å–šã€ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ã€ç§»å‹•ã€äº¤æ›ï¼‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€ãã®åœŸåœ°ã¯ã€Œãƒ€ã‚¦ãƒ³çŠ¶æ…‹ã€ã«ãªã‚Šã€æ¬¡ã®ã‚¿ãƒ¼ãƒ³ã¾ã§å†åº¦é¸æŠã§ããªããªã‚‹ã€‚

#### ãƒ€ã‚¦ãƒ³çŠ¶æ…‹ã®è¨­å®šã‚¿ã‚¤ãƒŸãƒ³ã‚°
- å¬å–šå®Ÿè¡Œå¾Œ
- ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—å®Ÿè¡Œå¾Œ
- ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ç§»å‹•å®Ÿè¡Œå¾Œï¼ˆç§»å‹•å…ˆã®åœŸåœ°ï¼‰
- ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼äº¤æ›å®Ÿè¡Œå¾Œ

**ä¾‹å¤–: ä¸å±ˆã‚¹ã‚­ãƒ«**
- ä¸å±ˆã‚¹ã‚­ãƒ«ã‚’æŒã¤ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ãŒã„ã‚‹åœŸåœ°ã¯ã€ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å¾Œã‚‚ãƒ€ã‚¦ãƒ³çŠ¶æ…‹ã«ãªã‚‰ãªã„
- ä½•åº¦ã§ã‚‚é ˜åœ°ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œå¯èƒ½

#### ãƒ€ã‚¦ãƒ³çŠ¶æ…‹ã®è§£é™¤ã‚¿ã‚¤ãƒŸãƒ³ã‚°
- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒã‚¹ã‚¿ãƒ¼ãƒˆãƒã‚¹ã‚’é€šéã—ãŸã¨ã
- å…¨ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å…¨åœŸåœ°ã®ãƒ€ã‚¦ãƒ³çŠ¶æ…‹ãŒä¸€æ‹¬è§£é™¤ã•ã‚Œã‚‹

#### åˆ¶ç´„
- **ãƒ€ã‚¦ãƒ³çŠ¶æ…‹ã®åœŸåœ°ã¯é ˜åœ°ã‚³ãƒãƒ³ãƒ‰ã§é¸æŠã§ããªã„**
  - `get_player_owned_lands()`ã§ãƒ€ã‚¦ãƒ³çŠ¶æ…‹ã®åœŸåœ°ã‚’é™¤å¤–
  - UIä¸Šã§é¸æŠè‚¢ã¨ã—ã¦è¡¨ç¤ºã•ã‚Œãªã„
- ãƒ€ã‚¦ãƒ³çŠ¶æ…‹ã§ã‚‚ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ã¯é€šå¸¸é€šã‚Šæ©Ÿèƒ½ã™ã‚‹
  - ãƒãƒˆãƒ«ã®é˜²å¾¡å´ã¨ã—ã¦æ©Ÿèƒ½
  - é€šè¡Œæ–™ã¯ç™ºç”Ÿã™ã‚‹

#### å®Ÿè£…
```gdscript
# ãƒ€ã‚¦ãƒ³çŠ¶æ…‹ã®è¨­å®š
tile.set_down(true)

# ãƒ€ã‚¦ãƒ³çŠ¶æ…‹ã®ç¢ºèª
if tile.is_down():
	# é¸æŠä¸å¯

# ãƒ€ã‚¦ãƒ³çŠ¶æ…‹ã®è§£é™¤ï¼ˆã‚¹ã‚¿ãƒ¼ãƒˆé€šéæ™‚ï¼‰
movement_controller.clear_all_down_states_for_player(player_id)
```

#### ä¸å±ˆã‚¹ã‚­ãƒ«ã®å®Ÿè£…
```gdscript
# SkillSystem.gd
static func has_unyielding(creature_data: Dictionary) -> bool:
	if creature_data.is_empty():
		return false
	var ability_detail = creature_data.get("ability_detail", "")
	return "ä¸å±ˆ" in ability_detail

# ãƒ€ã‚¦ãƒ³çŠ¶æ…‹è¨­å®šæ™‚ã®ä¸å±ˆãƒã‚§ãƒƒã‚¯ï¼ˆå„ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å‡¦ç†ï¼‰
if tile.has_method("set_down_state"):
	var creature = tile.creature_data if tile.has("creature_data") else {}
	if not SkillSystem.has_unyielding(creature):
		tile.set_down_state(true)
	else:
		print("ä¸å±ˆã«ã‚ˆã‚Šãƒ€ã‚¦ãƒ³ã—ã¾ã›ã‚“")
```

**ä¸å±ˆæŒã¡ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ä¸€è¦§** (16ä½“):
- ç«: ã‚·ãƒ¼ãƒ«ãƒ‰ãƒ¡ã‚¤ãƒ‡ãƒ³(14), ã‚·ãƒ§ãƒƒã‚«ãƒ¼(18), ãƒãƒ¼ãƒ‰ãƒ¡ã‚¤ãƒ‡ãƒ³(28)
- æ°´: ã‚¨ã‚­ãƒãƒ€ãƒ¼ãƒ (113), ã‚«ãƒ¯ãƒ’ãƒ¡(117), ãƒã‚«ãƒ©(141)
- åœ°: ã‚­ãƒ£ãƒ—ãƒ†ãƒ³ã‚³ãƒƒã‚¯(207), ãƒ’ãƒ¼ãƒ©ãƒ¼(234), ãƒ”ã‚¯ã‚·ãƒ¼(235), ãƒ¯ãƒ¼ãƒ™ã‚¢(249)
- é¢¨: ã‚°ãƒ¬ãƒ¼ãƒˆãƒ‹ãƒ³ãƒã‚¹(312), ãƒˆãƒ¬ã‚¸ãƒ£ãƒ¼ãƒ¬ã‚¤ãƒ€ãƒ¼(331), ãƒãƒ¼ã‚·ãƒ£ãƒ«ãƒ¢ãƒ³ã‚¯(341), ãƒãƒƒãƒ‰ãƒãƒ¼ãƒ¬ã‚¯ã‚¤ãƒ³(342)
- ç„¡: ã‚¢ãƒ¼ã‚­ãƒ“ã‚·ãƒ§ãƒƒãƒ—(403), ã‚·ãƒ£ãƒ‰ã‚¦ã‚¬ã‚¤ã‚¹ãƒˆ(418)

#### ãƒ‡ãƒãƒƒã‚°ã‚³ãƒãƒ³ãƒ‰
- **Uã‚­ãƒ¼**: ç¾åœ¨ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å…¨åœŸåœ°ã®ãƒ€ã‚¦ãƒ³çŠ¶æ…‹ã‚’å³åº§ã«è§£é™¤
- ãƒ†ã‚¹ãƒˆç”¨ã®æ©Ÿèƒ½ï¼ˆæœ¬ç•ªã§ã¯ç„¡åŠ¹åŒ–äºˆå®šï¼‰

---

## é ˜åœ°ã‚³ãƒãƒ³ãƒ‰è©³ç´°

### åŸºæœ¬åˆ¶ç´„
1. **1ã‚¿ãƒ¼ãƒ³ã«1å›ã®ã¿å®Ÿè¡Œå¯èƒ½**
   - ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ã€ç§»å‹•ã€äº¤æ›ã®ã„ãšã‚Œã‹1ã¤ã®ã¿
   - å®Ÿè¡Œå¾Œã¯è‡ªå‹•çš„ã«ã‚¿ãƒ¼ãƒ³çµ‚äº†
   
2. **å¬å–šã¨é ˜åœ°ã‚³ãƒãƒ³ãƒ‰ã¯æ’ä»–çš„**
   - å¬å–šã‚’å®Ÿè¡Œã—ãŸå ´åˆã€é ˜åœ°ã‚³ãƒãƒ³ãƒ‰ã¯å®Ÿè¡Œã§ããªã„
   - é ˜åœ°ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ãŸå ´åˆã€å¬å–šã¯å®Ÿè¡Œã§ããªã„
   - ã©ã¡ã‚‰ã‹ä¸€æ–¹ã®ã¿é¸æŠå¯èƒ½

3. **ãƒ€ã‚¦ãƒ³çŠ¶æ…‹ã®åœŸåœ°ã¯é¸æŠä¸å¯**
   - ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å®Ÿè¡Œæ¸ˆã¿ã®åœŸåœ°ã¯æ¬¡ã®ã‚¿ãƒ¼ãƒ³ã¾ã§ä½¿ç”¨ä¸å¯
   - é¸æŠè‚¢ã¨ã—ã¦è¡¨ç¤ºã•ã‚Œãªã„
   - **ä¾‹å¤–**: ä¸å±ˆã‚¹ã‚­ãƒ«æŒã¡ã®ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ãŒã„ã‚‹åœŸåœ°ã¯ãƒ€ã‚¦ãƒ³ã—ãªã„ãŸã‚ã€ä½•åº¦ã§ã‚‚ä½¿ç”¨å¯èƒ½

### ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ãƒ•ãƒ­ãƒ¼
```
ç§»å‹•å®Œäº†
  â†“
é ˜åœ°ã‚³ãƒãƒ³ãƒ‰ãƒœã‚¿ãƒ³è¡¨ç¤ºï¼ˆäººé–“ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ã¿ï¼‰
  â†“
åœŸåœ°é¸æŠï¼ˆæ•°å­—ã‚­ãƒ¼1-0ï¼‰
  â”œâ”€ ãƒ€ã‚¦ãƒ³çŠ¶æ…‹ã®åœŸåœ°ã¯é¸æŠä¸å¯
  â””â”€ æ‰€æœ‰ã—ã¦ã„ã‚‹åœŸåœ°ã®ã¿é¸æŠå¯èƒ½
  â†“
ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼è¡¨ç¤ºï¼ˆå³å´ä¸­å¤®ãƒ‘ãƒãƒ«ï¼‰
  â”œâ”€ [L] ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—
  â”œâ”€ [M] ç§»å‹•
  â”œâ”€ [S] äº¤æ›
  â””â”€ [C] æˆ»ã‚‹ï¼ˆåœŸåœ°é¸æŠã«æˆ»ã‚‹ï¼‰
  â†“
ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—é¸æŠï¼ˆLã‚­ãƒ¼ï¼‰
  â†“
ãƒ¬ãƒ™ãƒ«é¸æŠç”»é¢è¡¨ç¤º
  â”œâ”€ ç¾åœ¨ãƒ¬ãƒ™ãƒ«è¡¨ç¤º
  â”œâ”€ Lv2-5é¸æŠãƒœã‚¿ãƒ³
  â”‚   â”œâ”€ ç´¯è¨ˆã‚³ã‚¹ãƒˆè¡¨ç¤º
  â”‚   â”‚   Lv1â†’2: 80G
  â”‚   â”‚   Lv1â†’3: 240G
  â”‚   â”‚   Lv1â†’4: 620G
  â”‚   â”‚   Lv1â†’5: 1200G
  â”‚   â””â”€ é­”åŠ›ä¸è¶³ã®ãƒœã‚¿ãƒ³ã¯ç„¡åŠ¹åŒ–
  â””â”€ [C] æˆ»ã‚‹ï¼ˆã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹ï¼‰
  â†“
ãƒ¬ãƒ™ãƒ«é¸æŠï¼ˆLv2-5ã„ãšã‚Œã‹ï¼‰
  â†“
ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—å®Ÿè¡Œ
  â”œâ”€ é­”åŠ›æ¶ˆè²»ï¼ˆç´¯è¨ˆã‚³ã‚¹ãƒˆï¼‰
  â”œâ”€ åœŸåœ°ãƒ¬ãƒ™ãƒ«æ›´æ–°
  â”œâ”€ ãƒ€ã‚¦ãƒ³çŠ¶æ…‹è¨­å®š
  â””â”€ UIæ›´æ–°
  â†“
ã‚¿ãƒ¼ãƒ³çµ‚äº†
```

**ãƒ¬ãƒ™ãƒ«ã‚³ã‚¹ãƒˆï¼ˆç´¯è¨ˆæ–¹å¼ï¼‰**:
```gdscript
const LEVEL_COSTS = {
	0: 0,
	1: 0,
	2: 80,      // Lv1â†’2: 80G
	3: 240,     // Lv1â†’3: 240G (80 + 160)
	4: 620,     // Lv1â†’4: 620G (80 + 160 + 380)
	5: 1200     // Lv1â†’5: 1200G (80 + 160 + 380 + 580)
}

// ã‚³ã‚¹ãƒˆè¨ˆç®—
var cost = LEVEL_COSTS[target_level] - LEVEL_COSTS[current_level]
```

**å®Ÿè£…ã‚¯ãƒ©ã‚¹**:
- `LandCommandHandler`: é ˜åœ°ã‚³ãƒãƒ³ãƒ‰ã®ãƒ­ã‚¸ãƒƒã‚¯
- `UIManager`: ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒ»ãƒ¬ãƒ™ãƒ«é¸æŠãƒ‘ãƒãƒ«ã®UI
- `GameFlowManager`: ã‚¿ãƒ¼ãƒ³çµ‚äº†å‡¦ç†

### ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ç§»å‹•ãƒ•ãƒ­ãƒ¼
```
é ˜åœ°ã‚³ãƒãƒ³ãƒ‰ â†’ ç§»å‹•ã‚’é¸æŠ
  â†“
ç§»å‹•å…ƒã®åœŸåœ°ã‚’é¸æŠï¼ˆãƒ€ã‚¦ãƒ³çŠ¶æ…‹é™¤å¤–ï¼‰
  â†“
éš£æ¥ã™ã‚‹ç§»å‹•å…ˆã‚’è¡¨ç¤º
  â”œâ”€ ç©ºãåœ°
  â”œâ”€ è‡ªåˆ†ã®åœŸåœ°ï¼ˆç§»å‹•ä¸å¯ï¼‰
  â””â”€ æ•µã®åœŸåœ°
  â†“
ç§»å‹•å…ˆã‚’é¸æŠï¼ˆâ†‘â†“ã‚­ãƒ¼ã§åˆ‡ã‚Šæ›¿ãˆï¼‰
  â†“
ã€ç©ºãåœ°ã¸ã®ç§»å‹•ã€‘
  - ç§»å‹•å…ƒãŒç©ºãåœ°ã«ãªã‚‹
  - ç§»å‹•å…ˆã«åœŸåœ°ç²å¾—
  - ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼é…ç½®
  - ãƒ€ã‚¦ãƒ³çŠ¶æ…‹è¨­å®š
  - ã‚¿ãƒ¼ãƒ³çµ‚äº†
  
ã€æ•µåœ°ã¸ã®ç§»å‹•ã€‘
  - ç§»å‹•å…ƒãŒç©ºãåœ°ã«ãªã‚‹
  - ãƒãƒˆãƒ«å®Ÿè¡Œ
  - å‹åˆ©: åœŸåœ°ç²å¾— + ãƒ€ã‚¦ãƒ³è¨­å®š
  - æ•—åŒ—: ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼æ¶ˆæ»…
  - ã‚¿ãƒ¼ãƒ³çµ‚äº†
```

**å®Ÿè£…ã‚¯ãƒ©ã‚¹**:
- `LandCommandHandler.execute_move_creature()`
- `LandCommandHandler.confirm_move()`

### ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼äº¤æ›ãƒ•ãƒ­ãƒ¼
```
é ˜åœ°ã‚³ãƒãƒ³ãƒ‰ â†’ äº¤æ›ã‚’é¸æŠ
  â†“
äº¤æ›å¯¾è±¡ã®åœŸåœ°ã‚’é¸æŠï¼ˆãƒ€ã‚¦ãƒ³çŠ¶æ…‹é™¤å¤–ï¼‰
  â†“
æ‰‹æœ­ã«ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ã‚«ãƒ¼ãƒ‰ãŒã‚ã‚‹ã‹ç¢ºèª
  â”œâ”€ ãªã— â†’ ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
  â””â”€ ã‚ã‚Š â†’ æ¬¡ã¸
  â†“
æ–°ã—ã„ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ã‚«ãƒ¼ãƒ‰ã‚’é¸æŠ
  â†“
å…ƒã®ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ã‚’æ‰‹æœ­ã«æˆ»ã™
  â†“
æ–°ã—ã„ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ã‚’å¬å–š
  - ã‚³ã‚¹ãƒˆæ”¯æ‰•ã„ï¼ˆmp Ã— 10Gï¼‰
  - åœŸåœ°ãƒœãƒ¼ãƒŠã‚¹é©ç”¨
  - åœŸåœ°ãƒ¬ãƒ™ãƒ«ç¶™æ‰¿
  - ãƒ€ã‚¦ãƒ³çŠ¶æ…‹è¨­å®š
  â†“
ã‚¿ãƒ¼ãƒ³çµ‚äº†
```

**å®Ÿè£…ã‚¯ãƒ©ã‚¹**:
- `LandCommandHandler.execute_swap_creature()`
- `TileActionProcessor.execute_swap()`

### åœŸåœ°é¸æŠã®æ“ä½œæ–¹æ³•
- **çŸ¢å°ã‚­ãƒ¼ï¼ˆâ†‘â†“â†â†’ï¼‰**: åœŸåœ°ã‚’åˆ‡ã‚Šæ›¿ãˆï¼ˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼‰
- **Enterã‚­ãƒ¼**: é¸æŠã‚’ç¢ºå®šã—ã¦ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã¸
- **æ•°å­—ã‚­ãƒ¼ï¼ˆ1-0ï¼‰**: è©²å½“ã™ã‚‹åœŸåœ°ã‚’å³åº§ã«ç¢ºå®š
- **C/Escapeã‚­ãƒ¼**: ã‚­ãƒ£ãƒ³ã‚»ãƒ«

### ã‚¢ã‚¯ã‚·ãƒ§ãƒ³é¸æŠ
- **Lã‚­ãƒ¼**: ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—
- **Mã‚­ãƒ¼**: ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ç§»å‹•
- **Sã‚­ãƒ¼**: ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼äº¤æ›
- **C/Escapeã‚­ãƒ¼**: å‰ç”»é¢ã«æˆ»ã‚‹

---

## UIé…ç½®ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

### å…¨ç”»é¢å¯¾å¿œã®åŸå‰‡
**ã™ã¹ã¦ã®UIè¦ç´ ã¯ã€ç”»é¢è§£åƒåº¦ã«ä¾å­˜ã—ãªã„ç›¸å¯¾çš„ãªé…ç½®ã‚’ä½¿ç”¨ã™ã‚‹ã€‚**

#### æ¨å¥¨ãƒ‘ã‚¿ãƒ¼ãƒ³
```gdscript
// âœ… GOOD: viewport_sizeã‚’ä½¿ç”¨ã—ãŸç›¸å¯¾é…ç½®
var viewport_size = get_viewport().get_visible_rect().size
var panel_x = viewport_size.x - panel_width - 20  # å³ç«¯ã‹ã‚‰20px
var panel_y = (viewport_size.y - panel_height) / 2  # ç”»é¢ä¸­å¤®
```

#### éæ¨å¥¨ãƒ‘ã‚¿ãƒ¼ãƒ³
```gdscript
// âŒ BAD: çµ¶å¯¾åº§æ¨™æŒ‡å®š
panel.position = Vector2(1200, 100)  # ç”»é¢ã‚µã‚¤ã‚ºãŒå¤‰ã‚ã‚‹ã¨ç ´ç¶»
```

### é…ç½®ãƒ«ãƒ¼ãƒ«
1. **æ°´å¹³æ–¹å‘**
   - å·¦å¯„ã›: `margin`
   - ä¸­å¤®æƒãˆ: `(viewport_size.x - width) / 2`
   - å³å¯„ã›: `viewport_size.x - width - margin`

2. **å‚ç›´æ–¹å‘**
   - ä¸Šå¯„ã›: `margin`
   - ä¸­å¤®æƒãˆ: `(viewport_size.y - height) / 2`
   - ä¸‹å¯„ã›: `viewport_size.y - height - margin`

3. **ãƒãƒ¼ã‚¸ãƒ³**
   - ç”»é¢ç«¯ã‹ã‚‰ã®ä½™ç™½: 10-20pxæ¨å¥¨
   - UIè¦ç´ é–“ã®ä½™ç™½: 5-10pxæ¨å¥¨

### UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆé…ç½®ä¾‹

#### ActionMenuPanel
```gdscript
# ç”»é¢å³å´ä¸­å¤®ã«é…ç½®
var viewport_size = get_viewport().get_visible_rect().size
var panel_x = viewport_size.x - panel_width - 20
var panel_y = (viewport_size.y - panel_height) / 2
```
- **ä½ç½®**: ç”»é¢å³å´ä¸­å¤®
- **ã‚µã‚¤ã‚º**: 200x320px

#### LevelSelectionPanel
```gdscript
# ActionMenuPanelã¨åŒã˜ä½ç½®
var viewport_size = get_viewport().get_visible_rect().size
var panel_x = viewport_size.x - panel_width - 20
var panel_y = (viewport_size.y - panel_height) / 2
```
- **ä½ç½®**: ç”»é¢å³å´ä¸­å¤®
- **ã‚µã‚¤ã‚º**: 250x400px

---

## å°†æ¥è¨ˆç”»

### åˆ†å²è·¯ã‚·ã‚¹ãƒ†ãƒ è¨­è¨ˆæ¡ˆ

#### ãƒãƒƒãƒ—è¨­è¨ˆã®é€²åŒ–
```
ç¾åœ¨ï¼ˆè±å½¢1å‘¨ï¼‰        å°†æ¥ï¼ˆè‡ªç”±åˆ†å²ï¼‰
	 â—‡                      â—‡
	â—‡ â—‡                    â•± â•²
   â—‡   â—‡                  â—‡   â—‡
  â—‡     â—‡      â†’         â”‚   â”‚
   â—‡   â—‡                  â—‡â•â•â•â—‡
	â—‡ â—‡                    â•² â•±
	 â—‡                      â—‡
```

#### ã‚¿ã‚¤ãƒ«ã®æ¥ç¶šæƒ…å ±
```gdscript
# ã‚¿ã‚¤ãƒ«ã®æ¥ç¶šæƒ…å ±
{
  "index": 5,
  "connections": [4, 6, 12],  # 3æ–¹å‘ã«åˆ†å²
  "junction_type": "T-junction"  # åå­—è·¯ãƒ»Tå­—è·¯
}
```

#### TileNeighborSystemã®æ‹¡å¼µ
- åå­—è·¯ãƒ»Tå­—è·¯: 4æ–¹å‘ä»¥ä¸Šã®éš£æ¥ã«ã‚‚å¯¾å¿œæ¸ˆã¿
- ç«‹ä½“äº¤å·®: Yè»¸ã‚‚è€ƒæ…®å¯èƒ½ï¼ˆå°†æ¥ï¼‰
- éãƒ«ãƒ¼ãƒ—æ§‹é€ : åˆ†å²ã®ã‚ã‚‹ãƒãƒƒãƒ—ã«å¯¾å¿œå¯èƒ½

---

## é‡è¦ãªè¨­è¨ˆä¸Šã®æ³¨æ„ç‚¹

### ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å‡¦ç†ãƒ•ãƒ©ã‚°ã®ç®¡ç†

#### å•é¡Œ: äºŒé‡ç®¡ç†
1. **BoardSystem3D.is_waiting_for_action**
2. **TileActionProcessor.is_action_processing**

#### è§£æ±ºç­–ï¼ˆTECH-002ã§å®Œäº†ï¼‰
- TileActionProcessorã«çµ±ä¸€
- BoardSystem3Dã¯ã‚·ã‚°ãƒŠãƒ«è»¢é€ã®ã¿
- LandCommandHandlerã¯`complete_action()`çµŒç”±ã§é€šçŸ¥

### ã‚¿ãƒ¼ãƒ³çµ‚äº†å‡¦ç†ã®ç®¡ç†

#### è²¬ä»»ã‚¯ãƒ©ã‚¹
`GameFlowManager` (scripts/game_flow_manager.gd)

#### æ­£å¸¸ãªå‘¼ã³å‡ºã—ãƒã‚§ãƒ¼ãƒ³
```
TileActionProcessor (_complete_action)
  â””â”€ emit_signal("action_completed")
	 â”‚
	 â†“
BoardSystem3D (_on_action_completed)
  â””â”€ emit_signal("tile_action_completed")
	 â”‚
	 â†“
GameFlowManager (_on_tile_action_completed_3d)
  â””â”€ end_turn()
	 â””â”€ emit_signal("turn_ended")
```

#### é‡è¤‡å®Ÿè¡Œé˜²æ­¢æ©Ÿæ§‹ï¼ˆ3æ®µéšï¼‰
1. BoardSystem3D: `is_waiting_for_action`ãƒ•ãƒ©ã‚°ãƒã‚§ãƒƒã‚¯
2. GameFlowManager: ãƒ•ã‚§ãƒ¼ã‚ºãƒã‚§ãƒƒã‚¯ï¼ˆEND_TURN/SETUPæ™‚ã¯ç„¡è¦–ï¼‰
3. end_turn(): å†å…¥é˜²æ­¢ãƒã‚§ãƒƒã‚¯

### ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–é †åº

#### æ­£ã—ã„åˆæœŸåŒ–é †åºï¼ˆgame_3d.gdï¼‰
```gdscript
func _ready():
	# 1. ã‚·ã‚¹ãƒ†ãƒ ä½œæˆ
	
	# 2. UIManagerè¨­å®š
	ui_manager.board_system_ref = board_system_3d
	ui_manager.player_system_ref = player_system
	ui_manager.card_system_ref = card_system
	ui_manager.create_ui(self)  # â† CardSelectionUIç­‰ã‚’åˆæœŸåŒ–
	
	# 3. æ‰‹æœ­UIåˆæœŸåŒ–
	var ui_layer = get_node_or_null("UILayer")
	if ui_layer:
		ui_manager.initialize_hand_container(ui_layer)
		ui_manager.connect_card_system_signals()
	
	# 4. ãƒ‡ãƒãƒƒã‚°ãƒ•ãƒ©ã‚°è¨­å®šï¼ˆé‡è¦ï¼setup_systemsã‚ˆã‚Šå‰ï¼‰
	game_flow_manager.debug_manual_control_all = debug_manual_control_all
	
	# 5. GameFlowManagerè¨­å®š
	game_flow_manager.setup_systems(player_system, card_system, board_system_3d, 
									skill_system, ui_manager, battle_system, special_tile_system)
	game_flow_manager.setup_3d_mode(board_system_3d, player_is_cpu)
	
	# 6. CardSelectionUIã¸ã®å‚ç…§å†è¨­å®šï¼ˆé‡è¦ï¼ï¼‰
	if ui_manager.card_selection_ui:
		ui_manager.card_selection_ui.game_flow_manager_ref = game_flow_manager
```

#### ãªãœå‚ç…§å†è¨­å®šãŒå¿…è¦ã‹
- `create_ui()`æ™‚ç‚¹ã§ã¯GameFlowManagerã®å‚ç…§ãŒã¾ã ãªã„
- `setup_systems()`ã§UIManagerã«å‚ç…§ãŒè¨­å®šã•ã‚Œã‚‹
- ãã®å¾Œã€å­ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«æ˜ç¤ºçš„ã«å†è¨­å®šãŒå¿…è¦

---

## é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¨è©³ç´°ä»•æ§˜ã‚’ç¤ºã™ãƒã‚¹ã‚¿ãƒ¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã™ã€‚
å„ã‚·ã‚¹ãƒ†ãƒ ã®åŸºæœ¬ä»•æ§˜ã‚„ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„ã«ã¤ã„ã¦ã¯ã€ãƒ¡ãƒ¢ãƒªãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

### ã‚·ã‚¹ãƒ†ãƒ è¨­è¨ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

#### ã‚¹ã‚­ãƒ«ã‚·ã‚¹ãƒ†ãƒ 
- **[skills_design.md](skills_design.md)** - ã‚¹ã‚­ãƒ«ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“è¨­è¨ˆ
  - å®Ÿè£…æ¸ˆã¿ã‚¹ã‚­ãƒ«ä¸€è¦§ï¼ˆ18ç¨®é¡ï¼‰
  - ã‚¹ã‚­ãƒ«é©ç”¨é †åºã¨ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£
  - å°†æ¥å®Ÿè£…äºˆå®šã®ã‚¹ã‚­ãƒ«

#### å€‹åˆ¥ã‚¹ã‚­ãƒ«ä»•æ§˜æ›¸ï¼ˆ14ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰

**å®Ÿè£…æ¸ˆã¿ã‚¹ã‚­ãƒ«:**
1. [assist_skill.md](skills/assist_skill.md) - å¿œæ´ã‚¹ã‚­ãƒ«
2. [double_attack_skill.md](skills/double_attack_skill.md) - 2å›æ”»æ’ƒã‚¹ã‚­ãƒ«
3. [first_strike_skill.md](skills/first_strike_skill.md) - å…ˆåˆ¶ã‚¹ã‚­ãƒ«
4. [indomitable_skill.md](skills/indomitable_skill.md) - ä¸å±ˆã‚¹ã‚­ãƒ«
5. [instant_death_skill.md](skills/instant_death_skill.md) - å³æ­»ã‚¹ã‚­ãƒ«
6. [nullify_skill.md](skills/nullify_skill.md) - ç„¡åŠ¹åŒ–ã‚¹ã‚­ãƒ«
7. [penetration_skill.md](skills/penetration_skill.md) - è²«é€šã‚¹ã‚­ãƒ«
8. [power_strike_skill.md](skills/power_strike_skill.md) - å¼·æ‰“ã‚¹ã‚­ãƒ«
9. [reflect_skill.md](skills/reflect_skill.md) - åå°„ã‚¹ã‚­ãƒ«
10. [regeneration_skill.md](skills/regeneration_skill.md) - å†ç”Ÿã‚¹ã‚­ãƒ«
11. [resonance_skill.md](skills/resonance_skill.md) - æ„Ÿå¿œã‚¹ã‚­ãƒ«
12. [scroll_attack_skill.md](skills/scroll_attack_skill.md) - å·»ç‰©æ”»æ’ƒã‚¹ã‚­ãƒ«
13. [support_skill.md](skills/support_skill.md) - æ´è­·ã‚¹ã‚­ãƒ«
14. [item_destruction_theft_skill.md](skills/item_destruction_theft_skill.md) - ã‚¢ã‚¤ãƒ†ãƒ ç ´å£Šãƒ»ç›—ã¿ã‚¹ã‚­ãƒ«
15. [transform_skill.md](skills/transform_skill.md) - å¤‰èº«ã‚¹ã‚­ãƒ«
16. [revive_skill.md](skills/revive_skill.md) - æ­»è€…å¾©æ´»ã‚¹ã‚­ãƒ«

#### ãã®ä»–ã®ã‚·ã‚¹ãƒ†ãƒ 
- **[effect_system.md](effect_system.md)** - ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚·ã‚¹ãƒ†ãƒ è¨­è¨ˆ
- **[effect_system_design.md](effect_system_design.md)** - ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚·ã‚¹ãƒ†ãƒ è©³ç´°è¨­è¨ˆ
- **[battle_test_tool_design.md](battle_test_tool_design.md)** - ãƒãƒˆãƒ«ãƒ†ã‚¹ãƒˆãƒ„ãƒ¼ãƒ«è¨­è¨ˆ
- **[turn_end_flow.md](turn_end_flow.md)** - ã‚¿ãƒ¼ãƒ³çµ‚äº†ãƒ•ãƒ­ãƒ¼
- **[defensive_creature_design.md](defensive_creature_design.md)** - é˜²å¾¡å‹ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼è¨­è¨ˆ

### å®Ÿè£…ãƒ»é€²æ—ç®¡ç†ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- **[docs/progress/](../progress/)** - å®Ÿè£…é€²æ—ã¨çŠ¶æ…‹ç®¡ç†
- **[docs/implementation/](../implementation/)** - å®Ÿè£…ä»•æ§˜æ›¸
- **[docs/issues/](../issues/)** - ã‚¿ã‚¹ã‚¯ç®¡ç†ã¨ãƒã‚°ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°
- **[docs/refactoring/](../refactoring/)** - ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°è¨˜éŒ²

---

## å¤‰æ›´å±¥æ­´

| æ—¥ä»˜ | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | å¤‰æ›´å†…å®¹ |
|------|-----------|---------|
| 2025/10/25 | 2.0 | å¤§å¹…ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°: é‡è¤‡å‰Šé™¤ã€è©³ç´°ä»•æ§˜ã®ã¿è¨˜è¼‰ |
| 2025/10/25 | 2.1 | å®Ÿè£…æ¸ˆã¿ã‚¹ã‚­ãƒ«è¿½åŠ : ã‚¢ã‚¤ãƒ†ãƒ ç ´å£Šãƒ»ç›—ã¿ã€å¤‰èº«ã€æ­»è€…å¾©æ´» |

---

**æœ€çµ‚æ›´æ–°**: 2025å¹´10æœˆ25æ—¥ï¼ˆv2.1 - ã‚¹ã‚­ãƒ«è¿½åŠ ï¼‰  
**é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**: 
- [skills_design.md](skills_design.md) - ã‚¹ã‚­ãƒ«ã‚·ã‚¹ãƒ†ãƒ è©³ç´°ä»•æ§˜
- ãƒ¡ãƒ¢ãƒªãƒ•ã‚¡ã‚¤ãƒ« - åŸºæœ¬ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ»ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„
