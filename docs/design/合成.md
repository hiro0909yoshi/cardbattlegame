# スペル合成

## 概要

スペル使用時にカードを犠牲にすることで、特定の条件を満たした場合に効果が強化されるシステム。

## 対象スペル

| ID | 名前 | 合成条件 | 合成効果 |
|----|------|----------|----------|
| 2003 | アステロイド | 同名カード | レベルを1にする |
| 2017 | エロージョン | 任意スペル | 全手札が対象 |
| 2030 | サブサイド | 同名カード | 全セプターが対象 |
| 2033 | シャイニングガイザー | 単体対象スペル | HP-40に強化 |
| 2055 | ディスエレメント | クリーチャー | ダウンした全クリーチャー対象 |
| 2058 | デビリティ | 任意スペル | MHP-20を追加 |
| 2107 | マスグロース | アイテム | 全自クリーチャーのみ対象 |

## 合成タイプ

| タイプ | 条件 |
|--------|------|
| same_card | 犠牲カードが使用スペルと同名 |
| any_spell | 犠牲カードがスペル |
| single_target_spell | 犠牲カードが単体対象スペル |
| creature | 犠牲カードがクリーチャー |
| item | 犠牲カードがアイテム |

## クラス構成

```
CardSacrificeHelper（共通）
  scripts/helpers/card_sacrifice_helper.gd
  - show_hand_selection() : 手札選択UI表示
  - consume_card() : カード破棄

SpellSynthesis（スペル専用）
  scripts/spells/spell_synthesis.gd
  - requires_sacrifice() : 犠牲が必要か判定
  - check_condition() : 合成条件判定
  - apply_overrides() : effect_parsed書き換え
```

## JSON定義（synthesisフィールド）

### overrideパターン

| パターン | 用途 | 例 |
|----------|------|-----|
| value_override | 数値変更 | シャイニングガイザー（30→40） |
| target_override | 対象範囲変更 | エロージョン、サブサイド |
| effects_add | 効果追加 | デビリティ（MHP-20追加） |
| effect_override | 効果置換 | アステロイド（change_level→set_level） |

### 例：シャイニングガイザー

```json
"synthesis": {
  "type": "single_target_spell",
  "value_override": 40
}
```

### 例：アステロイド

```json
"synthesis": {
  "type": "same_card",
  "effect_override": {
	"effect_type": "set_level",
	"value": 1
  }
}
```

## デバッグ

SpellPhaseHandlerに以下のフラグあり：

```gdscript
# カード犠牲を無効化（テスト用）
spell_phase_handler.debug_disable_card_sacrifice = true
```

## 実装状況

✅ 全て実装完了
