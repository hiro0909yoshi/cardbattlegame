# チュートリアルシステム設計

## 概要

通常のゲームシステムをベースに、チュートリアルモード時のみ操作を固定・ガイドするインタラクティブ型チュートリアル。

## 基本方針

- 通常のゲームフロー（GameFlowManager等）をそのまま使用
- チュートリアルモード時は特定の操作のみ許可
- 各ステップで説明テキストを表示（GlobalCommentUI活用）
- プレイヤーが正しい操作をしたら次のステップへ
- CPUの行動も固定（スクリプト化）

## 教える内容（ステップ順）

### Phase 1: ゲーム説明とUI確認
1. ゲームの勝利条件の説明
   - 目標魔力に到達して城に戻ると勝利
2. プレイヤーインフォパネルの説明（画面左上のパネル）
   - タップで詳細表示できることを教える
   - プレイヤーインフォの見方（魔力、領地数、手札数等）
3. ナビゲーションボタンの説明（✓で決定、✕で戻る/キャンセル）
   - 実際の操作を通じて慣れてもらう

### Phase 2: 基本操作
4. ダイスを振って移動する（✓ボタンで実行）
5. 空き地にクリーチャーを召喚する
   - 手札のカードをタップで選択
   - クリーチャーインフォパネルの見方（HP/ST/属性/スキル）
6. 領地ボーナス（属性一致でHP増加）の説明

### Phase 3: 戦闘とアイテム
7. 敵領地への侵入（バトル発生）
8. アイテムの使用方法
9. 通行料の支払い

### Phase 4: 領地管理
10. 領地コマンド（レベルアップ）
11. 周回ボーナス

### Phase 5: 応用（将来拡張）
- スペル使用
- 秘術使用
- その他高度なシステム

## チュートリアル専用マップ

### マップ要件
- 小さいサイズ（8〜12タイル程度）
- 単純な周回構造
- 各属性タイルを含む（火・水・地・風 各1〜2）
- 城タイル1つ

### マップ案（仮）
```
    [城]
   /    \
 [火]   [水]
  |      |
 [地]---[風]
   \    /
    [無]
```

## システム構成

### TutorialManager
チュートリアル全体を管理するクラス

```
TutorialManager
├── current_step: int          # 現在のステップ
├── tutorial_data: Dictionary  # ステップ定義データ
├── is_tutorial_mode: bool     # チュートリアルモードフラグ
│
├── start_tutorial()           # チュートリアル開始
├── advance_step()             # 次のステップへ
├── check_action_valid()       # 操作が許可されているか
├── show_guide_message()       # ガイドメッセージ表示
└── end_tutorial()             # チュートリアル終了
```

### 各ステップのデータ構造

```gdscript
var step_data = {
    "step_id": 1,
    "message": "ダイスを振って移動しましょう！\n✓ボタンを押してください",
    "allowed_actions": ["roll_dice"],      # 許可するアクション
    "expected_result": {},                  # 期待する結果（オプション）
    "highlight_elements": ["dice_button"], # ハイライトするUI要素
    "cpu_actions": [],                      # このステップでのCPU行動
    "on_complete": "advance"                # 完了時の動作
}
```

### 操作制限の実装方針

1. **GameFlowManager側でチェック**
   - 各入力処理の前に`TutorialManager.check_action_valid()`を呼ぶ
   - 許可されていない操作は無視またはガイドメッセージ表示

2. **UI側での視覚的ガイド**
   - 許可されたボタン/カードのみハイライト
   - 他はグレーアウトまたは非表示

### CPU行動の固定

```gdscript
var cpu_script = [
    {"turn": 1, "action": "pass_spell", "dice": 3, "summon": "goblin", "tile": 2},
    {"turn": 2, "action": "pass_spell", "dice": 2, "summon": null, "tile": null},
    # ...
]
```

- ダイス目も固定（チュートリアル用の固定ダイス）
- 召喚するクリーチャーも固定
- バトル時のアイテム使用も固定

## UI表示

### ガイドメッセージ
- `GlobalCommentUI`を活用
- 画面中央に大きく表示
- クリックまたは正しい操作で次へ

### ハイライト表示
- 操作すべきUI要素を強調（枠線、点滅等）
- 他の要素は暗くする

### 進行状況表示
- 「ステップ 1/8」のような表示
- スキップボタン（オプション）

## ファイル構成

```
scripts/
└── tutorial/
    ├── tutorial_manager.gd      # メイン管理クラス
    ├── tutorial_step.gd         # ステップデータクラス
    └── tutorial_ui.gd           # チュートリアル専用UI

data/
└── tutorial/
    ├── tutorial_steps.json      # ステップ定義
    └── tutorial_cpu_script.json # CPU行動スクリプト

scenes/
└── maps/
    └── tutorial_map.json        # チュートリアル専用マップ
```

## 実装順序

### Step 1: 基盤
- [ ] TutorialManager基本実装
- [ ] チュートリアルモードフラグ追加
- [ ] チュートリアル専用マップ作成

### Step 2: 操作制限
- [ ] GameFlowManagerに操作チェック追加
- [ ] 許可アクションのフィルタリング

### Step 3: ガイドUI
- [ ] ガイドメッセージ表示
- [ ] ハイライト表示
- [ ] 進行状況表示

### Step 4: CPU固定行動
- [ ] 固定ダイス実装
- [ ] CPUスクリプト実行

### Step 5: ステップ定義
- [ ] 各ステップのデータ作成
- [ ] テスト・調整

## 将来の拡張

- 複数のチュートリアルコース（初級/中級/上級）
- 特定システムだけ学ぶミニチュートリアル
- チュートリアル完了フラグの保存
- リプレイ機能
