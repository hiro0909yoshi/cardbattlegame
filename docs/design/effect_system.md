# åŠ¹æœã‚·ã‚¹ãƒ†ãƒ å®Ÿè£…ä»•æ§˜æ›¸

**ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ**: ã‚«ãƒ«ãƒ‰ã‚»ãƒ—ãƒˆé¢¨ã‚«ãƒ¼ãƒ‰ãƒãƒˆãƒ«ã‚²ãƒ¼ãƒ   
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 3.0  
**ä½œæˆæ—¥**: 2025å¹´10æœˆ21æ—¥  
**æ›´æ–°æ—¥**: 2025å¹´10æœˆ21æ—¥  
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: Phase 1-2å®Œäº†ã€Phase 3éƒ¨åˆ†å®Œäº†

---

## âš ï¸ å®Ÿè£…ã«å¿…è¦ãªæœªå®Ÿè£…æ©Ÿèƒ½

æ¡ä»¶ä»˜ããƒãƒ•ã‚¹ã‚­ãƒ«ã®å®Ÿè£…ã«ã¯ã€ä»¥ä¸‹ã®æ©Ÿèƒ½ãŒå¿…è¦ã§ã™ï¼ˆè©³ç´°ã¯ [required_features_for_buffs.md](./required_features_for_buffs.md) ã‚’å‚ç…§ï¼‰ï¼š

### ğŸ”´ å¿…é ˆï¼ˆæœªå®Ÿè£…ï¼‰
1. **ã‚¿ãƒ¼ãƒ³æ•°ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼** - ãƒ©ãƒ¼ãƒã‚­ãƒ³(47)ç”¨
2. **å‘¨å›å®Œäº†ã‚·ã‚°ãƒŠãƒ«** - ã‚­ãƒ¡ãƒ©(7), ãƒ¢ã‚¹ã‚¿ã‚¤ã‚¿ãƒ³(240)ç”¨
3. **åœŸåœ°ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—/åœ°å½¢å¤‰åŒ–ã‚¤ãƒ™ãƒ³ãƒˆ** - ã‚¢ãƒ¼ã‚¹ã‚ºãƒ”ãƒªãƒƒãƒˆ(200), ãƒ‡ãƒ¥ãƒ¼ã‚¿ã‚¤ã‚¿ãƒ³(328)ç”¨
4. **ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ç ´å£Šã‚«ã‚¦ãƒ³ã‚¿ãƒ¼** - ã‚½ã‚¦ãƒ«ã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼(323), ãƒãƒ«ã‚­ãƒªãƒ¼(35)ãªã©

### âœ… å®Ÿè£…æ¸ˆã¿ãƒ»å®Ÿè£…å¯èƒ½
5. **æ‰‹æœ­æ•°å–å¾—** - ãƒªãƒªã‚¹(146)ç”¨ï¼ˆCardSystem.player_hands ã‹ã‚‰å–å¾—å¯èƒ½ï¼‰
6. **ãƒ‡ãƒƒã‚­æšæ•°æ¯”è¼ƒ** - ã‚³ã‚¢ãƒˆãƒªã‚¯ã‚¨(214)ç”¨ï¼ˆCardSystemæ”¹ä¿®ãŒå¿…è¦ï¼‰

### ğŸŸ¡ å¾Œå›ã—
7. **ã‚¢ãƒ«ã‚«ãƒŠã‚¢ãƒ¼ãƒ„ã‚·ã‚¹ãƒ†ãƒ ** - ãƒ‰ã‚¥ãƒ¼ãƒ ãƒ‡ãƒœãƒ©ãƒ¼(23)ãªã©ï¼ˆå¤§è¦æ¨¡ãªå®Ÿè£…ãŒå¿…è¦ï¼‰

---

---

## ğŸ“‹ ç›®æ¬¡

1. [æ¦‚è¦](#æ¦‚è¦)
2. [åŠ¹æœã®ç¨®é¡ã¨æŒç¶šæœŸé–“](#åŠ¹æœã®ç¨®é¡ã¨æŒç¶šæœŸé–“)
3. [ãƒ‡ãƒ¼ã‚¿æ§‹é€ è¨­è¨ˆ](#ãƒ‡ãƒ¼ã‚¿æ§‹é€ è¨­è¨ˆ)
4. [HP/APç®¡ç†æ§‹é€ ](#hpapç®¡ç†æ§‹é€ )
5. [åŠ¹æœã®é©ç”¨é †åº](#åŠ¹æœã®é©ç”¨é †åº)
6. [å®Ÿè£…æ–¹é‡](#å®Ÿè£…æ–¹é‡)
7. [å®Ÿè£…ãƒ•ã‚§ãƒ¼ã‚º](#å®Ÿè£…ãƒ•ã‚§ãƒ¼ã‚º)

---

## æ¦‚è¦

### ç›®çš„
ã‚¢ã‚¤ãƒ†ãƒ ã€ã‚¹ãƒšãƒ«ã€ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ã‚¹ã‚­ãƒ«ã«ã‚ˆã‚‹æ§˜ã€…ãªåŠ¹æœã‚’çµ±ä¸€çš„ã«ç®¡ç†ã™ã‚‹ã‚·ã‚¹ãƒ†ãƒ ã‚’å®Ÿè£…ã™ã‚‹ã€‚

### è¨­è¨ˆæ–¹é‡
- **åŠ¹æœã®åˆ†é›¢ç®¡ç†**: ãƒãƒˆãƒ«ä¸­ã®ä¸€æ™‚åŠ¹æœã¨æ°¸ç¶šåŠ¹æœã‚’åˆ†ã‘ã¦ç®¡ç†
- **å‹•çš„è¨ˆç®—**: ãƒãƒˆãƒ«æ™‚ã«æ¯å›åŠ¹æœã‚’è¨ˆç®—ï¼ˆæ—¢å­˜æ–¹å¼ã‚’è¸è¥²ï¼‰
- **åŠ¹æœã®ä¿æŒ**: æ‰“ã¡æ¶ˆã—åŠ¹æœã«å¯¾å¿œã™ã‚‹ãŸã‚ã€åŠ¹æœé…åˆ—ã‚’ä¿æŒ
- **æ‹¡å¼µæ€§ã®ç¢ºä¿**: å°†æ¥çš„ãªæ–°åŠ¹æœã®è¿½åŠ ãŒå®¹æ˜“

### é‡è¦ãªä»•æ§˜æ±ºå®š
- **ç§»å‹•ã§æ¶ˆãˆã‚‹åŠ¹æœ**: ãƒ‰ãƒŸãƒ‹ã‚ªã‚ªãƒ¼ãƒ€ãƒ¼ã§ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ãŒç§»å‹•ã—ãŸã¨ãã«æ¶ˆãˆã‚‹
- **åˆæˆåŠ¹æœ**: `base_up_hp/ap`ã§ç‰¹åˆ¥æ‰±ã„ï¼ˆæ‰“ã¡æ¶ˆã—ä¸å¯ï¼‰
- **ã‚¹ãƒšãƒ«åŠ¹æœã®é‡è¤‡**: åŸºæœ¬çš„ã«ä¸Šæ›¸ãï¼ˆä»¥å‰ã®åŒååŠ¹æœã¯å‰Šé™¤ï¼‰
- **åŠ¹æœIDç®¡ç†**: `source_name`ã§åŒä¸€ã‚¹ãƒšãƒ«ã‚’åˆ¤å®š

---

## åŠ¹æœã®ç¨®é¡ã¨æŒç¶šæœŸé–“

### 1. ãƒãƒˆãƒ«ä¸­ã®ã¿ã®åŠ¹æœ
**ä¾‹**: ã‚¢ã‚¤ãƒ†ãƒ ã€Œãƒ­ãƒ³ã‚°ã‚½ãƒ¼ãƒ‰ã€ä½¿ç”¨ã§AP+30

- **æŒç¶šæœŸé–“**: ãƒãƒˆãƒ«é–‹å§‹ã€œãƒãƒˆãƒ«çµ‚äº†
- **ç®¡ç†å ´æ‰€**: `BattleParticipant.item_bonus_ap`
- **å‰Šé™¤ã‚¿ã‚¤ãƒŸãƒ³ã‚°**: ãƒãƒˆãƒ«çµ‚äº†æ™‚ã«è‡ªå‹•å‰Šé™¤
- **å®Ÿè£…**: ãƒãƒˆãƒ«æº–å‚™ãƒ•ã‚§ãƒ¼ã‚ºã§é¸æŠã€åŠ¹æœã‚’é©ç”¨

---

### 2. ã‚¹ãƒšãƒ«ã«ã‚ˆã‚‹ä¸€æ™‚çš„ãªåŠ¹æœï¼ˆç§»å‹•ã§æ¶ˆãˆã‚‹ï¼‰
**ä¾‹**: ã‚¹ãƒšãƒ«ã€Œãƒ–ãƒ¬ãƒƒã‚·ãƒ³ã‚°ã€ã§HP+10

- **æŒç¶šæœŸé–“**: åŠ¹æœä»˜ä¸ã€œã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ç§»å‹•ã¾ã§
- **ç®¡ç†å ´æ‰€**: `creature_data["temporary_effects"]`
- **å‰Šé™¤ã‚¿ã‚¤ãƒŸãƒ³ã‚°**: ãƒ‰ãƒŸãƒ‹ã‚ªã‚ªãƒ¼ãƒ€ãƒ¼ã§ã®ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ç§»å‹•æ™‚ã€äº¤æ›æ™‚
- **ä¸Šæ›¸ãä»•æ§˜**: åŒã˜ã‚¹ãƒšãƒ«ã‚’å†ä½¿ç”¨ã™ã‚‹ã¨å‰ã®åŠ¹æœã‚’å‰Šé™¤

```gdscript
creature_data["temporary_effects"] = [
	{
		"id": "blessing_002",
		"type": "stat_bonus",
		"stat": "hp",
		"value": 10,
		"source": "spell",
		"source_name": "ãƒ–ãƒ¬ãƒƒã‚·ãƒ³ã‚°",
		"removable": true,
		"lost_on_move": true
	}
]
```

---

### 3. æ¡ä»¶ä»˜ãåŠ¹æœï¼ˆãƒãƒˆãƒ«æ™‚ã«å‹•çš„è¨ˆç®—ï¼‰

#### 3-1. åœŸåœ°ä¿æœ‰æ•°ã«ã‚ˆã‚‹åŠ¹æœ
**ä¾‹**: ã€Œç«åœŸåœ°ã‚’3ã¤ä»¥ä¸Šä¿æœ‰ã—ã¦ã„ã‚‹å ´åˆã€AP+30ã€

- **ç®¡ç†å ´æ‰€**: `ability_parsed` ã® conditions
- **é©ç”¨ã‚¿ã‚¤ãƒŸãƒ³ã‚°**: ãƒãƒˆãƒ«é–‹å§‹æ™‚ã«æ¯å›ãƒã‚§ãƒƒã‚¯
- **å®Ÿè£…**: æ—¢å­˜ã®ConditionCheckerã‚·ã‚¹ãƒ†ãƒ ã‚’ä½¿ç”¨

#### 3-2. åœŸåœ°ã®ä¿æœ‰æ•°æ¯”ä¾‹åŠ¹æœ
**ä¾‹**: ã€Œç«åœŸåœ°1ã¤ã”ã¨ã«AP+10ã€

- **è¨ˆç®—æ–¹æ³•**: æ¯ãƒãƒˆãƒ«æ™‚ã«å‹•çš„è¨ˆç®—
- **å®Ÿè£…**: å…±é³´ã‚¹ã‚­ãƒ«ã¨åŒæ§˜ã®å‡¦ç†

#### 3-3. éš£æ¥æ¡ä»¶åŠ¹æœ
**ä¾‹**: ã€Œéš£æ¥ã«è‡ªãƒ‰ãƒŸãƒ‹ã‚ªãŒã‚ã‚‹å ´åˆã€AP+20ã€HP+20ã€

- **å®Ÿè£…**: æ—¢å­˜ã®å¼·åŒ–ã‚¹ã‚­ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã¨åŒæ§˜
- **é©ç”¨ã‚¿ã‚¤ãƒŸãƒ³ã‚°**: ãƒãƒˆãƒ«é–‹å§‹æ™‚ã«æ¡ä»¶ãƒã‚§ãƒƒã‚¯

---

### 4. ãƒãƒƒãƒ—å‘¨å›ã§ä¸Šæ˜‡ã™ã‚‹åŠ¹æœ
**ä¾‹**: ã‚­ãƒ¡ãƒ©ã€Œãƒãƒƒãƒ—ã‚’1å‘¨ã—ãŸã‚‰AP+10ã€

- **ã‚«ã‚¦ãƒ³ãƒˆç®¡ç†**: `creature_data["map_lap_count"]`
- **é©ç”¨æ–¹æ³•**: permanent_effectsã«è¿½åŠ 
- **æ°¸ç¶šæ€§**: ç§»å‹•ã—ã¦ã‚‚ç¶­æŒã€äº¤æ›ã§æ¶ˆãˆã‚‹

```gdscript
creature_data["map_lap_count"] = 2  # å‘¨å›æ•°ã‚«ã‚¦ãƒ³ãƒˆ
creature_data["permanent_effects"].append({
	"id": "lap_bonus_003",
	"type": "stat_bonus",
	"stat": "ap",
	"value": 10,
	"source": "map_lap",
	"removable": false,
	"lost_on_move": false
})
```

---

### 5. ã‚¹ã‚­ãƒ«ã€Œåˆæˆã€ã«ã‚ˆã‚‹æ°¸ç¶šçš„ãªåŠ¹æœ
**ä¾‹**: åˆæˆ[åœ°]ã‚’æŒã¤ã‚«ãƒ¼ãƒ‰ã‚’ç”Ÿè´„ã«ã—ã¦å¬å–š

- **é©ç”¨ã‚¿ã‚¤ãƒŸãƒ³ã‚°**: å¬å–šæ™‚
- **æ°¸ç¶šæ€§**: äº¤æ›ã§æ¶ˆãˆã‚‹ã€æ‰“ã¡æ¶ˆã—ä¸å¯
- **å®Ÿè£…æ–¹æ³•**: `base_up_hp/ap`ã«ç›´æ¥åŠ ç®—ï¼ˆç‰¹åˆ¥æ‰±ã„ï¼‰

```gdscript
# åˆæˆåŠ¹æœã¯base_up_hp/apã§ç®¡ç†ï¼ˆæ‰“ã¡æ¶ˆã—ä¸å¯ï¼‰
creature_data["base_up_hp"] = 10  # åˆæˆã«ã‚ˆã‚‹HPä¸Šæ˜‡
creature_data["base_up_ap"] = 20  # åˆæˆã«ã‚ˆã‚‹APä¸Šæ˜‡
```

---

### 6. ã‚¹ãƒšãƒ«ã«ã‚ˆã‚‹æ°¸ç¶šçš„ãªåŠ¹æœ

#### 6-1. ãƒã‚¹ã‚°ãƒ­ãƒ¼ã‚¹ã€ãƒ‰ãƒŸãƒŠãƒ³ãƒˆã‚°ãƒ­ãƒ¼ã‚¹
**ä¾‹**: ã‚¹ãƒšãƒ«ã€Œãƒã‚¹ã‚°ãƒ­ãƒ¼ã‚¹ã€å…¨ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ã®MHP+5

- **ç®¡ç†å ´æ‰€**: `base_up_hp`ã«åŠ ç®—ï¼ˆåˆæˆã¨åŒã˜æ‰±ã„ï¼‰
- **å‰Šé™¤ã‚¿ã‚¤ãƒŸãƒ³ã‚°**: æ‰“ã¡æ¶ˆã—åŠ¹æœã§ã‚‚æ¶ˆãˆãªã„
- **é©ç”¨å¯¾è±¡**: å…¨è‡ªã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼

```gdscript
# ãƒã‚¹ã‚°ãƒ­ãƒ¼ã‚¹åŠ¹æœã¯base_up_hpã§ç®¡ç†
for tile in board_system.get_player_tiles(player_id):
	if tile.creature_data:
		tile.creature_data["base_up_hp"] = tile.creature_data.get("base_up_hp", 0) + 5
```

#### 6-2. ãã®ä»–ã®æ°¸ç¶šã‚¹ãƒšãƒ«åŠ¹æœ
**ä¾‹**: æ°¸ç¶šçš„ãªèƒ½åŠ›ä»˜ä¸ãªã©

- **ç®¡ç†å ´æ‰€**: `creature_data["permanent_effects"]`
- **å‰Šé™¤ã‚¿ã‚¤ãƒŸãƒ³ã‚°**: æ‰“ã¡æ¶ˆã—åŠ¹æœã€äº¤æ›æ™‚

---

## ãƒ‡ãƒ¼ã‚¿æ§‹é€ è¨­è¨ˆ

### creature_dataã®æ‹¡å¼µæ§‹é€ 

```gdscript
{
	"id": 1,
	"name": "ã‚¢ãƒ¢ãƒ³",
	"hp": 30,           # å…ƒã®åŸºç¤HP
	"ap": 20,           # å…ƒã®åŸºç¤AP
	"element": "fire",
	"ability_parsed": {...},  # ã‚¹ã‚­ãƒ«å®šç¾©ï¼ˆæ—¢å­˜ï¼‰
	
	# åˆæˆãƒ»ãƒã‚¹ã‚°ãƒ­ãƒ¼ã‚¹ç”¨ï¼ˆæ‰“ã¡æ¶ˆã—ä¸å¯ï¼‰
	"base_up_hp": 0,    # æ°¸ç¶šçš„ãªåŸºç¤HPä¸Šæ˜‡
	"base_up_ap": 0,    # æ°¸ç¶šçš„ãªåŸºç¤APä¸Šæ˜‡
	
	# æ°¸ç¶šçš„ãªåŠ¹æœï¼ˆç§»å‹•ã§æ¶ˆãˆãªã„ã€äº¤æ›ã§æ¶ˆãˆã‚‹ï¼‰
	"permanent_effects": [
		{
			"id": "effect_001",
			"type": "stat_bonus",
			"stat": "hp",
			"value": 20,
			"source": "spell",
			"source_name": "å¼·åŒ–å‘ªæ–‡",
			"removable": true,        # æ‰“ã¡æ¶ˆã—åŠ¹æœã§æ¶ˆã›ã‚‹ã‹
			"lost_on_move": false     # ç§»å‹•ã§æ¶ˆãˆã‚‹ã‹
		}
	],
	
	# ä¸€æ™‚çš„ãªåŠ¹æœï¼ˆç§»å‹•ã§æ¶ˆãˆã‚‹ï¼‰
	"temporary_effects": [
		{
			"id": "blessing_003",
			"type": "stat_bonus",
			"stat": "hp",
			"value": 10,
			"source": "spell",
			"source_name": "ãƒ–ãƒ¬ãƒƒã‚·ãƒ³ã‚°",
			"removable": true,
			"lost_on_move": true
		}
	],
	
	# ãƒãƒƒãƒ—å‘¨å›ã‚«ã‚¦ãƒ³ãƒˆï¼ˆã‚­ãƒ¡ãƒ©ç­‰ï¼‰
	"map_lap_count": 0
}
```

### effectã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®æ§‹é€ 

```gdscript
{
	"id": "unique_id_string",         # ä¸€æ„ã®ID
	"type": "stat_bonus",              # åŠ¹æœã‚¿ã‚¤ãƒ—
	"stat": "hp",                      # å¯¾è±¡ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼ˆhp/apï¼‰
	"value": 10,                       # åŠ¹æœå€¤
	"source": "spell",                 # ç™ºç”Ÿæºï¼ˆspell/item/skill/synthesisï¼‰
	"source_name": "ãƒ–ãƒ¬ãƒƒã‚·ãƒ³ã‚°",      # åŠ¹æœåï¼ˆUIè¡¨ç¤ºç”¨ã€é‡è¤‡åˆ¤å®šç”¨ï¼‰
	"removable": true,                 # æ‰“ã¡æ¶ˆã—åŠ¹æœã§æ¶ˆã›ã‚‹ã‹
	"lost_on_move": false              # ç§»å‹•ã§æ¶ˆãˆã‚‹ã‹
}
```

---

## HP/APç®¡ç†æ§‹é€ 

### BattleParticipantã®æ‹¡å¼µæ§‹é€ 

```gdscript
class BattleParticipant:
	# åŸºç¤å€¤ï¼ˆæ—¢å­˜ï¼‰
	var base_hp: int              # å…ƒã®HPï¼ˆã‚«ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ã®å€¤ï¼‰
	# æ³¨: base_apã¯ãƒ¡ãƒ³ãƒå¤‰æ•°ã§ã¯ãªãã€update_current_ap()å†…ã§ãƒ­ãƒ¼ã‚«ãƒ«å¤‰æ•°ã¨ã—ã¦ä½¿ç”¨
	
	# æ°¸ç¶šçš„ãªåŸºç¤ä¸Šæ˜‡ï¼ˆæ–°è¦è¿½åŠ ï¼‰
	var base_up_hp: int = 0       # åˆæˆãƒ»ãƒã‚¹ã‚°ãƒ­ãƒ¼ã‚¹ç­‰ï¼ˆæ‰“ã¡æ¶ˆã—ä¸å¯ï¼‰
	var base_up_ap: int = 0       
	
	# ãƒãƒˆãƒ«ä¸­ã®ä¸€æ™‚ãƒœãƒ¼ãƒŠã‚¹ï¼ˆä¸€éƒ¨æ—¢å­˜ã€ä¸€éƒ¨æ–°è¦ï¼‰
	var temporary_bonus_hp: int = 0   # ä¸€æ™‚çš„ãªHPãƒœãƒ¼ãƒŠã‚¹ï¼ˆæ–°è¦ï¼‰
	var temporary_bonus_ap: int = 0   # ä¸€æ™‚çš„ãªAPãƒœãƒ¼ãƒŠã‚¹ï¼ˆæ–°è¦ï¼‰
	var resonance_bonus_hp: int = 0   # å…±é³´ãƒœãƒ¼ãƒŠã‚¹ï¼ˆæ—¢å­˜ï¼‰
	var land_bonus_hp: int = 0        # åœŸåœ°ãƒœãƒ¼ãƒŠã‚¹ï¼ˆæ—¢å­˜ï¼‰
	var item_bonus_hp: int = 0        # ã‚¢ã‚¤ãƒ†ãƒ ãƒœãƒ¼ãƒŠã‚¹ï¼ˆæ—¢å­˜ï¼‰
	var item_bonus_ap: int = 0        # ã‚¢ã‚¤ãƒ†ãƒ ãƒœãƒ¼ãƒŠã‚¹ï¼ˆæ—¢å­˜ï¼‰
	var spell_bonus_hp: int = 0       # ã‚¹ãƒšãƒ«ãƒœãƒ¼ãƒŠã‚¹ï¼ˆæ—¢å­˜ï¼‰
	
	# åŠ¹æœé…åˆ—ã®å‚ç…§ï¼ˆæ–°è¦è¿½åŠ ï¼‰
	var permanent_effects: Array = []  # ãƒãƒˆãƒ«ä¸­ã‚‚ä¿æŒ
	var temporary_effects: Array = []  # ãƒãƒˆãƒ«ä¸­ã‚‚ä¿æŒ
	
	# è¨ˆç®—å¾Œã®å€¤
	var current_hp: int
	var current_ap: int
```

### HP/APã®è¨ˆç®—å¼

```gdscript
# HPè¨ˆç®—
current_hp = base_hp + 
			 base_up_hp +           # åˆæˆãƒ»ãƒã‚¹ã‚°ãƒ­ãƒ¼ã‚¹
			 temporary_bonus_hp +   # ä¸€æ™‚åŠ¹æœã®åˆè¨ˆ
			 land_bonus_hp + 
			 resonance_bonus_hp + 
			 item_bonus_hp +
			 spell_bonus_hp

# APè¨ˆç®—
current_ap = base_ap + 
			 base_up_ap +           # åˆæˆãƒ»ãƒã‚¹ã‚°ãƒ­ãƒ¼ã‚¹
			 temporary_bonus_ap +   # ä¸€æ™‚åŠ¹æœã®åˆè¨ˆ
			 item_bonus_ap + 
			 (å…±é³´AP) + 
			 (æ¡ä»¶åŠ¹æœAP)
# ãã®å¾Œã€å¼·åŒ–ã§ä¹—ç®—
```

### ãƒ€ãƒ¡ãƒ¼ã‚¸æ¶ˆè²»é †åºï¼ˆæ—¢å­˜ä»•æ§˜ï¼‰

```
1. land_bonus_hpï¼ˆåœŸåœ°ãƒœãƒ¼ãƒŠã‚¹ï¼‰â† æœ€åˆã«æ¶ˆè²»
2. resonance_bonus_hpï¼ˆå…±é³´ãƒœãƒ¼ãƒŠã‚¹ï¼‰
3. temporary_bonus_hpï¼ˆä¸€æ™‚ãƒœãƒ¼ãƒŠã‚¹ï¼‰
4. spell_bonus_hpï¼ˆã‚¹ãƒšãƒ«ãƒœãƒ¼ãƒŠã‚¹ï¼‰
5. item_bonus_hpï¼ˆã‚¢ã‚¤ãƒ†ãƒ ãƒœãƒ¼ãƒŠã‚¹ï¼‰
6. current_hpã‹ã‚‰ç›´æ¥æ¶ˆè²»
```

**æ³¨æ„**: `base_up_hp`ï¼ˆæ°¸ç¶šçš„ãªåŸºç¤HPä¸Šæ˜‡ï¼‰ã¯æ¶ˆè²»ã•ã‚Œãªã„ã€‚ã“ã‚Œã¯MHPè¨ˆç®—ã«ã®ã¿ä½¿ç”¨ã•ã‚Œã‚‹ã€‚
- MHP = base_hp + base_up_hpï¼ˆitem_bonus_hpã¯å«ã¾ãªã„ï¼‰

---

## åŠ¹æœã®é©ç”¨é †åº

### ãƒãƒˆãƒ«æ™‚ã®è¨ˆç®—é †åº

```gdscript
# ãƒãƒˆãƒ«æº–å‚™æ™‚ã®å‡¦ç†
func prepare_battle_participant(creature_data, tile_data):
	# 1. åŸºç¤å€¤ã‚’è¨­å®š
	participant.base_hp = creature_data["hp"]
	participant.base_ap = creature_data["ap"]
	
	# 2. base_up_hp/apã‚’é©ç”¨ï¼ˆåˆæˆãƒ»ãƒã‚¹ã‚°ãƒ­ãƒ¼ã‚¹ï¼‰
	participant.base_up_hp = creature_data.get("base_up_hp", 0)
	participant.base_up_ap = creature_data.get("base_up_ap", 0)
	
	# 3. åŠ¹æœé…åˆ—ã‚’ä¿æŒï¼ˆæ‰“ã¡æ¶ˆã—åŠ¹æœåˆ¤å®šç”¨ï¼‰
	participant.permanent_effects = creature_data.get("permanent_effects", [])
	participant.temporary_effects = creature_data.get("temporary_effects", [])
	
	# 4. permanent_effectsã‹ã‚‰åŠ¹æœã‚’è¨ˆç®—
	for effect in participant.permanent_effects:
		if effect["stat"] == "hp":
			participant.temporary_bonus_hp += effect["value"]
		elif effect["stat"] == "ap":
			participant.temporary_bonus_ap += effect["value"]
	
	# 5. temporary_effectsã‹ã‚‰åŠ¹æœã‚’è¨ˆç®—
	for effect in participant.temporary_effects:
		if effect["stat"] == "hp":
			participant.temporary_bonus_hp += effect["value"]
		elif effect["stat"] == "ap":
			participant.temporary_bonus_ap += effect["value"]
	
	# 6. åœŸåœ°ãƒœãƒ¼ãƒŠã‚¹ï¼ˆæ—¢å­˜å‡¦ç†ï¼‰
	participant.land_bonus_hp = tile.level * 10
	
	# 7. ã‚¢ã‚¤ãƒ†ãƒ åŠ¹æœï¼ˆãƒãƒˆãƒ«æº–å‚™ãƒ•ã‚§ãƒ¼ã‚ºã§é¸æŠï¼‰
	if selected_item:
		participant.item_bonus_ap = selected_item.ap_bonus
		participant.item_bonus_hp = selected_item.hp_bonus
	
	# 8. å…±é³´åŠ¹æœï¼ˆæ—¢å­˜å‡¦ç†ï¼‰
	apply_resonance_skill(participant, context)
	
	# 9. ãã®ä»–ã®æ¡ä»¶åŠ¹æœ
	# ï¼ˆåœŸåœ°ä¿æœ‰æ•°ã€éš£æ¥æ¡ä»¶ãªã©ï¼‰
	
	# 10. å¼·åŒ–ã‚’é©ç”¨ï¼ˆæœ€å¾Œï¼‰
	if has_power_strike:
		participant.current_ap *= 1.5
```

---

## å®Ÿè£…æ–¹é‡

### åŸºæœ¬æ–¹é‡

1. **æ—¢å­˜æ§‹é€ ã®æ´»ç”¨**
   - BattleParticipantã®æ‹¡å¼µï¼ˆEffectManagerã¯ä½œã‚‰ãªã„ï¼‰
   - creature_dataã«åŠ¹æœé…åˆ—ã‚’è¿½åŠ 
   - ãƒãƒˆãƒ«æ™‚ã®å‹•çš„è¨ˆç®—ã‚’ç¶­æŒ

2. **åŠ¹æœã®ç®¡ç†**
   - å„ã‚¿ã‚¤ãƒ«ã®creature_dataã§åŠ¹æœã‚’ç®¡ç†
   - ãƒãƒˆãƒ«æ™‚ã«åŠ¹æœé…åˆ—ã‚’ä¿æŒï¼ˆæ‰“ã¡æ¶ˆã—åˆ¤å®šç”¨ï¼‰
   - åŠ¹æœIDã¯`source_name`ã§é‡è¤‡åˆ¤å®š

3. **æ®µéšçš„å®Ÿè£…**
   - ç°¡å˜ãªåŠ¹æœã‹ã‚‰é †æ¬¡å®Ÿè£…
   - æ—¢å­˜ã‚·ã‚¹ãƒ†ãƒ ã¨ã®çµ±åˆã‚’é‡è¦–

### åŠ¹æœã®è¿½åŠ å‡¦ç†

```gdscript
# ã‚¹ãƒšãƒ«åŠ¹æœã®è¿½åŠ ï¼ˆä¸Šæ›¸ãå‡¦ç†ã‚ã‚Šï¼‰
func add_spell_effect(creature_data: Dictionary, effect: Dictionary):
	var effects_array = "temporary_effects" if effect.get("lost_on_move", true) else "permanent_effects"
	
	# åŒååŠ¹æœã‚’å‰Šé™¤ï¼ˆä¸Šæ›¸ãï¼‰
	var new_effects = []
	for existing_effect in creature_data.get(effects_array, []):
		if existing_effect.get("source_name") != effect.get("source_name"):
			new_effects.append(existing_effect)
	
	# æ–°ã—ã„åŠ¹æœã‚’è¿½åŠ 
	effect["id"] = generate_unique_id()
	new_effects.append(effect)
	creature_data[effects_array] = new_effects
```

### ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ç§»å‹•æ™‚ã®å‡¦ç†

```gdscript
# ãƒ‰ãƒŸãƒ‹ã‚ªã‚ªãƒ¼ãƒ€ãƒ¼ã§ã®ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ç§»å‹•æ™‚
func on_creature_move(tile_index: int):
	var creature_data = tile.creature_data
	if creature_data:
		# temporary_effectsã‚’ã‚¯ãƒªã‚¢ï¼ˆç§»å‹•ã§æ¶ˆãˆã‚‹åŠ¹æœï¼‰
		creature_data["temporary_effects"] = []
		# permanent_effectsã¯ç¶­æŒ
```

---

## å®Ÿè£…ãƒ•ã‚§ãƒ¼ã‚º

### Phase 1: åŸºç›¤æ§‹ç¯‰ï¼ˆæœ€å„ªå…ˆï¼‰

1. **creature_dataã®æ‹¡å¼µ**
   - base_up_hp/apãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è¿½åŠ 
   - permanent_effectsé…åˆ—è¿½åŠ 
   - temporary_effectsé…åˆ—è¿½åŠ 
   - map_lap_countãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è¿½åŠ 

2. **BattleParticipantã®æ”¹ä¿®**
   - base_up_hp/apãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è¿½åŠ 
   - temporary_bonus_hp/apãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è¿½åŠ 
   - åŠ¹æœé…åˆ—ã®å‚ç…§ã‚’ä¿æŒ
   - åŠ¹æœè¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯ã®å®Ÿè£…

3. **åŸºæœ¬çš„ãªåŠ¹æœè¿½åŠ ãƒ»å‰Šé™¤å‡¦ç†**
   - ã‚¹ãƒšãƒ«åŠ¹æœã®è¿½åŠ ï¼ˆä¸Šæ›¸ãå‡¦ç†ä»˜ãï¼‰
   - ç§»å‹•æ™‚ã®åŠ¹æœå‰Šé™¤å‡¦ç†

### Phase 2: åŸºæœ¬åŠ¹æœã®å®Ÿè£…

1. **ã‚¢ã‚¤ãƒ†ãƒ åŠ¹æœ**
   - ãƒãƒˆãƒ«æº–å‚™ãƒ•ã‚§ãƒ¼ã‚ºã¨ã®çµ±åˆ
   - ãƒ­ãƒ³ã‚°ã‚½ãƒ¼ãƒ‰ç­‰ã®AP+åŠ¹æœå®Ÿè£…

2. **ã‚¹ãƒšãƒ«åŠ¹æœï¼ˆä¸€æ™‚çš„ï¼‰**
   - ãƒ–ãƒ¬ãƒƒã‚·ãƒ³ã‚°ï¼ˆHP+10ã€ç§»å‹•ã§æ¶ˆãˆã‚‹ï¼‰
   - åŠ¹æœã®ä¸Šæ›¸ãå‡¦ç†

3. **ã‚¹ãƒšãƒ«åŠ¹æœï¼ˆæ°¸ç¶šçš„ï¼‰**
   - ãƒã‚¹ã‚°ãƒ­ãƒ¼ã‚¹ï¼ˆbase_up_hpä½¿ç”¨ï¼‰
   - ãƒ‰ãƒŸãƒŠãƒ³ãƒˆã‚°ãƒ­ãƒ¼ã‚¹

### Phase 3: æ¡ä»¶ä»˜ãåŠ¹æœ

1. **åœŸåœ°ä¿æœ‰æ•°åŠ¹æœ**
   - å‹•çš„è¨ˆç®—ã®å®Ÿè£…
   - ConditionCheckerã¨ã®çµ±åˆ

2. **éš£æ¥æ¡ä»¶åŠ¹æœ**
   - æ—¢å­˜ã‚·ã‚¹ãƒ†ãƒ ã®æ´»ç”¨

### Phase 4: é«˜åº¦ãªåŠ¹æœï¼ˆå¾Œå›ã—ï¼‰

1. **ãƒãƒƒãƒ—å‘¨å›åŠ¹æœ**ï¼ˆã‚­ãƒ¡ãƒ©ç­‰ï¼‰
2. **åˆæˆåŠ¹æœ**
3. **æ‰“ã¡æ¶ˆã—åŠ¹æœ**
4. **ä¸–ç•Œå‘ª**

---

## ãƒ†ã‚¹ãƒˆè¨ˆç”»

### Phase 1ãƒ†ã‚¹ãƒˆ
- creature_dataã¸ã®åŠ¹æœé…åˆ—è¿½åŠ ç¢ºèª
- BattleParticipantã§ã®åŠ¹æœè¨ˆç®—ç¢ºèª

### Phase 2ãƒ†ã‚¹ãƒˆ
- ã‚¢ã‚¤ãƒ†ãƒ ã€Œãƒ­ãƒ³ã‚°ã‚½ãƒ¼ãƒ‰ã€ã§AP+30ç¢ºèª
- ã‚¹ãƒšãƒ«ã€Œãƒ–ãƒ¬ãƒƒã‚·ãƒ³ã‚°ã€ã§HP+10ç¢ºèª
- åŒã˜ã‚¹ãƒšãƒ«ã®ä¸Šæ›¸ãç¢ºèª
- ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ç§»å‹•æ™‚ã®åŠ¹æœå‰Šé™¤ç¢ºèª

### Phase 3ãƒ†ã‚¹ãƒˆ
- ãƒã‚¹ã‚°ãƒ­ãƒ¼ã‚¹åŠ¹æœã®æ°¸ç¶šæ€§ç¢ºèª
- æ¡ä»¶ä»˜ãåŠ¹æœã®å‹•çš„è¨ˆç®—ç¢ºèª

---

## å®Ÿè£…å®Œäº†çŠ¶æ³

### âœ… Phase 1: åŸºç›¤æ§‹ç¯‰ï¼ˆå®Œäº†ï¼‰

1. **creature_dataã®æ‹¡å¼µ** - `base_tiles.gd`
   - `base_up_hp/ap`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ âœ…
   - `permanent_effects`é…åˆ— âœ…
   - `temporary_effects`é…åˆ— âœ…
   - `map_lap_count`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ âœ…

2. **BattleParticipantã®æ”¹ä¿®** - `battle_participant.gd`
   - æ–°ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®è¿½åŠ  âœ…
   - HP/APè¨ˆç®—å¼ã®æ›´æ–° âœ…
   - ãƒ€ãƒ¡ãƒ¼ã‚¸æ¶ˆè²»é †åºã®èª¿æ•´ âœ…

3. **ãƒãƒˆãƒ«æº–å‚™æ™‚ã®åŠ¹æœè¨ˆç®—** - `battle_preparation.gd`
   - `apply_effect_arrays()`ãƒ¡ã‚½ãƒƒãƒ‰ âœ…
   - åŠ¹æœé…åˆ—ã‹ã‚‰ã®ãƒœãƒ¼ãƒŠã‚¹è¨ˆç®— âœ…

### âœ… Phase 2: åŸºæœ¬åŠ¹æœã®å®Ÿè£…ï¼ˆå®Œäº†ï¼‰

4. **åŠ¹æœç®¡ç†ãƒ¡ã‚½ãƒƒãƒ‰** - `effect_manager.gd`ï¼ˆé™çš„ãƒ¡ã‚½ãƒƒãƒ‰ï¼‰
   - `add_spell_effect_to_creature()` âœ…
   - `apply_mass_growth()` âœ…
   - `apply_dominant_growth()` âœ…
   - `clear_temporary_effects()` âœ…
   - `apply_synthesis_effect()` âœ…

5. **ãƒãƒˆãƒ«ãƒ†ã‚¹ãƒˆãƒ„ãƒ¼ãƒ«ã®å¯¾å¿œ** - `battle_test_executor.gd`
   - `_get_effect_info()`ãƒ¡ã‚½ãƒƒãƒ‰ âœ…
   - åŠ¹æœæƒ…å ±ã®è¨˜éŒ² âœ…

### âœ… Phase 3: æ¡ä»¶ä»˜ãåŠ¹æœï¼ˆéƒ¨åˆ†å®Œäº†ï¼‰

6. **åœŸåœ°æ•°æ¯”ä¾‹åŠ¹æœ** - `battle_skill_processor.gd`
   - `apply_land_count_effects()` âœ…
   - è¤‡æ•°å±æ€§ã®åœŸåœ°æ•°åˆè¨ˆã«å¯¾å¿œ âœ…
   - HP/APä¸¡æ–¹ã«å¯¾å¿œ âœ…

**å®Ÿè£…ä¾‹**: ã‚¢ãƒ¼ãƒ ãƒ‰ãƒ‘ãƒ©ãƒ‡ã‚£ãƒ³
```json
{
  "effects": [
	{
	  "effect_type": "land_count_multiplier",
	  "stat": "ap",
	  "elements": ["fire", "earth"],
	  "multiplier": 10
	}
  ]
}
```

### ğŸš§ Phase 3: æœªå®Œäº†

- éš£æ¥æ¡ä»¶åŠ¹æœï¼ˆå®Ÿè£…æº–å‚™ä¸­ï¼‰
- ãƒãƒƒãƒ—å‘¨å›åŠ¹æœï¼ˆå®Ÿè£…æº–å‚™ä¸­ï¼‰

### ğŸš§ Phase 4: é«˜åº¦ãªåŠ¹æœï¼ˆæœªå®Ÿè£…ï¼‰

- åˆæˆåŠ¹æœ
- ä¸–ç•Œå‘ª
- ã‚ˆã‚Šè¤‡é›‘ãªæ¡ä»¶åˆ¤å®š

---

## å®Ÿè£…ã•ã‚ŒãŸã‚«ãƒ¼ãƒ‰ä¾‹

### ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼

**ã‚¢ãƒ¼ãƒ ãƒ‰ãƒ‘ãƒ©ãƒ‡ã‚£ãƒ³** (`data/fire_1.json`)
```json
{
  "id": 1,
  "name": "ã‚¢ãƒ¼ãƒ ãƒ‰ãƒ‘ãƒ©ãƒ‡ã‚£ãƒ³",
  "ap": 0,
  "hp": 50,
  "ability_detail": "AP =|AP=ç«åœ°,é…ç½®æ•°Ã—10ï¼›ç„¡åŠ¹åŒ–[å·»ç‰©]",
  "ability_parsed": {
	"keywords": ["ç„¡åŠ¹åŒ–"],
	"keyword_conditions": {
	  "ç„¡åŠ¹åŒ–": {
		"nullify_type": "scroll_attack"
	  }
	},
	"effects": [
	  {
		"effect_type": "land_count_multiplier",
		"stat": "ap",
		"elements": ["fire", "earth"],
		"multiplier": 10,
		"description": "ç«ã¨åœŸã®åœŸåœ°é…ç½®æ•°Ã—10ã‚’STã«åŠ ç®—"
	  }
	]
  }
}
```

**å‹•ä½œä¾‹**:
- ç«åœŸåœ°2ã¤ + åœŸåœŸåœ°3ã¤ = 5ã¤æ‰€æœ‰
- AP =|AP 0 + (5 Ã— 10) = **50**

### ã‚¢ã‚¤ãƒ†ãƒ 

**ã‚¢ãƒ¼ãƒ¡ãƒƒãƒˆ** (`data/item.json`)
```json
{
  "id": 1001,
  "name": "ã‚¢ãƒ¼ãƒ¡ãƒƒãƒˆ",
  "effect": "AP =|AP-10ï¼›HP+40",
  "ability_parsed": {
	"effects": [
	  {
		"effect_type": "debuff_ap",
		"value": 10
	  },
	  {
		"effect_type": "buff_hp",
		"value": 40
	  }
	]
  }
}
```

**å‹•ä½œä¾‹**:
- ã‚¢ãƒ¢ãƒ³ï¼ˆAP =|AP=30, HP=30ï¼‰ãŒè£…å‚™
- AP =|AP: 30 - 10 = **20**
- HP: 30 + 40 = **70**

---

## ä½¿ç”¨æ–¹æ³•

### ã‚¹ãƒšãƒ«åŠ¹æœã®è¿½åŠ 

```gdscript
# ãƒ–ãƒ¬ãƒƒã‚·ãƒ³ã‚°ï¼ˆHP+10ã€ç§»å‹•ã§æ¶ˆãˆã‚‹ï¼‰
EffectManager.add_spell_effect_to_creature(creature_data, {
	"type": "stat_bonus",
	"stat": "hp",
	"value": 10,
	"source": "spell",
	"source_name": "ãƒ–ãƒ¬ãƒƒã‚·ãƒ³ã‚°",
	"removable": true,
	"lost_on_move": true
})
```

### ãƒã‚¹ã‚°ãƒ­ãƒ¼ã‚¹

```gdscript
# ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼0ã®å…¨ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ã®MHP+5
EffectManager.apply_mass_growth(tile_nodes, 0, 5)
```

### ãƒ‰ãƒŸãƒŠãƒ³ãƒˆã‚°ãƒ­ãƒ¼ã‚¹

```gdscript
# ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼1ã®ç«å±æ€§ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ã®ã¿MHP+10
EffectManager.apply_dominant_growth(tile_nodes, 1, "fire", 10)
```

### ç§»å‹•æ™‚ã®åŠ¹æœå‰Šé™¤

```gdscript
# ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ç§»å‹•æ™‚ã«ä¸€æ™‚åŠ¹æœã‚’ã‚¯ãƒªã‚¢
EffectManager.clear_temporary_effects(creature_data)
```

### åˆæˆåŠ¹æœ

```gdscript
# åˆæˆã«ã‚ˆã‚‹HP+10, AP+20
EffectManager.apply_synthesis_effect(creature_data, 10, 20)
```

---

## å¤‰æ›´å±¥æ­´

| æ—¥ä»˜ | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | å¤‰æ›´å†…å®¹ |
|------|-----------|---------|
| 2025/10/21 | 1.0 | åˆç‰ˆä½œæˆ - effect_system_design.mdã‹ã‚‰ä½œæˆ |
| 2025/10/21 | 2.0 | å®Ÿè£…ä»•æ§˜ç¢ºå®š - è³ªç–‘å¿œç­”ã‚’åæ˜ ã€å®Ÿè£…æº–å‚™å®Œäº† |
| 2025/10/21 | 3.0 | Phase 1-2å®Œäº†ã€Phase 3éƒ¨åˆ†å®Œäº†ã‚’è¨˜éŒ² |
| 2025/12/16 | 3.1 | ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ•´ç†ï¼ˆé‡è¤‡å‰Šé™¤ã€å®Ÿè£…å ´æ‰€ä¿®æ­£ã€ãƒ€ãƒ¡ãƒ¼ã‚¸æ¶ˆè²»é †åºä¿®æ­£ï¼‰ |

---

**æœ€çµ‚æ›´æ–°**: 2025å¹´12æœˆ16æ—¥ï¼ˆv3.1ï¼‰
