# ã‚¹ãƒšãƒ«åŠ¹æœã‚·ã‚¹ãƒ†ãƒ è¨­è¨ˆæ›¸

**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 2.0  
**æœ€çµ‚æ›´æ–°**: 2025å¹´11æœˆ3æ—¥
---
## ğŸ“‹ ç›®æ¬¡

1. [æ¦‚è¦](#æ¦‚è¦)
2. [ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£](#ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£)
3. [å®Ÿè£…æ¸ˆã¿ã‚¹ãƒšãƒ«åŠ¹æœ](#å®Ÿè£…æ¸ˆã¿ã‚¹ãƒšãƒ«åŠ¹æœ)
4. [ãƒ•ã‚©ãƒ«ãƒ€æ§‹æˆ](#ãƒ•ã‚©ãƒ«ãƒ€æ§‹æˆ)
5. [è¨­è¨ˆæ€æƒ³](#è¨­è¨ˆæ€æƒ³)
6. [ä»Šå¾Œã®æ‹¡å¼µ](#ä»Šå¾Œã®æ‹¡å¼µ)

---

## æ¦‚è¦

ãƒãƒˆãƒ«å¤–ãƒ»ãƒãƒƒãƒ—å…¨ä½“ã«å½±éŸ¿ã™ã‚‹åŠ¹æœã‚’ç®¡ç†ã™ã‚‹ã‚·ã‚¹ãƒ†ãƒ ã€‚

**ç‰¹å¾´**:
- ãƒãƒˆãƒ«ä¸­ã®åŠ¹æœï¼ˆ`scripts/battle/`ï¼‰ã¨ã¯æ˜ç¢ºã«åˆ†é›¢
- ãƒãƒƒãƒ—ãƒ¬ãƒ™ãƒ«ã®åŠ¹æœï¼ˆãƒ‰ãƒ­ãƒ¼ã€é­”åŠ›æ“ä½œã€ãƒ€ã‚¤ã‚¹æ“ä½œãªã©ï¼‰ã‚’æ‹…å½“
- å„åŠ¹æœã¯ç‹¬ç«‹ã—ãŸã‚¯ãƒ©ã‚¹ã¨ã—ã¦å®Ÿè£…

**é…ç½®ç†ç”±**:
- `battle/` = ãƒãƒˆãƒ«ä¸­ã®åŠ¹æœï¼ˆãƒ€ãƒ¡ãƒ¼ã‚¸ã€ã‚¹ã‚­ãƒ«ç­‰ï¼‰
- `spells/` = ãƒãƒˆãƒ«å¤–ã€ãƒãƒƒãƒ—å…¨ä½“ã«å½±éŸ¿ã™ã‚‹åŠ¹æœ
- å¯¾ç§°çš„ã§ç†è§£ã—ã‚„ã™ã„æ§‹é€ 

---

## ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### åŸºæœ¬æ§‹é€ 

```
GameFlowManager
  â”œâ”€ spell_draw: SpellDraw          # ãƒ‰ãƒ­ãƒ¼å‡¦ç†
  â”œâ”€ spell_magic: SpellMagic        # é­”åŠ›å¢—æ¸›ï¼ˆæœªå®Ÿè£…ï¼‰
  â”œâ”€ spell_dice: SpellDice          # ãƒ€ã‚¤ã‚¹æ“ä½œï¼ˆæœªå®Ÿè£…ï¼‰
  â”œâ”€ spell_hand: SpellHand          # æ‰‹æœ­æ“ä½œï¼ˆæœªå®Ÿè£…ï¼‰
  â””â”€ spell_land: SpellLand          # é ˜åœ°å¤‰æ›´ï¼ˆæœªå®Ÿè£…ï¼‰
```

### åˆæœŸåŒ–ãƒ•ãƒ­ãƒ¼

```gdscript
# GameFlowManager.setup_systems()
func setup_systems(p_system, c_system, ...):
	# ... ä»–ã®ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–
	
	# SpellDrawã®åˆæœŸåŒ–
	spell_draw = SpellDraw.new()
	spell_draw.setup(card_system)
	
	# å°†æ¥çš„ã«ä»–ã®ã‚¹ãƒšãƒ«åŠ¹æœã‚‚åŒæ§˜ã«åˆæœŸåŒ–
```

### ä½¿ç”¨ãƒ‘ã‚¿ãƒ¼ãƒ³

```gdscript
# ã‚¿ãƒ¼ãƒ³é–‹å§‹æ™‚ã®ãƒ‰ãƒ­ãƒ¼
var drawn = spell_draw.draw_one(player_id)

# ãƒˆã‚¥ãƒ¼ãƒ ã‚¹ãƒˆãƒ¼ãƒ³åŠ¹æœï¼ˆæ­»äº¡æ™‚ï¼‰
var drawn_cards = spell_draw.draw_until(player_id, 6)

# å›ºå®šæšæ•°ãƒ‰ãƒ­ãƒ¼ã‚¹ãƒšãƒ«
var cards = spell_draw.draw_cards(player_id, 2)
```

---

## ãƒ•ã‚©ãƒ«ãƒ€æ§‹æˆ

```
scripts/
â”œâ”€â”€ spells/                    # ã‚¹ãƒšãƒ«åŠ¹æœã‚·ã‚¹ãƒ†ãƒ 
â”‚   â”œâ”€â”€ spell_draw.gd         # ãƒ‰ãƒ­ãƒ¼å‡¦ç† âœ…
â”‚   â”œâ”€â”€ spell_magic.gd        # é­”åŠ›å¢—æ¸›ï¼ˆæœªå®Ÿè£…ï¼‰
â”‚   â”œâ”€â”€ spell_dice.gd         # ãƒ€ã‚¤ã‚¹æ“ä½œï¼ˆæœªå®Ÿè£…ï¼‰
â”‚   â”œâ”€â”€ spell_hand.gd         # æ‰‹æœ­æ“ä½œï¼ˆç ´å£Šã€äº¤æ›ï¼‰ï¼ˆæœªå®Ÿè£…ï¼‰
â”‚   â””â”€â”€ spell_land.gd         # é ˜åœ°å¤‰æ›´ï¼ˆæœªå®Ÿè£…ï¼‰

docs/design/
â”œâ”€â”€ design_spell.md           # ã‚¹ãƒšãƒ«åŠ¹æœã‚·ã‚¹ãƒ†ãƒ è¨­è¨ˆæ›¸ï¼ˆæœ¬ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
â””â”€â”€ spells/                   # å€‹åˆ¥ã‚¹ãƒšãƒ«åŠ¹æœã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
	â”œâ”€â”€ ã‚«ãƒ¼ãƒ‰ãƒ‰ãƒ­ãƒ¼.md        # ãƒ‰ãƒ­ãƒ¼å‡¦ç†ã®è©³ç´° âœ…
	â”œâ”€â”€ é­”åŠ›å¢—æ¸›.md           # é­”åŠ›å¢—æ¸›ã®è©³ç´° âœ…
	â”œâ”€â”€ ãƒ€ã‚¤ã‚¹æ“ä½œ.md         # ãƒ€ã‚¤ã‚¹æ“ä½œã®è©³ç´°ï¼ˆæœªå®Ÿè£…ï¼‰
	â”œâ”€â”€ æ‰‹æœ­æ“ä½œ.md           # æ‰‹æœ­æ“ä½œã®è©³ç´°ï¼ˆæœªå®Ÿè£…ï¼‰
	â””â”€â”€ é ˜åœ°å¤‰æ›´.md           # é ˜åœ°å¤‰æ›´ã®è©³ç´°ï¼ˆæœªå®Ÿè£…ï¼‰
```

---

## è¨­è¨ˆæ€æƒ³

### ãªãœ spells/ ãƒ•ã‚©ãƒ«ãƒ€ã«åˆ†é›¢ï¼Ÿ

1. **è²¬ä»»ã®æ˜ç¢ºåŒ–**
   - `battle/`: ãƒãƒˆãƒ«ä¸­ã®åŠ¹æœ
   - `spells/`: ãƒãƒˆãƒ«å¤–ã®åŠ¹æœ
   - æ··åœ¨ã‚’é˜²ãã€ã‚³ãƒ¼ãƒ‰ã®å¯èª­æ€§å‘ä¸Š

2. **æ‹¡å¼µæ€§**
   - æ–°ã—ã„ãƒãƒƒãƒ—åŠ¹æœã‚’è¿½åŠ ã—ã‚„ã™ã„
   - å„åŠ¹æœãŒç‹¬ç«‹ã—ãŸã‚¯ãƒ©ã‚¹ã¨ã—ã¦ç®¡ç†

3. **å†åˆ©ç”¨æ€§**
   - ã‚¹ãƒšãƒ«ã‚«ãƒ¼ãƒ‰ã€ã‚¢ã‚¤ãƒ†ãƒ åŠ¹æœã€ç‰¹æ®Šã‚¿ã‚¤ãƒ«ãªã©
   - æ§˜ã€…ãªå ´é¢ã§åŒã˜åŠ¹æœã‚’å†åˆ©ç”¨å¯èƒ½


## å®Ÿè£…æ¸ˆã¿ã‚¹ãƒšãƒ«åŠ¹æœ

### 1. SpellDrawï¼ˆã‚«ãƒ¼ãƒ‰ãƒ‰ãƒ­ãƒ¼ï¼‰âœ…

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `scripts/spells/spell_draw.gd`

**ãƒ¡ã‚½ãƒƒãƒ‰**:
```gdscript
func draw_one(player_id: int) -> Dictionary          # ã‚¿ãƒ¼ãƒ³é–‹å§‹æ™‚ã®1æšãƒ‰ãƒ­ãƒ¼
func draw_cards(player_id: int, count: int) -> Array # å›ºå®šæšæ•°ãƒ‰ãƒ­ãƒ¼
func draw_until(player_id: int, target: int) -> Array # æŒ‡å®šæšæ•°ã¾ã§è£œå……
func exchange_all_hand(player_id: int) -> Array      # æ‰‹æœ­å…¨äº¤æ›
```

**è©³ç´°**: [ã‚«ãƒ¼ãƒ‰ãƒ‰ãƒ­ãƒ¼.md](./spells/ã‚«ãƒ¼ãƒ‰ãƒ‰ãƒ­ãƒ¼.md)

---

### 2. SpellMagicï¼ˆé­”åŠ›å¢—æ¸›ï¼‰âœ…

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `scripts/spells/spell_magic.gd`

**ãƒ¡ã‚½ãƒƒãƒ‰**:
```gdscript
func add_magic(player_id: int, amount: int)                        # é­”åŠ›å¢—åŠ 
func reduce_magic(player_id: int, amount: int)                     # é­”åŠ›æ¸›å°‘
func steal_magic(from_id: int, to_id: int, amount: int) -> int    # é­”åŠ›å¥ªå–
```

**å®Ÿè£…ã‚¢ã‚¤ãƒ†ãƒ **:
- ã‚¼ãƒ©ãƒãƒ³ã‚¢ãƒ¼ãƒãƒ¼ï¼ˆID: 1029ï¼‰: ãƒ€ãƒ¡ãƒ¼ã‚¸å—ã‘å–ã‚Šæ™‚ã«é­”åŠ›ç²å¾—
- ã‚´ãƒ¼ãƒ«ãƒ‰ãƒãƒ³ãƒãƒ¼ï¼ˆID: 1012ï¼‰: æ•µéç ´å£Šæ™‚ã«é­”åŠ›ç²å¾—
- ã‚´ãƒ¼ãƒ«ãƒ‰ã‚°ãƒ¼ã‚¹ï¼ˆID: 1011ï¼‰: æ­»äº¡æ™‚ã«é­”åŠ›ç²å¾—

**è©³ç´°**: [é­”åŠ›å¢—æ¸›.md](./spells/é­”åŠ›å¢—æ¸›.md)

---

## ä»Šå¾Œã®æ‹¡å¼µ

### 3. SpellDiceï¼ˆãƒ€ã‚¤ã‚¹æ“ä½œï¼‰

**äºˆå®šãƒ¡ã‚½ãƒƒãƒ‰**:
```gdscript
func modify_dice(player_id: int, modifier: int)  # ãƒ€ã‚¤ã‚¹ç›®å¤‰æ›´
func reroll_dice(player_id: int)                 # æŒ¯ã‚Šç›´ã—
func fix_dice(player_id: int, value: int)        # å›ºå®šå€¤ã«è¨­å®š
```

**ä½¿ç”¨ä¾‹**:
- ãƒ€ã‚¤ã‚¹+1ã‚¹ãƒšãƒ«
- å¥½ããªç›®ã‚’å‡ºã™ã‚¹ãƒšãƒ«

### 4. SpellHandï¼ˆæ‰‹æœ­æ“ä½œï¼‰

**äºˆå®šãƒ¡ã‚½ãƒƒãƒ‰**:
```gdscript
func discard_random(player_id: int, count: int)  # ãƒ©ãƒ³ãƒ€ãƒ ç ´æ£„
func discard_by_type(player_id: int, card_type: String)  # ã‚¿ã‚¤ãƒ—æŒ‡å®šç ´æ£„
func steal_card(from_id: int, to_id: int)        # æ‰‹æœ­ã‚’å¥ªã†
```

**ä½¿ç”¨ä¾‹**:
- æ‰‹æœ­ç ´å£Šã‚¹ãƒšãƒ«
- ã‚«ãƒ¼ãƒ‰ç›—ã¿ã‚¹ãƒšãƒ«

### 5. SpellLandï¼ˆé ˜åœ°å¤‰æ›´ï¼‰

**äºˆå®šãƒ¡ã‚½ãƒƒãƒ‰**:
```gdscript
func change_element(tile_index: int, new_element: String)  # å±æ€§å¤‰æ›´
func change_level(tile_index: int, delta: int)             # ãƒ¬ãƒ™ãƒ«å¤‰æ›´
func destroy_creature(tile_index: int)                     # ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ç ´å£Š
```

**ä½¿ç”¨ä¾‹**:
- åœŸåœ°å¤‰æ›ã‚¹ãƒšãƒ«
- åœŸåœ°ãƒ¬ãƒ™ãƒ«ãƒ€ã‚¦ãƒ³ã‚¹ãƒšãƒ«
- ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ç ´å£Šã‚¹ãƒšãƒ«

---

## å®Ÿè£…ã‚¢ã‚¤ãƒ†ãƒ ãƒ»åŠ¹æœä¸€è¦§

### ãƒ‰ãƒ­ãƒ¼åŠ¹æœã‚’æŒã¤ã‚¢ã‚¤ãƒ†ãƒ 

| ID | åå‰ | åŠ¹æœ | å®Ÿè£…çŠ¶æ³ |
|----|------|------|---------|
| 1038 | ãƒˆã‚¥ãƒ¼ãƒ ã‚¹ãƒˆãƒ¼ãƒ³ | è‡ªç ´å£Šæ™‚ã€æ‰‹æœ­6æšã¾ã§ã‚«ãƒ¼ãƒ‰ã‚’å¼•ã | âœ… å®Ÿè£…æ¸ˆã¿ |

### ä»Šå¾Œå®Ÿè£…äºˆå®š

- ãƒ€ã‚¤ã‚¹æ“ä½œã‚¹ãƒšãƒ«
- æ‰‹æœ­ç ´å£Šã‚¹ãƒšãƒ«
- é ˜åœ°å¤‰æ›´ã‚¹ãƒšãƒ«

---

## æŠ€è¡“çš„ãªæ³¨æ„äº‹é …

### å‚ç…§ã®åˆæœŸåŒ–é †åº

```gdscript
# game_3d.gd ã¾ãŸã¯ GameFlowManager
# 1. CardSystemã‚’å…ˆã«åˆæœŸåŒ–
card_system = CardSystem.new()

# 2. SpellDrawã‚’åˆæœŸåŒ–ï¼ˆCardSystemã¸ã®å‚ç…§ãŒå¿…è¦ï¼‰
spell_draw = SpellDraw.new()
spell_draw.setup(card_system)
```

### BattleSpecialEffectsã¸ã®çµ±åˆ

æ­»äº¡æ™‚åŠ¹æœã§ä½¿ç”¨ã™ã‚‹å ´åˆï¼š

```gdscript
# battle_system.gd
func setup_systems(board_system, card_system, player_system):
	# SpellDrawã®å‚ç…§ã‚’å–å¾—
	var spell_draw = null
	if game_flow_manager_ref and game_flow_manager_ref.spell_draw:
		spell_draw = game_flow_manager_ref.spell_draw
	
	# BattleSpecialEffectsã«æ¸¡ã™
	battle_special_effects.setup_systems(board_system, spell_draw)
```

### ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

```gdscript
# SpellDrawå†…éƒ¨
if not card_system_ref:
	push_error("SpellDraw: CardSystemãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“")
	return {}
```

---

## å‚ç…§ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- **ã‚«ãƒ¼ãƒ‰ã‚·ã‚¹ãƒ†ãƒ **: `scripts/card_system.gd`
- **ã‚²ãƒ¼ãƒ ãƒ•ãƒ­ãƒ¼**: `scripts/game_flow_manager.gd`
- **ãƒãƒˆãƒ«ç‰¹æ®ŠåŠ¹æœ**: `scripts/battle/battle_special_effects.gd`
- **å€‹åˆ¥ã‚¹ãƒšãƒ«åŠ¹æœ**: `docs/design/spells/`

---

**æœ€çµ‚æ›´æ–°**: 2025å¹´11æœˆ3æ—¥ï¼ˆv1.0ï¼‰
