# ã‚¯ã‚¨ã‚¹ãƒˆã‚·ã‚¹ãƒ†ãƒ è¨­è¨ˆæ›¸

**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.2  
**æœ€çµ‚æ›´æ–°**: 2025å¹´1æœˆ19æ—¥  
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: å®Ÿè£…ä¸­

---

## ğŸ“‹ ç›®æ¬¡

1. [æ¦‚è¦](#æ¦‚è¦)
2. [ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆ](#ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆ)
3. [ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ](#ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ )
4. [JSONã‚¹ã‚­ãƒ¼ãƒè¨­è¨ˆ](#jsonã‚¹ã‚­ãƒ¼ãƒè¨­è¨ˆ)
5. [CPU AIè¨­è¨ˆ](#cpu-aiè¨­è¨ˆ)
6. [å®Ÿè£…çŠ¶æ³](#å®Ÿè£…çŠ¶æ³)
7. [å°†æ¥ã®ã‚µãƒ¼ãƒãƒ¼ç§»è¡Œ](#å°†æ¥ã®ã‚µãƒ¼ãƒãƒ¼ç§»è¡Œ)

---

## æ¦‚è¦

### ç›®çš„

ã‚½ãƒ­ãƒ—ãƒ¬ã‚¤ç”¨ã®ã‚¯ã‚¨ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰ã‚’å®Ÿè£…ã™ã‚‹ã€‚ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯ãƒ¯ãƒ¼ãƒ«ãƒ‰ã‚’é€²è¡Œã—ã€å„ã‚¹ãƒ†ãƒ¼ã‚¸ã§CPUæ•µã¨å¯¾æˆ¦ã™ã‚‹ã€‚

### åŸºæœ¬ä»•æ§˜

| é …ç›® | å†…å®¹ |
|------|------|
| ã‚¹ãƒ†ãƒ¼ã‚¸æ•° | 20ä»¥ä¸Š |
| ãƒãƒƒãƒ—ç¨®é¡ | 10ç¨®é¡ï¼ˆä½¿ã„å›ã—ï¼‰ |
| æ•µã‚­ãƒ£ãƒ© | 10ç¨®é¡ï¼ˆä½¿ã„å›ã—ï¼‰ |
| ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æ§‹æˆ | 1äºº vs CPU 1ã€œ3ä½“ |
| é€²è¡Œæ–¹å¼ | ãƒ¯ãƒ¼ãƒ«ãƒ‰åˆ¶ï¼ˆ1-1 â†’ 1-2 â†’ 1-3ã€ä¸¦è¡Œã—ã¦2-1 â†’ 2-2ç­‰ï¼‰ |

### æ—¢å­˜ã‚·ã‚¹ãƒ†ãƒ ã¨ã®é–¢ä¿‚

```
MainMenu
â”œâ”€â”€ ã‚½ãƒ­ãƒãƒˆãƒ« â†’ Main.tscnï¼ˆãƒ†ã‚¹ãƒˆç’°å¢ƒã€StageLoaderã‚’ä½¿ç”¨ï¼‰
â””â”€â”€ ã‚¯ã‚¨ã‚¹ãƒˆ â†’ StageSelect.tscn
			  â””â”€â”€ Quest.tscnï¼ˆå‹•çš„ã«ãƒãƒƒãƒ—ç”Ÿæˆï¼‰
```

### é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ãƒ«ãƒ¼ãƒ«è¨­è¨ˆæ›¸](online_rules_design.md) - ãƒ«ãƒ¼ãƒ«ãƒ—ãƒªã‚»ãƒƒãƒˆã€å‹åˆ©æ¡ä»¶ã€ã‚«ãƒ¼ãƒ‰åˆ¶é™
- [ãƒãƒƒãƒ—ã‚·ã‚¹ãƒ†ãƒ ä»•æ§˜](map_system.md) - ãƒãƒƒãƒ—æ§‹é€ ã€å‘¨å›ã‚·ã‚¹ãƒ†ãƒ 

---

## ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆ

### ãƒ‡ãƒ¼ã‚¿ã®åˆ†é¡

| ç¨®é¡ | èª¬æ˜ | ãƒ•ã‚¡ã‚¤ãƒ«æ•° | å†åˆ©ç”¨ |
|------|------|-----------|--------|
| ãƒ¯ãƒ¼ãƒ«ãƒ‰å®šç¾© | ãƒ¯ãƒ¼ãƒ«ãƒ‰ä¸€è¦§ãƒ»è§£æ”¾æ¡ä»¶ | 1 | - |
| ã‚¹ãƒ†ãƒ¼ã‚¸å®šç¾© | ãƒãƒƒãƒ—ID + ãƒ«ãƒ¼ãƒ« + æ•µæ§‹æˆ | ã‚¹ãƒ†ãƒ¼ã‚¸æ•°åˆ† | - |
| ãƒãƒƒãƒ—å®šç¾© | ã‚¿ã‚¤ãƒ«é…ç½®ãƒ»æ¥ç¶šãƒ»åº§æ¨™ | 10ç¨‹åº¦ | âœ“ |
| ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼å®šç¾© | åå‰ãƒ»3Dãƒ¢ãƒ‡ãƒ«ãƒ‘ã‚¹ | 1 | âœ“ |
| ãƒ‡ãƒƒã‚­å®šç¾© | ã‚«ãƒ¼ãƒ‰IDãƒªã‚¹ãƒˆ | 10ã€œ20ç¨‹åº¦ | âœ“ |
| AIãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ« | æˆ¦ç•¥ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | 5ã€œ10ç¨‹åº¦ | âœ“ |

### å‚ç…§æ–¹å¼

```
stage_1_1.json
â”œâ”€â”€ map_id: "map_diamond_20" â†’ maps/map_diamond_20.json
â”œâ”€â”€ rule_preset: "quick" â†’ game_constants.gd RULE_PRESETS
â””â”€â”€ quest.enemies[0]
		â”œâ”€â”€ character_id: "goblin" â†’ characters.json
		â”œâ”€â”€ deck_id: "deck_fire_basic" â†’ decks/deck_fire_basic.json
		â””â”€â”€ ai_level: 3
```

---

## ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

```
data/
â”œâ”€â”€ master/                          # ãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿
â”‚   â”œâ”€â”€ worlds/
â”‚   â”‚   â””â”€â”€ world_list.json          # ãƒ¯ãƒ¼ãƒ«ãƒ‰ä¸€è¦§ãƒ»è§£æ”¾æ¡ä»¶
â”‚   â”œâ”€â”€ stages/
â”‚   â”‚   â”œâ”€â”€ stage_1_1.json           # ã‚¹ãƒ†ãƒ¼ã‚¸å®šç¾©
â”‚   â”‚   â”œâ”€â”€ stage_1_2.json
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ maps/
â”‚   â”‚   â”œâ”€â”€ map_diamond_20.json
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ characters/
â”‚   â”‚   â””â”€â”€ characters.json          # å…¨CPUã‚­ãƒ£ãƒ©å®šç¾©
â”‚   â”œâ”€â”€ decks/
â”‚   â”‚   â”œâ”€â”€ deck_fire_basic.json
â”‚   â”‚   â””â”€â”€ ...
â”‚   â””â”€â”€ ai_profiles/
â”‚       â”œâ”€â”€ easy.json
â”‚       â””â”€â”€ ...
â”‚
â””â”€â”€ local/                           # ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿
	â””â”€â”€ user_save.json               # é€²è¡ŒçŠ¶æ³ã€æ‰€æŒã‚«ãƒ¼ãƒ‰ç­‰
```

---

## JSONã‚¹ã‚­ãƒ¼ãƒè¨­è¨ˆ

### 1. world_list.jsonï¼ˆãƒ¯ãƒ¼ãƒ«ãƒ‰ä¸€è¦§ï¼‰

```json
{
  "worlds": [
	{
	  "id": "world_1",
	  "name": "è‰åŸã®å›½",
	  "stages": ["stage_1_1", "stage_1_2", "stage_1_3"],
	  "unlock_condition": null
	},
	{
	  "id": "world_2",
	  "name": "ç‚ã®å›½",
	  "stages": ["stage_2_1", "stage_2_2", "stage_2_3"],
	  "unlock_condition": {"type": "stage_clear", "stage_id": "stage_1_1"}
	}
  ]
}
```

---

### 2. stage_X_X.jsonï¼ˆã‚¹ãƒ†ãƒ¼ã‚¸å®šç¾©ï¼‰

**æ–°ã—ã„æ§‹é€ **ï¼ˆãƒ«ãƒ¼ãƒ«ã¨ã‚¯ã‚¨ã‚¹ãƒˆå°‚ç”¨ãƒ‡ãƒ¼ã‚¿ã‚’åˆ†é›¢ï¼‰:

```json
{
  "id": "stage_1_1",
  "name": "ã¯ã˜ã¾ã‚Šã®è‰åŸ",
  "description": "æœ€åˆã®è©¦ç·´ã€‚åŸºæœ¬ã‚’å­¦ã¼ã†ã€‚",
  "map_id": "map_diamond_20",
  
  "rule_preset": "quick",
  "rule_overrides": {
	"initial_magic": {"player": 3000, "cpu": 500},
	"win_conditions": {
	  "mode": "all",
	  "conditions": [
		{"type": "magic", "target": 4000, "timing": "checkpoint"}
	  ]
	}
  },
  
  "quest": {
	"enemies": [
	  {
		"character_id": "goblin",
		"deck_id": "deck_fire_basic",
		"ai_level": 3,
		"start_tile": 0
	  }
	],
	"rewards": {
	  "first_clear": {"type": "gold", "amount": 1000},
	  "repeat": {"type": "gold", "amount": 200}
	}
  }
}
```

#### ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰èª¬æ˜

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ | èª¬æ˜ |
|-----------|------|
| `map_id` | ä½¿ç”¨ã™ã‚‹ãƒãƒƒãƒ—ã®ID |
| `rule_preset` | ãƒ«ãƒ¼ãƒ«ãƒ—ãƒªã‚»ãƒƒãƒˆåï¼ˆgame_constants.gdã‹ã‚‰ï¼‰ |
| `rule_overrides` | ãƒ—ãƒªã‚»ãƒƒãƒˆã‚’ä¸Šæ›¸ãã™ã‚‹ã‚«ã‚¹ã‚¿ãƒ è¨­å®šï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰ |
| `quest` | ã‚½ãƒ­ã‚¯ã‚¨ã‚¹ãƒˆå°‚ç”¨ãƒ‡ãƒ¼ã‚¿ |

#### ãƒ«ãƒ¼ãƒ«é–¢é€£

ãƒ«ãƒ¼ãƒ«ãƒ—ãƒªã‚»ãƒƒãƒˆã¨å‹åˆ©æ¡ä»¶ã®è©³ç´°ã¯ [ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ãƒ«ãƒ¼ãƒ«è¨­è¨ˆæ›¸](online_rules_design.md) ã‚’å‚ç…§ã€‚

---

### 3. characters.jsonï¼ˆã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼å®šç¾©ï¼‰

```json
{
  "characters": {
	"goblin": {
	  "name": "ã‚´ãƒ–ãƒªãƒ³",
	  "model_path": "res://scenes/Characters/Goblin.tscn",
	  "portrait_path": "res://assets/portraits/goblin.png",
	  "description": "å°ã•ã„ãŒå‡¶æš´ãªé­”ç‰©"
	},
	"knight": {
	  "name": "é¨å£«",
	  "model_path": "res://scenes/Characters/Knight.tscn",
	  "portrait_path": "res://assets/portraits/knight.png",
	  "description": "æ­£ç¾©ã‚’ä¿¡ã˜ã‚‹æˆ¦å£«"
	}
  }
}
```

---

### 4. deck_*.jsonï¼ˆãƒ‡ãƒƒã‚­å®šç¾©ï¼‰

```json
{
  "id": "deck_fire_basic",
  "name": "ç‚ã®åŸºæœ¬ãƒ‡ãƒƒã‚­",
  "description": "ç«å±æ€§ä¸­å¿ƒã®æ”»æ’ƒçš„ãƒ‡ãƒƒã‚­",
  "cards": [
	{"id": 1, "count": 3},
	{"id": 5, "count": 2},
	{"id": 12, "count": 4}
  ]
}
```

---

### 5. ai_profiles/*.jsonï¼ˆAIãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰

```json
{
  "id": "easy",
  "name": "åˆç´š",
  "description": "åˆå¿ƒè€…å‘ã‘",
  "difficulty_level": 3,
  "behavior": {
	"summon_rate": 0.6,
	"invasion_rate": 0.4,
	"battle_rate": 0.5,
	"levelup_rate": 0.3
  }
}
```

---

### 6. user_save.jsonï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿ï¼‰

```json
{
  "user_id": "local_user",
  "cleared_stages": ["stage_1_1", "stage_1_2"],
  "unlocked_worlds": ["world_1", "world_2"],
  "owned_cards": [
	{"card_id": 1, "count": 3},
	{"card_id": 5, "count": 1}
  ],
  "gold": 5000,
  "player_decks": [
	{
	  "name": "ãƒ¡ã‚¤ãƒ³ãƒ‡ãƒƒã‚­",
	  "cards": [1, 1, 5, 12, 12]
	}
  ],
  "last_played": "2025-01-19T10:30:00Z"
}
```

---

## CPU AIè¨­è¨ˆ

### æ—¢å­˜å®Ÿè£…

| ã‚¯ãƒ©ã‚¹ | å½¹å‰² | çŠ¶æ…‹ |
|--------|------|------|
| `CPUAIHandler` | åˆ¤æ–­ãƒ­ã‚¸ãƒƒã‚¯ | âœ“ å®Ÿè£…æ¸ˆã¿ |
| `CPUTurnProcessor` | ã‚¿ãƒ¼ãƒ³å®Ÿè¡Œ | âœ“ å®Ÿè£…æ¸ˆã¿ |

### å‹•ä½œåˆ‡ã‚Šæ›¿ãˆ

```gdscript
# ã‚½ãƒ­ãƒãƒˆãƒ«ï¼ˆãƒ†ã‚¹ãƒˆç”¨ï¼‰
player_is_cpu = [false, true]
debug_manual_control_all = true  # CPUã‚‚æ‰‹å‹•æ“ä½œå¯èƒ½

# ã‚¯ã‚¨ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰
player_is_cpu = [false, true, true, true]
debug_manual_control_all = false  # CPUã¯AIä»»ã›
```

### AIãƒ¬ãƒ™ãƒ«ã¨æ©Ÿèƒ½

| Level | åŸºæœ¬è©•ä¾¡ | ãƒ†ãƒ³ãƒè©•ä¾¡ | ã‚·ãƒŠã‚¸ãƒ¼ | å…ˆèª­ã¿ | ãƒ©ãƒ³ãƒ€ãƒ è¦ç´  |
|-------|---------|-----------|---------|--------|-------------|
| 1-3 | âœ“ | - | - | 0 | 30% |
| 4-6 | âœ“ | âœ“ | âœ“ | 1 | 10% |
| 7-10 | âœ“ | âœ“ | âœ“ | 2 | 0% |

---

## å®Ÿè£…çŠ¶æ³

### âœ… å®Ÿè£…æ¸ˆã¿

- [x] ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 
- [x] StageLoaderï¼ˆJSONèª­ã¿è¾¼ã¿ãƒ»ãƒãƒƒãƒ—ç”Ÿæˆï¼‰
- [x] QuestGameï¼ˆã‚¯ã‚¨ã‚¹ãƒˆç”¨ã‚²ãƒ¼ãƒ ç®¡ç†ï¼‰
- [x] ãƒãƒƒãƒ—JSONï¼ˆmap_diamond_20ç­‰ï¼‰
- [x] ã‚¹ãƒ†ãƒ¼ã‚¸JSONï¼ˆstage_1_1ã€œstage_2_2ï¼‰
- [x] ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼JSON
- [x] AIãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«JSONï¼ˆeasyï¼‰
- [x] ãƒ‡ãƒƒã‚­JSON

### ğŸš§ æœªå®Ÿè£…

- [ ] ã‚¹ãƒ†ãƒ¼ã‚¸é¸æŠUI
- [ ] ãƒ¯ãƒ¼ãƒ«ãƒ‰é¸æŠUI
- [ ] å ±é…¬ã‚·ã‚¹ãƒ†ãƒ 
- [ ] é€²è¡ŒçŠ¶æ³ä¿å­˜
- [ ] AIãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«é©ç”¨ï¼ˆé›£æ˜“åº¦èª¿æ•´ï¼‰
- [ ] ãƒ«ãƒ¼ãƒ«ãƒ—ãƒªã‚»ãƒƒãƒˆå¯¾å¿œï¼ˆgame_constants.gdæ›´æ–°ï¼‰

---

## å°†æ¥ã®ã‚µãƒ¼ãƒãƒ¼ç§»è¡Œ

### ç¾åœ¨ã®è¨­è¨ˆæ€æƒ³

```
data/
â”œâ”€â”€ master/   â† å°†æ¥ã‚µãƒ¼ãƒãƒ¼ã¸ï¼ˆæ§‹é€ å¤‰æ›´ãªã—ï¼‰
â””â”€â”€ local/    â† å°†æ¥ã‚µãƒ¼ãƒãƒ¼DBã¸
```

### ç§»è¡Œæ™‚ã®å¤‰æ›´ç‚¹

| é …ç›® | ç¾åœ¨ | ç§»è¡Œå¾Œ |
|------|------|--------|
| ãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ | `FileAccess.open()` | `HTTPRequest` |
| ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿ä¿å­˜ | `user_save.json` | ã‚µãƒ¼ãƒãƒ¼API |
| èªè¨¼ | ãªã— | OAuthç­‰ |

### ãƒ­ãƒ¼ãƒ€ãƒ¼ã®æŠ½è±¡åŒ–

```gdscript
# ä»Š
func load_stage(stage_id: String) -> Dictionary:
	var file = FileAccess.open("res://data/master/stages/%s.json" % stage_id, FileAccess.READ)
	return JSON.parse_string(file.get_as_text())

# å°†æ¥ï¼ˆå·®ã—æ›¿ãˆã‚‹ã ã‘ï¼‰
func load_stage(stage_id: String) -> Dictionary:
	var response = await http.request("https://api.example.com/stages/%s" % stage_id)
	return JSON.parse_string(response.body)
```

**JSONã®æ§‹é€ ã¯å¤‰ã‚ã‚‰ãªã„ã€‚èª­ã¿è¾¼ã¿æ–¹æ³•ã ã‘å¤‰æ›´ã€‚**

---

## å¤‰æ›´å±¥æ­´

| ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | æ—¥ä»˜ | å¤‰æ›´å†…å®¹ |
|-----------|------|---------|
| 1.0 | 2025/12/15 | åˆç‰ˆä½œæˆ |
| 1.1 | 2025/12/16 | ãƒãƒƒãƒ—JSONã‚¹ã‚­ãƒ¼ãƒã«lap_settingsè¿½åŠ  |
| 1.2 | 2025/01/19 | ãƒ«ãƒ¼ãƒ«é–¢é€£ã‚’online_rules_design.mdã«åˆ†é›¢ã€ã‚¹ãƒ†ãƒ¼ã‚¸JSONæ§‹é€ ã‚’æ›´æ–° |
