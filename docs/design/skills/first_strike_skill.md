# 先制スキル

**プロジェクト**: カルドセプト風カードバトルゲーム  
**バージョン**: 1.5  
**最終更新**: 2025年10月24日

---

## 📋 目次

1. [概要](#概要)
2. [発動条件](#発動条件)
3. [効果](#効果)
4. [判定ロジック](#判定ロジック)
5. [データ構造](#データ構造)
6. [使用例](#使用例)
7. [戦略的価値](#戦略的価値)

---

## 概要

バトルで先に攻撃できるパッシブスキル。

---

## 発動条件

- `keywords`配列に「先制」が含まれる
- **無条件発動**

---

## 効果

- 攻撃順で優先される
- 両者が先制を持つ場合、**侵略側が優先**

---

## 判定ロジック

### 攻撃順の決定

```gdscript
func _determine_attack_order(attacker: BattleParticipant, defender: BattleParticipant) -> Array:
	if attacker.has_first_strike and defender.has_first_strike:
		return [attacker, defender]  # 両者先制 → 侵略側優先
	elif defender.has_first_strike:
		return [defender, attacker]  # 防御側のみ先制
	else:
		return [attacker, defender]  # デフォルト（侵略側先攻）
```

### 判定パターン

| 侵略側 | 防御側 | 攻撃順 |
|--------|--------|--------|
| 先制あり | 先制あり | 侵略側 → 防御側 |
| 先制あり | 先制なし | 侵略側 → 防御側 |
| 先制なし | 先制あり | 防御側 → 侵略側 |
| 先制なし | 先制なし | 侵略側 → 防御側 |

---

## データ構造

```json
{
  "ability_parsed": {
	"keywords": ["先制"]
  }
}
```

---

## 使用例

### シナリオ1: 基本的な先制攻撃

```
侵略側: フェニックス（AP:30、先制あり）
防御側: グレムリン（AP:40、HP:30、先制なし）

攻撃順:
1. フェニックスの攻撃（先制）
   → グレムリンに30ダメージ
   → グレムリン撃破

2. グレムリンの反撃
   → 既に撃破されているため攻撃なし

結果: フェニックスの勝利（無傷）
```

### シナリオ2: 両者が先制を持つ場合

```
侵略側: バハムート（AP:50、HP:60、先制あり）
防御側: ヨルムンガンド（AP:60、HP:70、先制あり）

攻撃順:
1. バハムート（侵略側）の攻撃
   → ヨルムンガンドに50ダメージ
   → ヨルムンガンドHP: 70 → 20

2. ヨルムンガンド（防御側）の反撃
   → バハムートに60ダメージ
   → バハムートHP: 60 → 0

結果: ヨルムンガンドの勝利
```

### シナリオ3: 防御側のみ先制

```
侵略側: ナイトメア（AP:50、HP:40、先制なし）
防御側: フェニックス（AP:30、HP:30、先制あり）

攻撃順:
1. フェニックスの攻撃（先制）
   → ナイトメアに30ダメージ
   → ナイトメアHP: 40 → 10

2. ナイトメアの反撃
   → フェニックスに50ダメージ
   → フェニックス撃破

結果: ナイトメアの勝利（HP10残存）
```

---

## 戦略的価値

### メリット

1. **一方的な攻撃**: APが相手より低くても先手を取れる
2. **相手を倒せれば無傷**: 先制攻撃で相手を倒せば反撃を受けない
3. **防御時にも有効**: 防御側でも先制があれば先に攻撃可能

### デメリット

1. **火力不足時は意味なし**: 相手を倒せなければ結局反撃を受ける
2. **HP管理が重要**: 反撃を受ける前提で計算が必要
3. **両者先制時は侵略側有利**: 防御時は侵略側優先のため不利

### 相性の良いスキル

- **2回攻撃**: 先制で2回攻撃すれば相手を倒しやすい
- **強打**: 先制で高火力を出せば一撃必殺
- **貫通**: 先制で土地ボーナスを無視して攻撃

---

## 実装クリーチャー

先制スキルを持つクリーチャーの例：

| ID | 名前 | 属性 | AP | HP | その他スキル |
|----|------|------|----|----|-------------|
| 133 | バハムート | 水 | 50 | 60 | 土地変性・再生 |
| 242 | ヨルムンガンド | 地 | 60 | 70 | 土地変性・再生 |
| 45 | フェニックス | 火 | 30 | 30 | - |

（注: 実際のクリーチャーデータは`data/creatures/`を参照）

---

## 変更履歴

| バージョン | 日付 | 変更内容 |
|-----------|------|---------|
| 1.5 | 2025/10/24 | 個別ドキュメントとして分離 |
