# æ­»äº¡æ™‚åŠ¹æœã‚¹ã‚­ãƒ«

**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0  
**æœ€çµ‚æ›´æ–°**: 2025å¹´11æœˆ2æ—¥

---

## ğŸ“‹ ç›®æ¬¡

1. [æ¦‚è¦](#æ¦‚è¦)
2. [ç™ºå‹•ã‚¿ã‚¤ãƒŸãƒ³ã‚°](#ç™ºå‹•ã‚¿ã‚¤ãƒŸãƒ³ã‚°)
3. [åŠ¹æœã‚¿ã‚¤ãƒ—](#åŠ¹æœã‚¿ã‚¤ãƒ—)
4. [å®Ÿè£…å ´æ‰€](#å®Ÿè£…å ´æ‰€)
5. [åŠ¹æœè©³ç´°](#åŠ¹æœè©³ç´°)
6. [å®Ÿè£…ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ãƒ»ã‚¢ã‚¤ãƒ†ãƒ ](#å®Ÿè£…ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ã‚¢ã‚¤ãƒ†ãƒ )
7. [ä»–ã‚¹ã‚­ãƒ«ã¨ã®ç›¸äº’ä½œç”¨](#ä»–ã‚¹ã‚­ãƒ«ã¨ã®ç›¸äº’ä½œç”¨)
8. [å®Ÿè£…ã‚³ãƒ¼ãƒ‰](#å®Ÿè£…ã‚³ãƒ¼ãƒ‰)
9. [ä½¿ç”¨ä¾‹](#ä½¿ç”¨ä¾‹)
10. [è¨­è¨ˆæ€æƒ³](#è¨­è¨ˆæ€æƒ³)

---

## æ¦‚è¦

ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ãŒæˆ¦é—˜ã§æ’ƒç ´ã•ã‚ŒãŸæ™‚ã«ç™ºå‹•ã™ã‚‹ç‰¹æ®ŠåŠ¹æœã€‚ç›¸æ‰‹ã«ãƒ€ãƒ¡ãƒ¼ã‚¸ã‚’ä¸ãˆãŸã‚Šã€ç‰¹æ®Šãªå½±éŸ¿ã‚’ä¸ãˆã‚‹ã€‚

**ç‰¹å¾´**:
- trigger `"on_death"` ã§çµ±ä¸€
- æ’ƒç ´ã•ã‚ŒãŸå´ã®ã‚¢ã‚¤ãƒ†ãƒ /èƒ½åŠ›ã‹ã‚‰ç™ºå‹•
- ä¾µç•¥å´/é˜²è¡›å´ã«é–¢ä¿‚ãªãå‹•ä½œ
- è¤‡æ•°ã®åŠ¹æœã‚¿ã‚¤ãƒ—ã‚’çµ±åˆç®¡ç†

---

## ç™ºå‹•ã‚¿ã‚¤ãƒŸãƒ³ã‚°

### ã‚¿ã‚¤ãƒŸãƒ³ã‚°è©³ç´°

```
æ”»æ’ƒå®Ÿè¡Œ
  â†“
ãƒ€ãƒ¡ãƒ¼ã‚¸å‡¦ç†
  â†“
ã€æ’ƒç ´åˆ¤å®šã€‘â† ã“ã“ã§æ­»äº¡æ™‚åŠ¹æœã‚’ãƒã‚§ãƒƒã‚¯
  â†“
æ­»è€…å¾©æ´»ãƒã‚§ãƒƒã‚¯
  â†“
æ¬¡ã®æ”»æ’ƒ or æˆ¦é—˜çµ‚äº†
```

### ç™ºå‹•æ¡ä»¶

1. **ä½¿ç”¨è€…ï¼ˆè£…å‚™è€…ï¼‰ãŒæ’ƒç ´ã•ã‚ŒãŸ**
2. **ç›¸æ‰‹ãŒç”Ÿå­˜ã—ã¦ã„ã‚‹**ï¼ˆåŠ¹æœã«ã‚ˆã£ã¦ã¯ä¸è¦ï¼‰
3. trigger ãŒ `"on_death"` ã§ã‚ã‚‹

---

## åŠ¹æœã‚¿ã‚¤ãƒ—

### 1. instant_deathï¼ˆé“é€£ã‚Œï¼‰

ç›¸æ‰‹ã‚’å³æ­»ã•ã›ã‚‹åŠ¹æœã€‚

**ç‰¹å¾´**:
- ç¢ºç‡åˆ¤å®šã‚ã‚Šï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ100%ï¼‰
- target `"attacker"` ã§ç›¸æ‰‹ã‚’æŒ‡å®š
- å³æ­»ãƒ•ãƒ©ã‚°ã‚’ç«‹ã¦ã‚‹

### 2. revenge_mhp_damageï¼ˆé›ªè¾±ï¼‰

ç›¸æ‰‹ã®MHPï¼ˆæœ€å¤§HPï¼‰ã«ç›´æ¥ãƒ€ãƒ¡ãƒ¼ã‚¸ã€‚

**ç‰¹å¾´**:
- ãƒœãƒ¼ãƒŠã‚¹HPã‚’ç„¡è¦–ã—ã¦MHPç¯„å›²ã‚’å‰Šã‚‹
- MHPãŒ0ä»¥ä¸‹ã«ãªã‚‹ã¨å³æ­»
- ç›¸æ‰‹ãŒç”Ÿå­˜ã—ã¦ã„ã‚‹å ´åˆã®ã¿ç™ºå‹•

---

## å®Ÿè£…å ´æ‰€

### battle_special_effects.gd

**é–¢æ•°**: `check_on_death_effects(defeated: BattleParticipant, opponent: BattleParticipant) -> Dictionary`

**é…ç½®ç†ç”±**:
- ç‰¹æ®Šãªæˆ¦é—˜åŠ¹æœã‚’æ‰±ã†å°‚é–€ã‚¯ãƒ©ã‚¹
- é“é€£ã‚Œã€é›ªè¾±ãªã©è¤‡æ•°ã®æ­»äº¡æ™‚åŠ¹æœã‚’çµ±åˆç®¡ç†
- æˆ¦é—˜ãƒ•ãƒ­ãƒ¼ï¼ˆbattle_execution.gdï¼‰ã‹ã‚‰åˆ†é›¢

**å‘¼ã³å‡ºã—ç®‡æ‰€**:
- `battle_execution.gd` ã®æ”»æ’ƒå‡¦ç†å†…
- æ’ƒç ´åˆ¤å®šã®ç›´å¾Œ

---

## åŠ¹æœè©³ç´°

### instant_deathï¼ˆé“é€£ã‚Œï¼‰

#### JSONå½¢å¼

```json
{
  "effect_parsed": {
	"effects": [
	  {
		"effect_type": "instant_death",
		"trigger": "on_death",
		"target": "attacker",
		"probability": 100
	  }
	]
  }
}
```

#### ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | å‹ | å¿…é ˆ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ | èª¬æ˜ |
|-----------|-----|------|-----------|------|
| `effect_type` | String | âœ… | - | "instant_death" |
| `trigger` | String | âœ… | - | "on_death" |
| `target` | String | âœ… | - | "attacker"ï¼ˆç›¸æ‰‹ã‚’æŒ‡å®šï¼‰ |
| `probability` | int | âŒ | 100 | ç™ºå‹•ç¢ºç‡ï¼ˆ%ï¼‰ |

#### å‡¦ç†ãƒ•ãƒ­ãƒ¼

```gdscript
1. ç¢ºç‡åˆ¤å®šï¼ˆrandf() * 100.0 <= probabilityï¼‰
2. æˆåŠŸ â†’ opponent.instant_death_flag = true
3. opponent.base_hp = 0
4. opponent.update_current_hp()
```

#### å®Ÿè£…ä¾‹

**ãƒãƒ¼ãƒ‹ãƒ³ã‚°ãƒãƒ¼ãƒˆï¼ˆID: 1048ï¼‰**
```json
{
  "id": 1048,
  "name": "ãƒãƒ¼ãƒ‹ãƒ³ã‚°ãƒãƒ¼ãƒˆ",
  "effect": "AP+|AP&|AP=HP+20ï¼›é“é€£ã‚Œ",
  "effect_parsed": {
	"stat_bonus": {"ap": 20, "hp": 20},
	"effects": [
	  {
		"effect_type": "instant_death",
		"trigger": "on_death",
		"probability": 100,
		"target": "attacker"
	  }
	]
  }
}
```

---

### revenge_mhp_damageï¼ˆé›ªè¾±ï¼‰

#### JSONå½¢å¼

```json
{
  "effect_parsed": {
	"effects": [
	  {
		"effect_type": "revenge_mhp_damage",
		"trigger": "on_death",
		"damage": 40
	  }
	]
  }
}
```

#### ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | å‹ | å¿…é ˆ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ | èª¬æ˜ |
|-----------|-----|------|-----------|------|
| `effect_type` | String | âœ… | - | "revenge_mhp_damage" |
| `trigger` | String | âœ… | - | "on_death" |
| `damage` | int | âŒ | 40 | MHPãƒ€ãƒ¡ãƒ¼ã‚¸é‡ |

#### å‡¦ç†ãƒ•ãƒ­ãƒ¼

```gdscript
1. ç›¸æ‰‹ãŒç”Ÿå­˜ã—ã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
2. opponent.take_mhp_damage(damage)
3. base_up_hp â†’ base_hp ã®é †ã§æ¶ˆè²»
4. MHPãŒ0ä»¥ä¸‹ â†’ å³æ­»
```

#### MHPãƒ€ãƒ¡ãƒ¼ã‚¸ã®ä»•çµ„ã¿

é€šå¸¸ã®ãƒ€ãƒ¡ãƒ¼ã‚¸æ¶ˆè²»é †åºï¼š
```
1. resonance_bonus_hpï¼ˆæ„Ÿå¿œï¼‰
2. land_bonus_hpï¼ˆåœŸåœ°ãƒœãƒ¼ãƒŠã‚¹ï¼‰
3. temporary_bonus_hpï¼ˆä¸€æ™‚ãƒœãƒ¼ãƒŠã‚¹ï¼‰
4. item_bonus_hpï¼ˆã‚¢ã‚¤ãƒ†ãƒ ï¼‰
5. spell_bonus_hpï¼ˆã‚¹ãƒšãƒ«ï¼‰
6. base_hpï¼ˆå…ƒã®HPã®ç¾åœ¨å€¤ã€æœ€å¾Œã«æ¶ˆè²»ï¼‰
```

**é›ªè¾±ã®ç‰¹å¾´**:
- 1ã€œ5ã®ãƒœãƒ¼ãƒŠã‚¹ã‚’ç„¡è¦–
- MHPç¯„å›²ï¼ˆbase_hp + base_up_hpï¼‰ã«ç›´æ¥ãƒ€ãƒ¡ãƒ¼ã‚¸
- **base_up_hp ã¯å‰Šã‚‰ã‚Œãªã„**ï¼ˆæ°¸ç¶šçš„ãªMHPãƒœãƒ¼ãƒŠã‚¹ã®ãŸã‚ï¼‰
- base_hp ã®ã¿æ¶ˆè²»ã•ã‚Œã‚‹
- é«˜ãƒ¬ãƒ™ãƒ«åœŸåœ°ã‚„ãƒãƒ•ã§å®ˆã‚‰ã‚ŒãŸæ•µã‚’å€’ã™æ‰‹æ®µ

#### å®Ÿè£…ä¾‹

**ãƒŠãƒ‘ãƒ¼ãƒ ã‚¢ãƒ­ãƒ¼ï¼ˆID: 1044ï¼‰**
```json
{
  "id": 1044,
  "name": "ãƒŠãƒ‘ãƒ¼ãƒ ã‚¢ãƒ­ãƒ¼",
  "effect": "AP+|AP&|AP=30ï¼›HP+20ï¼›é›ªè¾±[æ•µã®MHP-40]",
  "effect_parsed": {
	"stat_bonus": {"ap": 30, "hp": 20},
	"effects": [
	  {
		"effect_type": "revenge_mhp_damage",
		"trigger": "on_death",
		"damage": 40
	  }
	]
  }
}
```

**ä½¿ç”¨ä¾‹**:
```
æ•µï¼šMHP=50ã€åœŸåœ°ãƒœãƒ¼ãƒŠã‚¹+30 â†’ ç¾åœ¨HP=80
æ”»æ’ƒï¼šAP30 â†’ åœŸåœ°ãƒœãƒ¼ãƒŠã‚¹å‰Šã‚‰ã‚Œã‚‹ â†’ HP=50
åæ’ƒï¼šæ­»äº¡
é›ªè¾±ç™ºå‹• â†’ MHP 50 - 40 = 10 â†’ æ•µHP=10ï¼ˆç”Ÿå­˜ï¼‰

ã‚‚ã—MHP=30ãªã‚‰:
é›ªè¾±ç™ºå‹• â†’ MHP 30 - 40 = -10 â†’ æ•µæ­»äº¡
```

---

## å®Ÿè£…ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ãƒ»ã‚¢ã‚¤ãƒ†ãƒ 

### instant_deathï¼ˆé“é€£ã‚Œï¼‰

#### ã‚¢ã‚¤ãƒ†ãƒ 
- **ãƒãƒ¼ãƒ‹ãƒ³ã‚°ãƒãƒ¼ãƒˆï¼ˆID: 1048ï¼‰**: AP+|AP&|AP=HP+20ï¼›é“é€£ã‚Œ[100%]

### revenge_mhp_damageï¼ˆé›ªè¾±ï¼‰

#### ã‚¢ã‚¤ãƒ†ãƒ 
- **ãƒŠãƒ‘ãƒ¼ãƒ ã‚¢ãƒ­ãƒ¼ï¼ˆID: 1044ï¼‰**: AP+|AP&|AP=30ï¼›HP+20ï¼›é›ªè¾±[MHP-40]

---

## ä»–ã‚¹ã‚­ãƒ«ã¨ã®ç›¸äº’ä½œç”¨

### é“é€£ã‚Œï¼ˆinstant_deathï¼‰

#### ç„¡åŠ¹åŒ–ã‚¹ã‚­ãƒ«
- âŒ **ç„¡åŠ¹åŒ–ã§ã¯é˜²ã’ãªã„**ï¼ˆæ­»äº¡å¾Œã®åŠ¹æœï¼‰
- âŒ **åå°„ã§ã¯é˜²ã’ãªã„**ï¼ˆæ­»äº¡å¾Œã®åŠ¹æœï¼‰

#### æ­»è€…å¾©æ´»
- âœ… **é“é€£ã‚Œç™ºå‹•å¾Œã«æ­»è€…å¾©æ´»å¯èƒ½**
- é“é€£ã‚Œã§ç›¸æ‰‹ã‚’å€’ã—ãŸå¾Œã€ä½¿ç”¨è€…ãŒå¾©æ´»ã™ã‚‹å¯èƒ½æ€§

#### ã‚¹ã‚¯ã‚¤ãƒ‰ãƒãƒ³ãƒˆãƒ«
- âŒ **é˜²ã’ãªã„**ï¼ˆã‚¹ã‚¯ã‚¤ãƒ‰ãƒãƒ³ãƒˆãƒ«ã¯æ”»æ’ƒæ™‚ã®å³æ­»ã‚’ç„¡åŠ¹åŒ–ã™ã‚‹ãŒã€é“é€£ã‚Œã«ã¯ç„¡åŠ¹ï¼‰

### é›ªè¾±ï¼ˆrevenge_mhp_damageï¼‰

#### ç„¡åŠ¹åŒ–ã‚¹ã‚­ãƒ«
- âŒ **ç„¡åŠ¹åŒ–ã§ã¯é˜²ã’ãªã„**ï¼ˆMHPç¯„å›²ã¸ã®ç›´æ¥ãƒ€ãƒ¡ãƒ¼ã‚¸ï¼‰
- âŒ **åå°„ã§ã¯é˜²ã’ãªã„**ï¼ˆæ­»äº¡å¾Œã®åŠ¹æœï¼‰

#### å†ç”Ÿã‚¹ã‚­ãƒ«
- âš ï¸ **é›ªè¾±å¾Œã«å†ç”ŸãŒç™ºå‹•ã™ã‚‹å¯èƒ½æ€§**
- MHPãŒå‰Šã‚‰ã‚ŒãŸå¾Œã€æ®‹ã‚ŠHPã¾ã§å›å¾©

#### ãƒãƒ•åŠ¹æœ
- âœ… **åœŸåœ°ãƒœãƒ¼ãƒŠã‚¹ã€ã‚¢ã‚¤ãƒ†ãƒ ãƒœãƒ¼ãƒŠã‚¹ãªã©ã‚’ç„¡è¦–**
- MHPç¯„å›²ï¼ˆbase_hp + base_up_hpï¼‰ã«ç›´æ¥ä½œç”¨

---

## å®Ÿè£…ã‚³ãƒ¼ãƒ‰

### battle_special_effects.gd

```gdscript
## æ­»äº¡æ™‚åŠ¹æœã®ãƒã‚§ãƒƒã‚¯ï¼ˆé“é€£ã‚Œã€é›ªè¾±ãªã©ï¼‰
func check_on_death_effects(defeated: BattleParticipant, opponent: BattleParticipant) -> Dictionary:
	"""
	æ’ƒç ´ã•ã‚ŒãŸå´ã®æ­»äº¡æ™‚åŠ¹æœã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ç™ºå‹•
	
	Args:
		defeated: æ’ƒç ´ã•ã‚ŒãŸã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ï¼ˆæ­»äº¡ã—ãŸå´ï¼‰
		opponent: ç›¸æ‰‹ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ï¼ˆç”Ÿãæ®‹ã£ãŸå´ï¼‰
	
	Returns:
		Dictionary: {
			"death_revenge_activated": bool,  # é“é€£ã‚ŒãŒç™ºå‹•ã—ãŸã‹
			"revenge_mhp_activated": bool     # é›ªè¾±ãŒç™ºå‹•ã—ãŸã‹
		}
	"""
	var result = {
		"death_revenge_activated": false,
		"revenge_mhp_activated": false
	}
	
	# on_deathåŠ¹æœãŒã‚ã‚‹ã‹ãƒã‚§ãƒƒã‚¯ï¼ˆæ—©æœŸãƒªã‚¿ãƒ¼ãƒ³ç”¨ï¼‰
	var items = defeated.creature_data.get("items", [])
	var has_on_death_effect = false
	for item in items:
		var effects = item.get("effect_parsed", {}).get("effects", [])
		for effect in effects:
			if effect.get("trigger", "") == "on_death":
				has_on_death_effect = true
				break
		if has_on_death_effect:
			break
	
	if not has_on_death_effect:
		return result
	
	# å„åŠ¹æœã‚’ãƒã‚§ãƒƒã‚¯
	for item in items:
		var effects = item.get("effect_parsed", {}).get("effects", [])
		for effect in effects:
			if effect.get("trigger", "") != "on_death":
				continue
			
			match effect.get("effect_type", ""):
				"instant_death":  # é“é€£ã‚Œ
					if _apply_instant_death_on_death(effect, opponent):
						result["death_revenge_activated"] = true
				
				"revenge_mhp_damage":  # é›ªè¾±
					if opponent.is_alive():
						_apply_revenge_mhp_damage(effect, opponent, item)
						result["revenge_mhp_activated"] = true
	
	return result
```

### battle_participant.gd

```gdscript
## MHPç¯„å›²ã«ç›´æ¥ãƒ€ãƒ¡ãƒ¼ã‚¸ï¼ˆé›ªè¾±åŠ¹æœç”¨ï¼‰
func take_mhp_damage(damage: int) -> void:
	"""
	ãƒœãƒ¼ãƒŠã‚¹ã‚’ç„¡è¦–ã—ã¦MHPï¼ˆbase_hp + base_up_hpï¼‰ã‚’ç›´æ¥å‰Šã‚‹
	ãŸã ã— base_up_hp ã¯æ°¸ç¶šãƒœãƒ¼ãƒŠã‚¹ãªãŸã‚å‰Šã‚‰ã‚Œãªã„
	MHPãŒ0ä»¥ä¸‹ã«ãªã£ãŸå ´åˆã¯å³æ­»æ‰±ã„
	
	é‡è¦: base_up_hp ã¯æ°¸ç¶šçš„ãªMHPå¢—åŠ ã§ã‚ã‚Šã€å‰Šã‚‰ã‚Œã¾ã›ã‚“
	"""
	# base_hp ã‹ã‚‰æ¶ˆè²»ï¼ˆbase_up_hp ã¯å‰Šã‚‰ã‚Œãªã„ï¼‰
	if damage > 0:
		base_hp -= damage
	
	# ç¾åœ¨HPã‚’å†è¨ˆç®—
	update_current_hp()
	
	# MHPãŒ0ä»¥ä¸‹ã«ãªã£ãŸå ´åˆã¯å³æ­»
	var current_mhp = base_hp + base_up_hp
	if current_mhp <= 0:
		base_hp = 0
		update_current_hp()
```

---

## ä½¿ç”¨ä¾‹

### é“é€£ã‚Œã®ä¾‹

```gdscript
# ãƒãƒ¼ãƒ‹ãƒ³ã‚°ãƒãƒ¼ãƒˆè£…å‚™ã®ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ãŒæ’ƒç ´ã•ã‚ŒãŸ
var death_effects = special_effects.check_on_death_effects(defeated, opponent)
if death_effects["death_revenge_activated"]:
	print("é“é€£ã‚Œç™ºå‹•ï¼ç›¸æ‰‹ã‚‚æ’ƒç ´")
```

**ãƒ­ã‚°å‡ºåŠ›ä¾‹**:
```
ã€æ­»äº¡æ™‚åŠ¹æœãƒã‚§ãƒƒã‚¯ã€‘ã‚¢ãƒ¢ãƒ³
ã€é“é€£ã‚Œç™ºå‹•ã€‘ã‚¢ãƒ¢ãƒ³ â†’ ã‚¹ãƒãƒ¼ãƒ ã‚®ã‚¢ (100% åˆ¤å®šæˆåŠŸ)
  â†’ ã‚¹ãƒãƒ¼ãƒ ã‚®ã‚¢ é“é€£ã‚Œã§æ’ƒç ´ï¼
```

### é›ªè¾±ã®ä¾‹

```gdscript
# ãƒŠãƒ‘ãƒ¼ãƒ ã‚¢ãƒ­ãƒ¼è£…å‚™ã®ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ãŒæ’ƒç ´ã•ã‚ŒãŸ
var death_effects = special_effects.check_on_death_effects(defeated, opponent)
if death_effects["revenge_mhp_activated"]:
	print("é›ªè¾±ç™ºå‹•ï¼ç›¸æ‰‹ã®MHPã‚’å‰Šã£ãŸ")
```

**ãƒ­ã‚°å‡ºåŠ›ä¾‹**:
```
ã€æ­»äº¡æ™‚åŠ¹æœãƒã‚§ãƒƒã‚¯ã€‘ã‚¢ãƒ¢ãƒ³
ã€é›ªè¾±ç™ºå‹•ã€‘ã‚¢ãƒ¢ãƒ³ã®ãƒŠãƒ‘ãƒ¼ãƒ ã‚¢ãƒ­ãƒ¼ â†’ ã‚¹ãƒãƒ¼ãƒ ã‚®ã‚¢
ã€MHPãƒ€ãƒ¡ãƒ¼ã‚¸ã€‘ã‚¹ãƒãƒ¼ãƒ ã‚®ã‚¢ MHPã«-40
  base_hp: -40 (æ®‹ã‚Š:-10)
  â†’ MHP=-10 å³æ­»ç™ºå‹•
  â†’ ã‚¹ãƒãƒ¼ãƒ ã‚®ã‚¢ æ’ƒç ´ï¼
```

---

## è¨­è¨ˆæ€æƒ³

### ãªãœbattle_special_effects.gdã«é…ç½®ï¼Ÿ

1. **ç‰¹æ®ŠåŠ¹æœã®é›†ç´„**
   - å³æ­»ã€ç„¡åŠ¹åŒ–ã€å†ç”Ÿãªã©ç‰¹æ®Šãªæˆ¦é—˜åŠ¹æœã‚’1ç®‡æ‰€ã«é›†ç´„
   - battle_execution.gdã¯æˆ¦é—˜ãƒ•ãƒ­ãƒ¼ã«é›†ä¸­

2. **æ‹¡å¼µæ€§**
   - æ–°ã—ã„æ­»äº¡æ™‚åŠ¹æœã‚’è¿½åŠ ã—ã‚„ã™ã„
   - matchæ–‡ã«æ–°ã—ã„effect_typeã‚’è¿½åŠ ã™ã‚‹ã ã‘

3. **è²¬ä»»ã®åˆ†é›¢**
   - BattleParticipant: ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç®¡ç†
   - BattleExecution: æˆ¦é—˜ãƒ•ãƒ­ãƒ¼
   - BattleSpecialEffects: ç‰¹æ®ŠåŠ¹æœå‡¦ç†

### triggerã®çµ±ä¸€

ã™ã¹ã¦ã®æ­»äº¡æ™‚åŠ¹æœã§ `"on_death"` ã‚’ä½¿ç”¨ï¼š
- ä¸€è²«æ€§ã®ã‚ã‚‹è¨­è¨ˆ
- æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ãŒå®¹æ˜“
- æ–°ã—ã„åŠ¹æœã®è¿½åŠ ãŒç°¡å˜

### åŒæ–¹å‘å¯¾å¿œ

ä¾µç•¥å´/é˜²è¡›å´ã«é–¢ä¿‚ãªãå‹•ä½œï¼š
```gdscript
check_on_death_effects(attacker, defender)  # æ”»æ’ƒå´ãŒæ­»äº¡
check_on_death_effects(defender, attacker)  # é˜²å¾¡å´ãŒæ­»äº¡
```

### è¤‡æ•°åŠ¹æœã®å¯¾å¿œ

1ã¤ã®ã‚¢ã‚¤ãƒ†ãƒ ã«è¤‡æ•°ã®æ­»äº¡æ™‚åŠ¹æœã‚’æŒãŸã›ã‚‹ã“ã¨ã‚‚å¯èƒ½ï¼š
```json
{
  "effects": [
	{"effect_type": "instant_death", "trigger": "on_death", ...},
	{"effect_type": "revenge_mhp_damage", "trigger": "on_death", ...}
  ]
}
```

---

## ä»Šå¾Œã®æ‹¡å¼µ

### è¿½åŠ å¯èƒ½ãªåŠ¹æœã‚¿ã‚¤ãƒ—

```json
// HPå›å¾©
{
  "effect_type": "heal_opponent_on_death",
  "trigger": "on_death",
  "heal_amount": 30
}

// é­”åŠ›ç²å¾—ï¼ˆéºç”£ï¼‰
{
  "effect_type": "grant_magic_on_death",
  "trigger": "on_death",
  "magic_amount": 50
}

// ãƒãƒ•ä»˜ä¸
{
  "effect_type": "buff_opponent_on_death",
  "trigger": "on_death",
  "stat": "ap",
  "value": 20
}
```

ã™ã¹ã¦åŒã˜ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§å®Ÿè£…å¯èƒ½ã€‚

---

**æœ€çµ‚æ›´æ–°**: 2025å¹´11æœˆ2æ—¥ï¼ˆv1.0ï¼‰
