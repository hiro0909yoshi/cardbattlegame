# 援護スキル

**バージョン**: 1.1  
**最終更新**: 2025年11月03日

---

## 📋 目次

1. [概要](#概要)
2. [発動条件](#発動条件)
3. [効果](#効果)
4. [援護対象属性](#援護対象属性)
5. [特殊処理](#特殊処理)
6. [UI動作](#ui動作)
7. [コスト計算](#コスト計算)
8. [実装済みクリーチャー](#実装済みクリーチャー)
9. [使用例](#使用例)
10. [戦略的価値](#戦略的価値)
11. [実装メモ](#実装メモ)

---

## 概要

アイテムフェーズ時に、**手札のクリーチャーカードをアイテムのように使用**して、バトル参加クリーチャーのAP/HPを加算できるスキル。

---

## 発動条件

- バトル参加クリーチャーが援護スキルを持っている
- アイテムフェーズ時に手札に対象クリーチャーがある
- 使用クリーチャーのコスト分の魔力を消費

---

## 効果

1. **AP加算**: 援護クリーチャーのAPをバトル参加クリーチャーに加算
2. **HP加算**: 援護クリーチャーのHPをバトル参加クリーチャーに加算
3. **スキル非継承**: 援護クリーチャーのスキルは継承されない
4. **カード消費**: 使用した援護クリーチャーは捨て札に

---

## 援護対象属性

援護スキルには対象属性が指定されており、その属性のクリーチャーのみ援護可能：

### パターン1: 全属性対応

```json
{
  "援護": {
	"target_elements": ["all"]
  }
}
```

### パターン2: 特定属性のみ

```json
{
  "援護": {
	"target_elements": ["fire", "earth"]
  }
}
```

### 対象パターン

- **全属性対応** (`["all"]`): どの属性のクリーチャーでも援護可能
- **特定属性のみ**: 指定された属性のクリーチャーのみ援護可能

---

## 特殊処理

### ブラッドプリン (ID: 137)

ブラッドプリンが援護クリーチャーを使用した場合、特殊な効果が発動します：

**効果**: 援護クリーチャーのMHP（最大HP）を永続的に吸収

**詳細**:
- 援護クリーチャーの基本HP + base_up_HPを合計したMHPを吸収
- ブラッドプリンのMHP上限は100
- 上限を超える分は吸収されない
- この効果は戦闘後も永続する（`creature_data.base_up_hp`が増加）

**例**:
```
1. ブラッドプリン（MHP: 30）がピュトン（MHP: 30）を援護に使用
2. 通常の援護効果: AP+20, HP+30
3. 特殊効果発動: ブラッドプリンのbase_up_hpが30増加
4. 戦闘後もブラッドプリンのMHPは60のまま（永続）
```

---

## UI動作

### アイテムフェーズ時

1. バトル参加クリーチャーに援護スキルがある場合
2. フェーズラベル: 「アイテムまたは援護クリーチャーを選択」
3. 手札の表示:
   - **アイテムカード**: 選択可能（グレーアウトなし）
   - **援護対象クリーチャー**: 選択可能（グレーアウトなし）
   - **その他のカード**: グレーアウト（選択不可）

---

## コスト計算

- **援護クリーチャーのコスト**: mp値をそのまま魔力消費
- 例: 75MPのクリーチャーを援護に使用 → 75G消費

---

## 実装済みクリーチャー

**合計18体** が援護スキルを持っています。

### 属性別分布

- 🔥 火属性: 2体（シャラザード、バルキリー）
- 🌊 水属性: 2体（アクアデューク、ブラッドプリン）
- 💨 風属性: 1体（アームドプリンセス）
- 🌍 地属性: 10体（ウッドフォーク、オドラデク、セージなど）
- ⚪ 無属性: 3体（アンドロギア、グランギア、スカイギア）

### 援護対象別

- **全属性対応**: 5体（28%）
  - ウッドフォーク (ID:202)
  - オドラデク (ID:203)
  - セージ (ID:225)
  - グランギア (ID:409)
  - スカイギア (ID:419)
- **特定属性のみ**: 13体（72%）

## 使用例

### シナリオ1: 基本的な使用

```
1. バルキリー（AP:30 HP:30、援護[無火地]）でバトル開始
2. アイテムフェーズで手札のピュトン（AP:20 HP:30、火属性）を選択
3. コスト75G消費してピュトンを援護に使用
4. バルキリーのステータスが AP:50 HP:60 に上昇
5. ピュトンは捨て札へ
6. 強化されたバルキリーでバトル実行
```

### シナリオ2: 属性制限

```
1. シャラザード（援護[火地]）でバトル開始
2. 手札: ピュトン（火）、グランギア（無）、ウッドフォーク（地）
3. UI表示:
   - ピュトン: 選択可能（火属性）
   - ウッドフォーク: 選択可能（地属性）
   - グランギア: グレーアウト（無属性は対象外）
```

### シナリオ3: ブラッドプリンの特殊効果

```
1. ブラッドプリン（AP:20 HP:30、援護[水地風]）でバトル開始
2. アイテムフェーズでアクアデューク（AP:40 HP:50、水属性）を援護に使用
3. 通常の援護効果: AP:60, HP:80
4. 特殊効果: ブラッドプリンのbase_up_hpが50増加（MHP: 30→80）
5. 戦闘後もブラッドプリンのMHPは80のまま
6. 次回以降もこの強化されたステータスで戦闘可能
```

---

## 戦略的価値

### メリット

1. **瞬間火力**: 手札のクリーチャーを犠牲に即座にパワーアップ
2. **柔軟性**: アイテムがない場合でもクリーチャーで代用可能
3. **リソース活用**: 使わないクリーチャーを有効活用
4. **ブラッドプリン**: 永続的な成長が可能（戦略的育成）

### デメリット

1. **カード消費**: 使用したクリーチャーは失われる
2. **コスト**: クリーチャーのコスト分の魔力が必要
3. **スキル非継承**: 強力なスキル持ちでも能力は引き継がれない

---

## 実装メモ

### 実装ファイル

**コアロジック**:
- `scripts/battle/skills/skill_assist.gd` - 援護スキル本体
  - `apply_assist_effect()` - AP/HP加算処理
  - `_apply_blood_purin_effect()` - ブラッドプリン特殊処理
  - `has_assist_skill()` - 援護スキル所持チェック
  - `can_be_used_as_assist()` - 援護対象判定（UI用）

**統合部分**:
- `scripts/game_flow/item_phase_handler.gd` - 援護判定とカード選択
- `scripts/battle/battle_preparation.gd` - 援護効果の呼び出し（`SkillAssist.apply_assist_effect()`）
- `scripts/ui_components/hand_display.gd` - グレーアウト制御
- `scripts/ui_components/card_selection_ui.gd` - 選択可能判定

### アーキテクチャ

援護スキルは他のスキルと同様に、`scripts/battle/skills/`配下の独立したモジュールとして実装されています。これにより：

- ✅ **単一責任の原則**: 援護処理が1ファイルに集約
- ✅ **再利用性**: UI側でも同じロジックを使用可能
- ✅ **テスト容易性**: 静的メソッドで独立してテスト可能
- ✅ **保守性**: 変更が1箇所で完結

### 実装日

- 初回実装: 2025年10月24日
- スキルモジュール化: 2025年11月03日

---

## 変更履歴

| 日付 | バージョン | 変更内容 |
|------|-----------|---------|
| 2025/10/24 | 1.0 | 個別ドキュメントとして分離 |
| 2025/11/03 | 1.1 | スキルモジュール化（`skill_assi.gd`として独立）、ブラッドプリン特殊処理を追加 |
