# 呪い拡散スキル

**バージョン**: 1.1  
**最終更新**: 2025年12月10日

---

## 概要

「呪い拡散」スキルを持つクリーチャーに呪いが付与された時、**同じ呪いを使用者の全ドミニオにも付与**し、**自身はダウン**するスキル。

---

## 発動条件

- クリーチャーが「呪い拡散」keywordを持っている
- 単体特殊能力付与スペル（呪いスペル）の対象になる
- 呪いが正常に付与される

---

## 効果

| 項目 | 内容 |
|------|------|
| 自身への呪い | 通常通り付与される |
| 拡散対象 | 使用者（スペル使用プレイヤー）の全ドミニオクリーチャー |
| 拡散呪い | 自身に付与されたものと同じ呪い |
| 防魔対象 | 拡散対象から除外 |
| ダウン | 呪い拡散クリーチャーはダウン状態になる |

---

## 使用例

### シナリオ: エンチャントレスに呪い付与

```
1. プレイヤー1がプレイヤー2のエンチャントレス（呪い拡散持ち）に「戦闘行動不可」呪いを使用
2. エンチャントレスに呪い付与
3. 呪い拡散発動:
   - プレイヤー1の全ドミニオクリーチャーに「戦闘行動不可」呪いを付与
   - 防魔を持つクリーチャーは対象外
4. エンチャントレスがダウン
```

### シナリオ: 自分自身に使用

```
1. プレイヤー1が自分のエンチャントレス（呪い拡散持ち）に「能力値+20」呪いを使用
2. エンチャントレスに呪い付与
3. 呪い拡散発動:
   - プレイヤー1の全ドミニオクリーチャー（エンチャントレス以外）に「能力値+20」呪いを付与
4. エンチャントレスがダウン
```

---

## 実装済みクリーチャー

| ID | 名前 | 属性 |
|----|------|------|
| 305 | エンチャントレス | 風 |

---

## JSONデータ形式

```json
{
  "ability_parsed": {
	"keywords": ["呪い拡散"],
	"keyword_conditions": {}
  }
}
```

---

## 実装ファイル

| ファイル | 役割 |
|----------|------|
| `scripts/spells/spell_curse.gd` | 呪い付与時にSpellProtectionへ委譲 |
| `scripts/spells/spell_protection.gd` | 呪い拡散の判定と処理 |

### 主要メソッド

**spell_curse.gd**:
- `curse_creature()` - 呪い付与後に`SpellProtection.apply_curse_spread()`を呼び出し

**spell_protection.gd**:
- `has_curse_spread_skill()` - 呪い拡散スキル判定
- `apply_curse_spread()` - 呪い拡散処理（対象取得、防魔チェック、呪い付与、ダウン）

---

## 処理フロー

```
1. 呪いスペル使用 → spell_phase_handler._apply_single_effect()
2. spell_curse.apply_effect() → curse_creature()
3. 呪い付与完了
4. SpellProtection.apply_curse_spread() 呼び出し
   - 呪い拡散keyword確認
   - player_system.current_player_indexで使用者取得
   - 使用者の全ドミニオを取得
   - 各クリーチャーに呪い付与（防魔チェック、is_spread=true）
   - 呪い拡散クリーチャーをダウン
```

---

## 注意事項

- 拡散処理は`is_spread=true`で呼び出し、再帰を防止
- 自身のタイルは拡散対象から除外（既に呪いがついている）
- 防魔を持つクリーチャーは拡散対象外

---

## 変更履歴

| 日付 | バージョン | 変更内容 |
|------|-----------|---------|
| 2025/12/10 | 1.0 | 初版作成 |
| 2025/12/10 | 1.1 | 実装をSpellProtectionに移動、不屈チェック削除 |
