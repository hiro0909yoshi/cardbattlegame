# 伝染スキル

**バージョン**: 1.1  
**最終更新**: 2025年12月10日

---

## 概要

「伝染」スキルを持つクリーチャーに刻印が付与された時、**同じ刻印を使用者の全ドミニオにも付与**し、**自身はダウン**するスキル。

---

## 発動条件

- クリーチャーが「伝染」keywordを持っている
- 単体特殊能力付与スペル（刻印スペル）の対象になる
- 刻印が正常に付与される

---

## 効果

| 項目 | 内容 |
|------|------|
| 自身への刻印 | 通常通り付与される |
| 拡散対象 | 使用者（スペル使用プレイヤー）の全ドミニオクリーチャー |
| 拡散刻印 | 自身に付与されたものと同じ刻印 |
| 結界対象 | 拡散対象から除外 |
| ダウン | 伝染クリーチャーはダウン状態になる |

---

## 使用例

### シナリオ: エンチャントレスに刻印付与

```
1. プレイヤー1がプレイヤー2のエンチャントレス（伝染持ち）に「消沈」刻印を使用
2. エンチャントレスに刻印付与
3. 伝染発動:
   - プレイヤー1の全ドミニオクリーチャーに「消沈」刻印を付与
   - 結界を持つクリーチャーは対象外
4. エンチャントレスがダウン
```

### シナリオ: 自分自身に使用

```
1. プレイヤー1が自分のエンチャントレス（伝染持ち）に「暁光」刻印を使用
2. エンチャントレスに刻印付与
3. 伝染発動:
   - プレイヤー1の全ドミニオクリーチャー（エンチャントレス以外）に「暁光」刻印を付与
4. エンチャントレスがダウン
```

---

## 実装済みクリーチャー

| ID | 名前 | 属性 |
|----|------|------|
| 305 | エンチャントレス | 風 |

---

## JSONデータ形式

```json
{
  "ability_parsed": {
	"keywords": ["伝染"],
	"keyword_conditions": {}
  }
}
```

---

## 実装ファイル

| ファイル | 役割 |
|----------|------|
| `scripts/spells/spell_curse.gd` | 刻印付与時にSpellProtectionへ委譲 |
| `scripts/spells/spell_protection.gd` | 伝染の判定と処理 |

### 主要メソッド

**spell_curse.gd**:
- `curse_creature()` - 刻印付与後に`SpellProtection.apply_curse_spread()`を呼び出し

**spell_protection.gd**:
- `has_curse_spread_skill()` - 伝染スキル判定
- `apply_curse_spread()` - 伝染処理（対象取得、結界チェック、刻印付与、ダウン）

---

## 処理フロー

```
1. 刻印スペル使用 → spell_phase_handler._apply_single_effect()
2. spell_curse.apply_effect() → curse_creature()
3. 刻印付与完了
4. SpellProtection.apply_curse_spread() 呼び出し
   - 伝染keyword確認
   - player_system.current_player_indexで使用者取得
   - 使用者の全ドミニオを取得
   - 各クリーチャーに刻印付与（結界チェック、is_spread=true）
   - 伝染クリーチャーをダウン
```

---

## 注意事項

- 拡散処理は`is_spread=true`で呼び出し、再帰を防止
- 自身のタイルは拡散対象から除外（既に刻印がついている）
- 結界を持つクリーチャーは拡散対象外

---

## 変更履歴

| 日付 | バージョン | 変更内容 |
|------|-----------|---------|
| 2025/12/10 | 1.0 | 初版作成 |
| 2025/12/10 | 1.1 | 実装をSpellProtectionに移動、奮闘チェック削除 |
