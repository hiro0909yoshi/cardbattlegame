# å¤‰èº«ã‚¹ã‚­ãƒ«

**ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ**: ã‚«ãƒ«ãƒ‰ã‚»ãƒ—ãƒˆé¢¨ã‚«ãƒ¼ãƒ‰ãƒãƒˆãƒ«ã‚²ãƒ¼ãƒ   
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.2  
**æœ€çµ‚æ›´æ–°**: 2025å¹´10æœˆ31æ—¥

**é–¢é€£**: æ­»è€…å¾©æ´»ã‚¹ã‚­ãƒ« (`revive_skill.md`) - åŒã˜`skill_transform.gd`ã§å®Ÿè£…

---

## ğŸ“‹ ç›®æ¬¡

1. [æ¦‚è¦](#æ¦‚è¦)
2. [ç™ºå‹•ã‚¿ã‚¤ãƒŸãƒ³ã‚°](#ç™ºå‹•ã‚¿ã‚¤ãƒŸãƒ³ã‚°)
3. [å¤‰èº«ã‚¿ã‚¤ãƒ—](#å¤‰èº«ã‚¿ã‚¤ãƒ—)
4. [å¤‰èº«å¯¾è±¡](#å¤‰èº«å¯¾è±¡)
5. [ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å‡¦ç†](#ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å‡¦ç†)
6. [æˆ¦é—˜å¾Œã®æŒ™å‹•](#æˆ¦é—˜å¾Œã®æŒ™å‹•)
7. [å®Ÿè£…ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼](#å®Ÿè£…ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼)
8. [ãƒ‡ãƒ¼ã‚¿æ§‹é€ ](#ãƒ‡ãƒ¼ã‚¿æ§‹é€ )
9. [ä»–ã‚¹ã‚­ãƒ«ã¨ã®ç›¸äº’ä½œç”¨](#ä»–ã‚¹ã‚­ãƒ«ã¨ã®ç›¸äº’ä½œç”¨)
10. [å®Ÿè£…ã‚³ãƒ¼ãƒ‰](#å®Ÿè£…ã‚³ãƒ¼ãƒ‰)
11. [ä½¿ç”¨ä¾‹](#ä½¿ç”¨ä¾‹)
12. [è¨­è¨ˆæ€æƒ³](#è¨­è¨ˆæ€æƒ³)

---

## æ¦‚è¦

ç‰¹å®šã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§è‡ªèº«ã¾ãŸã¯ç›¸æ‰‹ã‚’åˆ¥ã®ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ã«å¤‰èº«ã•ã›ã‚‹ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¹ã‚­ãƒ«ã€‚

---

## ç™ºå‹•ã‚¿ã‚¤ãƒŸãƒ³ã‚°

### 1. æˆ¦é—˜é–‹å§‹æ™‚ (`on_battle_start`)

- **ã‚¿ã‚¤ãƒŸãƒ³ã‚°**: æˆ¦é—˜æº–å‚™å®Œäº†å¾Œã€æ”»æ’ƒé–‹å§‹å‰
- **ç”¨é€”**: æˆ¦é—˜ã”ã¨ã«å§¿ã‚’å¤‰ãˆã‚‹ãƒ©ãƒ³ãƒ€ãƒ å¤‰èº«ï¼ˆãƒãƒ«ãƒ€ãƒ³ãƒ€ãƒ¼ã‚¹ï¼‰

### 2. æ”»æ’ƒæˆåŠŸæ™‚ (`on_attack_success`)

- **ã‚¿ã‚¤ãƒŸãƒ³ã‚°**: æ”»æ’ƒãŒãƒ’ãƒƒãƒˆã—ã€ãƒ€ãƒ¡ãƒ¼ã‚¸é©ç”¨å¾Œã€å³æ­»åˆ¤å®šå¾Œ
- **æ¡ä»¶**: ç›¸æ‰‹ãŒç”Ÿå­˜ã—ã¦ã„ã‚‹å ´åˆã®ã¿ç™ºå‹•
- **ç”¨é€”**: ç›¸æ‰‹ã‚’å¼±ä½“åŒ–ã•ã›ã‚‹å¼·åˆ¶å¤‰èº«ï¼ˆã‚³ã‚«ãƒˆãƒªã‚¹ï¼‰

---

## å¤‰èº«ã‚¿ã‚¤ãƒ—

### 1. ãƒ©ãƒ³ãƒ€ãƒ å¤‰èº« (`random`)

å…¨ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ã®ä¸­ã‹ã‚‰ãƒ©ãƒ³ãƒ€ãƒ ã«1ä½“ã‚’é¸ã‚“ã§å¤‰èº«

```json
{
  "transform_type": "random"
}
```

**ç‰¹å¾´**:
- å¤‰èº«å…ˆã¯å®Œå…¨ãƒ©ãƒ³ãƒ€ãƒ 
- æˆ¦ç•¥æ€§ã‚ˆã‚Šã‚®ãƒ£ãƒ³ãƒ–ãƒ«æ€§ãŒé«˜ã„
- æ¯æˆ¦é—˜ç•°ãªã‚‹ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ã«ãªã‚‹

---

### 2. å¼·åˆ¶å¤‰èº« (`forced`)

æŒ‡å®šã•ã‚ŒãŸã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ã«å¿…ãšå¤‰èº«ã•ã›ã‚‹

```json
{
  "transform_type": "forced",
  "creature_id": 222
}
```

**ç‰¹å¾´**:
- å¤‰èº«å…ˆãŒå›ºå®š
- ç›¸æ‰‹ã‚’ç‰¹å®šã®å¼±ã„ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ã«å¤‰èº«ã•ã›ã‚‹æˆ¦è¡“
- ç¢ºå®Ÿæ€§ãŒé«˜ã„

---

### 3. ç‰¹å®šå¤‰èº« (`specific`)

æ¡ä»¶ã«å¿œã˜ã¦ç‰¹å®šã®ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ã«å¤‰èº«ï¼ˆå°†æ¥å®Ÿè£…ç”¨ï¼‰

```json
{
  "transform_type": "specific",
  "creature_id": 100
}
```

**ç”¨é€”**: 
- ç§˜è¡“ã§ç‰¹å®šã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ã«å¤‰èº«
- æ¡ä»¶ä»˜ãå¤‰èº«åŠ¹æœ

---

## å¤‰èº«å¯¾è±¡

### 1. è‡ªåˆ†è‡ªèº« (`self`)

ã‚¹ã‚­ãƒ«ä¿æŒè€…è‡ªèº«ãŒå¤‰èº«ã™ã‚‹

```json
{
  "target": "self"
}
```

**ç”¨é€”**: 
- ãƒ©ãƒ³ãƒ€ãƒ å¤‰èº«ï¼ˆãƒãƒ«ãƒ€ãƒ³ãƒ€ãƒ¼ã‚¹ï¼‰
- æˆ¦é—˜é–‹å§‹æ™‚ã®è‡ªå·±å¼·åŒ–

**æŒ™å‹•**:
- è‡ªåˆ†ã®creature_dataãŒå¤‰èº«å…ˆã«ç½®ãæ›ã‚ã‚‹
- å¤‰èº«å…ˆã®AP/HPã‚’ä½¿ç”¨

---

### 2. ç›¸æ‰‹ (`opponent`)

æ”»æ’ƒç›¸æ‰‹ã‚’å¤‰èº«ã•ã›ã‚‹

```json
{
  "target": "opponent"
}
```

**ç”¨é€”**: 
- å¼·åˆ¶å¤‰èº«ï¼ˆã‚³ã‚«ãƒˆãƒªã‚¹ â†’ ã‚¹ãƒˆãƒ¼ãƒ³ã‚¦ã‚©ãƒ¼ãƒ«ï¼‰
- ç›¸æ‰‹ã®å¼±ä½“åŒ–

**æŒ™å‹•**:
- ç›¸æ‰‹ã®creature_dataãŒå¤‰èº«å…ˆã«ç½®ãæ›ã‚ã‚‹
- å¤‰èº«å¾Œã‚‚æˆ¦é—˜ã¯ç¶™ç¶š
- å¤‰èº«å…ˆã®AP/HPã§åæ’ƒã™ã‚‹

---

## ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å‡¦ç†

### å¤‰èº«æ™‚ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°

1. **åŸºæœ¬ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: å¤‰èº«å…ˆã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ã®å€¤ã‚’ä½¿ç”¨
   - `base_hp` â†’ å¤‰èº«å…ˆã®HP
   - `current_ap` â†’ å¤‰èº«å…ˆã®AP

2. **ã‚¢ã‚¤ãƒ†ãƒ ãƒœãƒ¼ãƒŠã‚¹**: **å¼•ãç¶™ã**
   - `item_bonus_hp` â†’ ä¿æŒ
   - ã‚¢ã‚¤ãƒ†ãƒ åŠ¹æœ â†’ ç¶™ç¶šé©ç”¨

3. **åœŸåœ°ãƒœãƒ¼ãƒŠã‚¹**: **å†è¨ˆç®—**
   - å¤‰èº«å…ˆã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ã®å±æ€§ã§åœŸåœ°ãƒœãƒ¼ãƒŠã‚¹ã‚’å†è¨ˆç®—
   - æ„Ÿå¿œåŠ¹æœã‚‚å¤‰èº«å…ˆã®æ¡ä»¶ã§å†åˆ¤å®š

4. **ç¾åœ¨HP**: åœŸåœ°ãƒœãƒ¼ãƒŠã‚¹ + ã‚¢ã‚¤ãƒ†ãƒ ãƒœãƒ¼ãƒŠã‚¹ã§å†è¨ˆç®—

### å‡¦ç†ãƒ•ãƒ­ãƒ¼

```
å¤‰èº«å‰: AP:30, HP:40 + åœŸåœ°:10 = åˆè¨ˆHP:55
â†“
å¤‰èº«å®Ÿè¡Œï¼ˆID: 222 ã‚¹ãƒˆãƒ¼ãƒ³ã‚¦ã‚©ãƒ¼ãƒ«ï¼‰
â†“
å¤‰èº«å¾Œ: AP:0, HP:60 + åœŸåœ°:0 = åˆè¨ˆHP:65
```

---

## æˆ¦é—˜å¾Œã®æŒ™å‹•

### 1. æ°¸ç¶šå¤‰èº« (`revert_after_battle: false`)

æˆ¦é—˜å¾Œã‚‚å¤‰èº«ã—ãŸã¾ã¾

```json
{
  "revert_after_battle": false
}
```

**ç”¨é€”**: ã‚³ã‚«ãƒˆãƒªã‚¹ã®çŸ³åŒ–æ”»æ’ƒ

**æŒ™å‹•**:
- æˆ¦é—˜çµ‚äº†å¾Œã‚‚ã‚¹ãƒˆãƒ¼ãƒ³ã‚¦ã‚©ãƒ¼ãƒ«ã®ã¾ã¾
- ã‚¿ã‚¤ãƒ«ã®creature_dataã‚‚æ›´æ–°ã•ã‚Œã‚‹
- æ¬¡å›ã®æˆ¦é—˜ã§ã‚‚å¤‰èº«å¾Œã®å§¿ã§æˆ¦ã†

---

### 2. ä¸€æ™‚å¤‰èº« (`revert_after_battle: true`)

æˆ¦é—˜å¾Œã«å…ƒã®å§¿ã«æˆ»ã‚‹

```json
{
  "revert_after_battle": true
}
```

**ç”¨é€”**: ãƒãƒ«ãƒ€ãƒ³ãƒ€ãƒ¼ã‚¹ã®ãƒ©ãƒ³ãƒ€ãƒ å¤‰èº«

**æŒ™å‹•**:
- æˆ¦é—˜ä¸­ã®ã¿å¤‰èº«
- æˆ¦é—˜çµ‚äº†å¾Œã€å…ƒã®ãƒãƒ«ãƒ€ãƒ³ãƒ€ãƒ¼ã‚¹ã«æˆ»ã‚‹
- ã‚¿ã‚¤ãƒ«ã®creature_dataã¯å…ƒã®ã¾ã¾

---

## å®Ÿè£…ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼

### å®Ÿè£…æ¸ˆã¿ï¼ˆ2ä½“ï¼‰

| ID | åå‰ | å±æ€§ | åŠ¹æœ |
|----|------|------|------|
| 432 | ãƒãƒ«ãƒ€ãƒ³ãƒ€ãƒ¼ã‚¹ï¼ˆãƒãƒ«ã‚²ãƒ³ãƒ€ãƒ¼ã‚¹ï¼‰ | ç„¡ | æˆ¦é—˜é–‹å§‹æ™‚ã€ãƒ©ãƒ³ãƒ€ãƒ å¤‰èº«ï¼ˆæˆ¦é—˜å¾Œå¾©å¸°ï¼‰ |
| 215 | ã‚³ã‚«ãƒˆãƒªã‚¹ | åœ° | æ”»æ’ƒæˆåŠŸæ™‚ã€ç›¸æ‰‹ã‚’ã‚¹ãƒˆãƒ¼ãƒ³ã‚¦ã‚©ãƒ¼ãƒ«ï¼ˆID:222ï¼‰ã«å¤‰èº« |

---

## ãƒ‡ãƒ¼ã‚¿æ§‹é€ 

### ãƒãƒ«ãƒ€ãƒ³ãƒ€ãƒ¼ã‚¹ï¼ˆãƒ©ãƒ³ãƒ€ãƒ å¤‰èº«ãƒ»æˆ¦é—˜å¾Œå¾©å¸°ï¼‰

```json
{
  "id": 432,
  "name": "ãƒãƒ«ã‚²ãƒ³ãƒ€ãƒ¼ã‚¹",
  "ability_parsed": {
	"keywords": ["å¤‰èº«"],
	"effects": [
	  {
		"effect_type": "transform",
		"trigger": "on_battle_start",
		"target": "self",
		"transform_type": "random",
		"revert_after_battle": true
	  }
	]
  }
}
```

---

### ã‚³ã‚«ãƒˆãƒªã‚¹ï¼ˆå¼·åˆ¶å¤‰èº«ãƒ»æ°¸ç¶šï¼‰

```json
{
  "id": 215,
  "name": "ã‚³ã‚«ãƒˆãƒªã‚¹",
  "ability_parsed": {
	"keywords": ["å¼·åˆ¶å¤‰åŒ–"],
	"effects": [
	  {
		"effect_type": "transform",
		"trigger": "on_attack_success",
		"target": "opponent",
		"transform_type": "forced",
		"creature_id": 222,
		"revert_after_battle": false
	  }
	]
  }
}
```

---

## ä»–ã‚¹ã‚­ãƒ«ã¨ã®ç›¸äº’ä½œç”¨

| ã‚¹ã‚­ãƒ« | é–¢ä¿‚ |
|--------|------|
| å³æ­» | å³æ­»ã•ã‚ŒãŸå ´åˆã€å¤‰èº«ã¯ç™ºå‹•ã—ãªã„ |
| ç„¡åŠ¹åŒ– | å¤‰èº«ã¯ç„¡åŠ¹åŒ–ã•ã‚Œãªã„ï¼ˆå°†æ¥å®Ÿè£…ã§å¤‰æ›´å¯èƒ½ï¼‰ |
| å†ç”Ÿ | å¤‰èº«å¾Œã®ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ãŒå†ç”Ÿã‚’æŒã¤å ´åˆã¯ç™ºå‹• |
| å…ˆåˆ¶ | å¤‰èº«å‰å¾Œã©ã¡ã‚‰ã®ã‚¹ã‚­ãƒ«ã‚‚ç™ºå‹•ã™ã‚‹ |
| ã‚¢ã‚¤ãƒ†ãƒ åŠ¹æœ | å¤‰èº«å¾Œã‚‚ã‚¢ã‚¤ãƒ†ãƒ åŠ¹æœã¯ç¶™ç¶š |
| åœŸåœ°ãƒœãƒ¼ãƒŠã‚¹ | å¤‰èº«å¾Œã®ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ã®å±æ€§ã§å†è¨ˆç®— |
| æ„Ÿå¿œ | å¤‰èº«å¾Œã®ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ã®æ„Ÿå¿œæ¡ä»¶ã§å†åˆ¤å®š |

---

## å®Ÿè£…ã‚³ãƒ¼ãƒ‰

### å¤‰èº«å‡¦ç†ã®æµã‚Œ

```gdscript
# 1. å¤‰èº«åŠ¹æœã®ãƒã‚§ãƒƒã‚¯
static func process_transform_effects(
	attacker: BattleParticipant, 
	defender: BattleParticipant, 
	card_loader, 
	trigger: String
) -> Dictionary:
	var result = {
		"attacker_transformed": false,
		"defender_transformed": false,
		"attacker_original": {},
		"defender_original": {}
	}
	
	# æ”»æ’ƒå´ã®å¤‰èº«åŠ¹æœãƒã‚§ãƒƒã‚¯
	var attacker_transform = _check_transform(attacker, trigger)
	if attacker_transform:
		var target = attacker_transform.get("target", "self")
		if target == "self":
			# è‡ªåˆ†è‡ªèº«ãŒå¤‰èº«
			_apply_transform(attacker, attacker_transform, card_loader, result, true)
		elif target == "opponent":
			# ç›¸æ‰‹ã‚’å¤‰èº«ã•ã›ã‚‹
			_apply_transform(defender, attacker_transform, card_loader, result, false)
	
	# é˜²å¾¡å´ã®å¤‰èº«åŠ¹æœãƒã‚§ãƒƒã‚¯
	var defender_transform = _check_transform(defender, trigger)
	if defender_transform:
		var target = defender_transform.get("target", "self")
		if target == "self":
			# è‡ªåˆ†è‡ªèº«ãŒå¤‰èº«
			_apply_transform(defender, defender_transform, card_loader, result, false)
		elif target == "opponent":
			# ç›¸æ‰‹ã‚’å¤‰èº«ã•ã›ã‚‹
			_apply_transform(attacker, defender_transform, card_loader, result, true)
	
	return result
```

### å¤‰èº«ã®é©ç”¨

```gdscript
static func _apply_transform(
	participant: BattleParticipant, 
	transform_effect: Dictionary, 
	card_loader, 
	result: Dictionary, 
	is_attacker: bool
) -> void:
	var transform_type = transform_effect.get("transform_type", "")
	var revert_after_battle = transform_effect.get("revert_after_battle", false)
	
	# å…ƒã®ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ï¼ˆæˆ¦é—˜å¾Œã«æˆ»ã™å¿…è¦ãŒã‚ã‚‹å ´åˆï¼‰
	var original_data = {}
	if revert_after_battle:
		original_data = participant.creature_data.duplicate(true)
	
	# å¤‰èº«å…ˆã®æ±ºå®š
	var new_creature_id = -1
	match transform_type:
		"random":
			new_creature_id = _get_random_creature_id(card_loader)
		"forced":
			new_creature_id = transform_effect.get("creature_id", -1)
		"specific":
			new_creature_id = transform_effect.get("creature_id", -1)
	
	# å¤‰èº«å®Ÿè¡Œ
	if new_creature_id > 0:
		var new_creature = card_loader.get_card_by_id(new_creature_id)
		if new_creature:
			_transform_creature(participant, new_creature, is_attacker, result, original_data)
```

### ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®æ›´æ–°

```gdscript
static func _transform_creature(
	participant: BattleParticipant, 
	new_creature: Dictionary, 
	is_attacker: bool, 
	result: Dictionary, 
	original_data: Dictionary
) -> void:
	# ç¾åœ¨ã®ã‚¢ã‚¤ãƒ†ãƒ ãƒœãƒ¼ãƒŠã‚¹ã‚’è¨˜éŒ²
	var current_item_bonus_hp = participant.item_bonus_hp
	var current_items = participant.creature_data.get("items", [])
	
	# creature_dataã‚’æ–°ã—ã„ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ã«ç½®ãæ›ãˆ
	participant.creature_data = new_creature.duplicate(true)
	
	# ã‚¢ã‚¤ãƒ†ãƒ æƒ…å ±ã‚’å¼•ãç¶™ã
	if not current_items.is_empty():
		participant.creature_data["items"] = current_items
	
	# åŸºç¤ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’æ–°ã—ã„ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ã®ã‚‚ã®ã«æ›´æ–°
	participant.base_hp = new_creature.get("hp", 0)
	participant.current_ap = new_creature.get("ap", 0)
	
	# HPãƒãƒ•ã‚’å†é©ç”¨
	participant.item_bonus_hp = current_item_bonus_hp
	
	# HPã‚’å†è¨ˆç®—ï¼ˆåœŸåœ°ãƒœãƒ¼ãƒŠã‚¹ã¨ã‚¢ã‚¤ãƒ†ãƒ ãƒœãƒ¼ãƒŠã‚¹ã‚’å«ã‚€ï¼‰
	# å¤‰èº«å¾Œã®MHP = base_hp + base_up_hp + land_bonus_hp + item_bonus_hp + ãã®ä»–ãƒœãƒ¼ãƒŠã‚¹
	participant.current_hp = participant.base_hp + participant.base_up_hp + participant.land_bonus_hp + participant.item_bonus_hp + participant.spell_bonus_hp + participant.temporary_bonus_hp + participant.resonance_bonus_hp
	
	# çµæœã‚’è¨˜éŒ²
	if is_attacker:
		result["attacker_transformed"] = true
		if not original_data.is_empty():
			result["attacker_original"] = original_data
	else:
		result["defender_transformed"] = true
		if not original_data.is_empty():
			result["defender_original"] = original_data
```

### æˆ¦é—˜å¾Œã®å¾©å¸°å‡¦ç†

```gdscript
static func revert_transform(
	participant: BattleParticipant, 
	original_data: Dictionary
) -> void:
	if original_data.is_empty():
		return
	
	print("[å¤‰èº«è§£é™¤] ", participant.creature_data.get("name", "?"), 
		  " â†’ ", original_data.get("name", "?"))
	
	# creature_dataã‚’å®Œå…¨ã«å…ƒã«æˆ»ã™
	participant.creature_data = original_data.duplicate(true)
```

---

## ä½¿ç”¨ä¾‹

### ã‚·ãƒŠãƒªã‚ª1: ãƒãƒ«ãƒ€ãƒ³ãƒ€ãƒ¼ã‚¹ï¼ˆãƒ©ãƒ³ãƒ€ãƒ å¤‰èº«ï¼‰

```
ä¾µç•¥å´: ãƒãƒ«ãƒ€ãƒ³ãƒ€ãƒ¼ã‚¹ (AP:0, HP:30)
é˜²å¾¡å´: ã‚´ãƒ–ãƒªãƒ³ (AP:20, HP:30)

ã€æˆ¦é—˜é–‹å§‹ã€‘
ã€å¤‰èº«å®Ÿè¡Œã€‘ãƒãƒ«ãƒ€ãƒ³ãƒ€ãƒ¼ã‚¹ â†’ ãƒ‰ãƒ©ã‚´ãƒ³
  å…ƒã®AP/HP: 0/30
  å¤‰èº«å¾ŒAP/HP: 50/60

ä¾µç•¥å´: ãƒ‰ãƒ©ã‚´ãƒ³
  åŸºæœ¬HP:60 + åœŸåœ°ãƒœãƒ¼ãƒŠã‚¹:10 = MHP:70
  AP:50

ã€ç¬¬1æ”»æ’ƒã€‘ä¾µç•¥å´ã®æ”»æ’ƒ
  ãƒ‰ãƒ©ã‚´ãƒ³ AP:50 â†’ ã‚´ãƒ–ãƒªãƒ³
  â†’ ã‚´ãƒ–ãƒªãƒ³æ’ƒç ´

ã€çµæœã€‘ä¾µç•¥æˆåŠŸ

ã€æˆ¦é—˜å¾Œå‡¦ç†ã€‘
[å¤‰èº«å¾©å¸°] ãƒ‰ãƒ©ã‚´ãƒ³ â†’ ãƒãƒ«ãƒ€ãƒ³ãƒ€ãƒ¼ã‚¹
  ãƒãƒ«ãƒ€ãƒ³ãƒ€ãƒ¼ã‚¹ã«æˆ»ã£ã¦é…ç½®
```

---

### ã‚·ãƒŠãƒªã‚ª2: ã‚³ã‚«ãƒˆãƒªã‚¹ï¼ˆå¼·åˆ¶å¤‰èº«ï¼‰

```
ä¾µç•¥å´: ã‚³ã‚«ãƒˆãƒªã‚¹ (AP:30, HP:40)
é˜²å¾¡å´: ã‚­ãƒ³ã‚°ãƒãƒ©ãƒ³ (AP:60, HP:50)

ã€ç¬¬1æ”»æ’ƒã€‘ä¾µç•¥å´ã®æ”»æ’ƒ
  ã‚³ã‚«ãƒˆãƒªã‚¹ AP:30 â†’ ã‚­ãƒ³ã‚°ãƒãƒ©ãƒ³
  ãƒ€ãƒ¡ãƒ¼ã‚¸å‡¦ç†:
	- åŸºæœ¬HP: 30 æ¶ˆè²»
  â†’ æ®‹HP: 20 (åŸºæœ¬HP:20)

ã€å¤‰èº«ç™ºå‹•ã€‘é˜²å¾¡å´ãŒå¤‰èº«
  [å¼·åˆ¶å¤‰èº«] ã‚­ãƒ³ã‚°ãƒãƒ©ãƒ³ â†’ ID:222
  ã€å¤‰èº«å®Ÿè¡Œã€‘ã‚­ãƒ³ã‚°ãƒãƒ©ãƒ³ â†’ ã‚¹ãƒˆãƒ¼ãƒ³ã‚¦ã‚©ãƒ¼ãƒ«
	å…ƒã®AP/HP: 60/50
	å¤‰èº«å¾ŒAP/HP: 0/60

ã€ç¬¬2æ”»æ’ƒã€‘é˜²å¾¡å´ã®æ”»æ’ƒ
  ã‚¹ãƒˆãƒ¼ãƒ³ã‚¦ã‚©ãƒ¼ãƒ« AP:0 â†’ ã‚³ã‚«ãƒˆãƒªã‚¹
  ãƒ€ãƒ¡ãƒ¼ã‚¸å‡¦ç†ãªã—ï¼ˆAP:0ã®ãŸã‚ï¼‰

ã€çµæœã€‘ä¸¡è€…ç”Ÿå­˜ â†’ ä¾µç•¥å¤±æ•—
  é˜²å¾¡å´ã‚¿ã‚¤ãƒ«ã®ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ã¯ã‚¹ãƒˆãƒ¼ãƒ³ã‚¦ã‚©ãƒ¼ãƒ«ã®ã¾ã¾
```

---

### ã‚·ãƒŠãƒªã‚ª3: å¤‰èº«å¾Œã®åœŸåœ°ãƒœãƒ¼ãƒŠã‚¹å†è¨ˆç®—

```
ä¾µç•¥å´: ãƒãƒ«ãƒ€ãƒ³ãƒ€ãƒ¼ã‚¹ (ç„¡å±æ€§, AP:0, HP:30)
é˜²å¾¡å´ã‚¿ã‚¤ãƒ«: ç«å±æ€§ Lv2 (åœŸåœ°ãƒœãƒ¼ãƒŠã‚¹+20)

ã€æˆ¦é—˜é–‹å§‹ã€‘
ã€å¤‰èº«å®Ÿè¡Œã€‘ãƒãƒ«ãƒ€ãƒ³ãƒ€ãƒ¼ã‚¹ â†’ ã‚µãƒ©ãƒãƒ³ãƒ€ãƒ¼ (ç«å±æ€§)
  å…ƒã®AP/HP: 0/30
  å¤‰èº«å¾Œ: AP:30, HP:40
  åœŸåœ°ãƒœãƒ¼ãƒŠã‚¹: ç«å±æ€§Lv2 â†’ +20
  æœ€çµ‚HP: 40 + 20 = 60
```

---

## è¨­è¨ˆæ€æƒ³

### 1. ã‚¿ãƒ¼ã‚²ãƒƒãƒˆæŒ‡å®šã®é‡è¦æ€§

- **`target`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯å¿…é ˆ**: "self"ã‹"opponent"ã‹ã‚’æ˜ç¢ºã«æŒ‡å®š
- **èª¤è§£ã‚’é˜²ã**: ã‚¹ã‚­ãƒ«ä¿æŒè€…ãŒå¤‰èº«ã™ã‚‹ã®ã‹ã€ç›¸æ‰‹ã‚’å¤‰èº«ã•ã›ã‚‹ã®ã‹æ˜ç¢ºåŒ–
- **ã‚³ãƒ¼ãƒ‰ã®å¯èª­æ€§**: å‡¦ç†ãƒ•ãƒ­ãƒ¼ãŒè¿½ã„ã‚„ã™ããªã‚‹

### 2. ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å‡¦ç†ã®ä¸€è²«æ€§

- **ã‚¢ã‚¤ãƒ†ãƒ ãƒœãƒ¼ãƒŠã‚¹ã¯å¼•ãç¶™ã**: å¤‰èº«ã—ã¦ã‚‚ã‚¢ã‚¤ãƒ†ãƒ ã®åŠ¹æœã¯ç¶­æŒ
- **åœŸåœ°ãƒœãƒ¼ãƒŠã‚¹ã¯å†è¨ˆç®—**: å¤‰èº«å…ˆã®å±æ€§ã«å¿œã˜ã¦å†åˆ¤å®š
- **HPç®¡ç†ã®è¤‡é›‘ã•**: åŸºæœ¬HPã€åœŸåœ°ãƒœãƒ¼ãƒŠã‚¹ã€ã‚¢ã‚¤ãƒ†ãƒ ãƒœãƒ¼ãƒŠã‚¹ã‚’æ­£ã—ãå‡¦ç†

### 3. æˆ¦é—˜å¾Œã®çŠ¶æ…‹ç®¡ç†

- **æ°¸ç¶šå¤‰èº«**: ã‚¿ã‚¤ãƒ«ã®creature_dataã‚’æ›´æ–°ã€æ¬¡å›æˆ¦é—˜ã§ã‚‚å¤‰èº«å¾Œã®å§¿
- **ä¸€æ™‚å¤‰èº«**: original_dataã‚’ä¿æŒã€æˆ¦é—˜å¾Œã«å¾©å¸°
- **ã‚¹ã‚­ãƒ«ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®æ›´æ–°**: ã‚¿ã‚¤ãƒ«æ›´æ–°æ™‚ã«ã‚¹ã‚­ãƒ«ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚‚å†æ§‹ç¯‰

### 4. æ‹¡å¼µæ€§

- **å°†æ¥ã®å¤‰èº«ã‚¿ã‚¤ãƒ—**: æ¡ä»¶ä»˜ãå¤‰èº«ã€å±æ€§æŒ‡å®šå¤‰èº«ãªã©ã‚’è¿½åŠ å¯èƒ½
- **å¤‰èº«è§£é™¤ã‚¹ã‚­ãƒ«**: å°†æ¥çš„ã«å¤‰èº«ã‚’è§£é™¤ã™ã‚‹ã‚¹ã‚­ãƒ«ã®å®Ÿè£…ãŒå¯èƒ½
- **å¤‰èº«ãƒã‚§ãƒ¼ãƒ³**: å¤‰èº«å…ˆãŒã•ã‚‰ã«å¤‰èº«ã™ã‚‹å‡¦ç†ã‚‚å¯¾å¿œå¯èƒ½

### 5. ãƒãƒ©ãƒ³ã‚¹èª¿æ•´

- **ãƒ©ãƒ³ãƒ€ãƒ å¤‰èº«ã®ãƒªã‚¹ã‚¯**: å¼±ã„ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ã«ãªã‚‹å¯èƒ½æ€§ã‚‚ã‚ã‚‹
- **å¼·åˆ¶å¤‰èº«ã®ç¢ºå®Ÿæ€§**: ã‚³ã‚«ãƒˆãƒªã‚¹ã¯ç›¸æ‰‹ã‚’ç¢ºå®Ÿã«å¼±ä½“åŒ–ã§ãã‚‹
- **æˆ¦é—˜å¾Œå¾©å¸°ã®å®‰å…¨æ€§**: ãƒãƒ«ãƒ€ãƒ³ãƒ€ãƒ¼ã‚¹ã¯å…ƒã«æˆ»ã‚‹ãŸã‚å®‰å¿ƒã—ã¦ä½¿ãˆã‚‹

---

## æ³¨æ„äº‹é …

### å®Ÿè£…ä¸Šã®æ³¨æ„

1. **å¤‰èº«ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã®é †å®ˆ**
   - `on_battle_start`: æˆ¦é—˜æº–å‚™å®Œäº†å¾Œã€æ”»æ’ƒé–‹å§‹å‰
   - `on_attack_success`: ãƒ€ãƒ¡ãƒ¼ã‚¸é©ç”¨å¾Œã€å³æ­»åˆ¤å®šå¾Œã€æ’ƒç ´åˆ¤å®šå‰

2. **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°ã®é †åº**
   - ã‚¢ã‚¤ãƒ†ãƒ ãƒœãƒ¼ãƒŠã‚¹ã‚’å…ˆã«è¨˜éŒ²
   - creature_dataã‚’ç½®ãæ›ãˆ
   - åœŸåœ°ãƒœãƒ¼ãƒŠã‚¹ã‚’å†è¨ˆç®—
   - HPã‚’å†è¨ˆç®—

3. **ã‚¿ã‚¤ãƒ«æ›´æ–°ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°**
   - æ°¸ç¶šå¤‰èº«ã®å ´åˆã®ã¿ã‚¿ã‚¤ãƒ«æ›´æ–°
   - update_tile_creature()ã§ã‚¹ã‚­ãƒ«ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚‚æ›´æ–°

4. **ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹**
   - å¤‰èº«å…ˆã®creature_idãŒç„¡åŠ¹ãªå ´åˆ
   - å³æ­»ã§å€’ã•ã‚ŒãŸå ´åˆã¯å¤‰èº«ã—ãªã„
   - å®Œå…¨ç„¡åŠ¹åŒ–ã•ã‚ŒãŸå ´åˆã¯å¤‰èº«åˆ¤å®šãªã—

---

## å¤‰æ›´å±¥æ­´

| ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | æ—¥ä»˜ | å¤‰æ›´å†…å®¹ |
|-----------|------|---------|
| 1.2 | 2025/10/31 | å®Ÿè£…çµ±åˆï¼šæ­»è€…å¾©æ´»ã‚¹ã‚­ãƒ«ã¨åŒã˜`skill_transform.gd`ã«çµ±åˆ |
| 1.1 | 2025/10/24 | ãƒã‚°ä¿®æ­£ï¼šæ”»æ’ƒæˆåŠŸæ™‚ã®å¤‰èº«æ¡ä»¶ã€ä¸€æ™‚å¤‰èº«ã®å¾©å¸°å‡¦ç†ã€æˆ¦é—˜çµæœæƒ…å ±ã®ãƒãƒ¼ã‚¸ |
| 1.0 | 2025/10/24 | åˆç‰ˆä½œæˆï¼šãƒãƒ«ãƒ€ãƒ³ãƒ€ãƒ¼ã‚¹ã€ã‚³ã‚«ãƒˆãƒªã‚¹ã®å¤‰èº«ã‚¹ã‚­ãƒ«å®Ÿè£… |

---

## ãƒã‚°ä¿®æ­£å±¥æ­´

### 2025/10/24 - æ”»æ’ƒæˆåŠŸæ™‚ã®å¤‰èº«æ¡ä»¶ä¿®æ­£
**å•é¡Œ**: AP:0ã®æ”»æ’ƒï¼ˆã‚¹ãƒˆãƒ¼ãƒ³ã‚¦ã‚©ãƒ¼ãƒ«ç­‰ï¼‰ã§ã‚‚å¤‰èº«ã‚¹ã‚­ãƒ«ãŒç™ºå‹•ã—ã¦ã„ãŸ

**åŸå› **: æ”»æ’ƒæˆåŠŸæ™‚ã®æ¡ä»¶ãŒã€Œç›¸æ‰‹ãŒç”Ÿå­˜ã—ã¦ã„ã‚‹ã€ã ã‘ã§ã€å®Ÿéš›ã«ãƒ€ãƒ¡ãƒ¼ã‚¸ã‚’ä¸ãˆãŸã‹ãƒã‚§ãƒƒã‚¯ã—ã¦ã„ãªã‹ã£ãŸ

**ä¿®æ­£å†…å®¹**:
```gdscript
// ä¿®æ­£å‰
if defender_p.is_alive() and card_system_ref:

// ä¿®æ­£å¾Œ  
if defender_p.is_alive() and card_system_ref and attacker_p.current_ap > 0:
```

**å½±éŸ¿**: AP > 0 ã®æ¡ä»¶ã‚’è¿½åŠ ã—ã€å®Ÿéš›ã«ãƒ€ãƒ¡ãƒ¼ã‚¸ã‚’ä¸ãˆãŸå ´åˆã®ã¿å¤‰èº«ãŒç™ºå‹•ã™ã‚‹ã‚ˆã†ã«ä¿®æ­£

---

### 2025/10/24 - ä¸€æ™‚å¤‰èº«ã®å¾©å¸°å‡¦ç†ä¿®æ­£

**å•é¡Œ1**: ãƒãƒ«ãƒ€ãƒ³ãƒ€ãƒ¼ã‚¹ãŒå¤‰èº«å¾Œã®ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ã®ã¾ã¾æ‰‹æœ­ã«æˆ»ã‚‹

**åŸå› **: å¤‰èº«å¾©å¸°å‡¦ç†ãŒæ‰‹æœ­ã«æˆ»ã™å‡¦ç†ã®**å¾Œ**ã«å®Ÿè¡Œã•ã‚Œã¦ã„ãŸ

**ä¿®æ­£å†…å®¹**: `BattleResult.ATTACKER_WIN`ã¨`ATTACKER_SURVIVED`ã§ã€å¤‰èº«å¾©å¸°ã‚’æ‰‹æœ­ã«æˆ»ã™/ã‚¿ã‚¤ãƒ«é…ç½®ã®å‰ã«å®Ÿè¡Œ

---

**å•é¡Œ2**: æˆ¦é—˜çµæœæƒ…å ±ãŒæ­£ã—ããƒãƒ¼ã‚¸ã•ã‚Œãšã€å¤‰èº«æƒ…å ±ãŒå¤±ã‚ã‚Œã‚‹

**åŸå› **: 
1. `battle_execution.execute_attack_sequence()`ãŒå¤‰èº«æƒ…å ±ã‚’è¿”ã—ã¦ã„ãªã‹ã£ãŸ
2. æ”»æ’ƒã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã®çµæœã§æˆ¦é—˜é–‹å§‹æ™‚ã®å¤‰èº«æƒ…å ±ãŒä¸Šæ›¸ãã•ã‚Œã¦ã„ãŸ

**ä¿®æ­£å†…å®¹**:
1. æˆ»ã‚Šå€¤ã‚’`revive_info`ã‹ã‚‰`battle_result`ã«æ‹¡å¼µã—ã€å¤‰èº«æƒ…å ±ã‚‚å«ã‚ã‚‹ã‚ˆã†ã«ä¿®æ­£
2. ãƒãƒ¼ã‚¸æ™‚ã«ç©ºã§ãªã„å€¤ã®ã¿ä¸Šæ›¸ãã™ã‚‹ãƒ­ã‚¸ãƒƒã‚¯ã‚’è¿½åŠ 

```gdscript
// ãƒãƒ¼ã‚¸ãƒ­ã‚¸ãƒƒã‚¯
for key in attack_result.keys():
	var value = attack_result[key]
	// å¾©æ´»ãƒ»å¤‰èº«ãƒ•ãƒ©ã‚°ã¯trueã®å ´åˆã®ã¿ä¸Šæ›¸ã
	if key in ["attacker_revived", "defender_revived"]:
		if value == true:
			battle_result[key] = value
	elif key in ["attacker_transformed", "defender_transformed"]:
		if value == true:
			battle_result[key] = value
	// originalæƒ…å ±ã¯ç©ºã§ãªã„å ´åˆã®ã¿ä¸Šæ›¸ã
	elif key in ["attacker_original", "defender_original"]:
		if not value.is_empty():
			battle_result[key] = value
```
