# 戦闘制限呪い

**バージョン**: 2.0  
**最終更新**: 2025年11月26日

---

## 概要

| 呪い名 | curse_type | 効果 | 実装 |
|-------|-----------|------|------|
| 戦闘能力不可 | `skill_nullify` | 戦闘スキル無効化 | ✅ |
| 戦闘行動不可 | `battle_disable` | 攻撃・アイテム・援護使用不可 | ✅ |

---

## 戦闘能力不可（skill_nullify）

### 効果
- 全能力を無効化（先制、強打、貫通、無効化、再生、反射、即死、変身、応援など）
- 基礎ステータス（AP/HP）とランドボーナスは有効

### 対象カード
| ID | 名前 | 種別 |
|----|------|------|
| 2094 | ボーテックス | スペル |

### 実装箇所
| ファイル | 処理 |
|----------|------|
| `spell_phase_handler.gd` | 呪い付与 |
| `battle_skill_processor.gd` | 戦闘開始時チェック |
| `skill_special_creature.gd` | 能力無効化処理 |

---

## 戦闘行動不可（battle_disable）

### 効果
| 項目 | 状態 |
|------|------|
| 攻撃 | ❌ スキップ |
| アイテム使用 | ❌ 強制パス |
| 援護使用 | ❌ 強制パス |
| 基礎ステータス | ✅ 有効 |
| ランドボーナス | ✅ 有効 |
| 応援（ステータス）| ✅ 有効 |

**重要**: 攻撃を「受ける」ことは可能（HPは減る）

### 対象カード
| ID | 名前 | 種別 | 付与タイミング |
|----|------|------|--------------|
| 2068 | バインドミスト | スペル | マップ上 |
| 2057 | ディラニー | スペル | マップ上（MHP30以下全体） |
| 1050 | バインドウィップ | アイテム | 攻撃成功時 |
| 132 | ハイド | クリーチャー | マップ上（秘術） |
| 332 | ナイキー | クリーチャー | 攻撃成功時 |

### 実装箇所
| ファイル | 処理 |
|----------|------|
| `spell_phase_handler.gd` | 呪い付与（スペル）、全体効果 |
| `item_phase_handler.gd` | アイテム・援護強制パス |
| `battle_execution.gd` | 攻撃スキップ、攻撃成功時呪い付与 |
| `target_selection_helper.gd` | クリーチャー存在チェック |

---

## データ構造

### クリーチャー呪い
```json
{
  "curse_type": "battle_disable",
  "name": "戦闘行動不可",
  "duration": -1,
  "params": {}
}
```

### スペル effect_parsed（単体）
```json
"effect_parsed": {
  "target_type": "land",
  "target_info": {
	"owner_filter": "any",
	"target_filter": "creature"
  },
  "effects": [{
	"effect_type": "battle_disable",
	"name": "戦闘行動不可",
	"duration": -1
  }]
}
```

### スペル effect_parsed（全体条件付き）
```json
"effect_parsed": {
  "target_type": "all_creatures",
  "target_info": {
	"condition": {
	  "condition_type": "mhp_check",
	  "operator": "<=",
	  "value": 30
	}
  },
  "effects": [{
	"effect_type": "battle_disable",
	"name": "戦闘行動不可",
	"duration": -1
  }]
}
```

### クリーチャー/アイテム（攻撃成功時）
```json
"effects": [{
  "effect_type": "on_attack_success_curse",
  "curse_type": "battle_disable",
  "name": "戦闘行動不可"
}]
```

---

## 変更履歴

| 日付 | Ver | 内容 |
|------|-----|------|
| 2025/11/26 | 1.0 | 初版 |
| 2025/11/26 | 2.0 | battle_disable 実装完了、ドキュメント整理 |
