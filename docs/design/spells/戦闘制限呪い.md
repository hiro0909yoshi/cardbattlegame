# 戦闘制限呪い設計

**バージョン**: 1.0  
**作成日**: 2025年11月26日

---

## 概要

戦闘に関する制限を与えるクリーチャー呪い。2種類存在する。

| 呪い名 | curse_type | 効果概要 |
|-------|-----------|---------|
| 戦闘能力不可 | `skill_nullify` | 戦闘スキルを無効化 |
| 戦闘行動不可 | `battle_disable` | 攻撃・アイテム使用不可 |

---

## 戦闘能力不可（skill_nullify）

### 効果

- クリーチャーの**戦闘スキル**（battle_skills）を全て無効化
- ウォーロックディスク（ID: 1004）と同じ効果を呪いとして付与

### 無効化される能力

| カテゴリ | 例 |
|---------|-----|
| 攻撃系 | 先制、強打、貫通、巻き込み |
| 防御系 | 無効化、再生、反射 |
| 特殊系 | 即死、吸収、不屈 |

### 無効化されないもの

- 基本ステータス（AP/HP）
- 地形ボーナス
- アイテム効果
- 応援効果
- スペル付与効果

### データ構造

```json
{
  "curse_type": "skill_nullify",
  "name": "戦闘能力不可",
  "duration": 3,
  "params": {}
}
```

### 実装ポイント

- **参照**: ウォーロックディスクの `nullify_all_enemy_abilities` 実装
- **適用タイミング**: `battle_preparation` フェーズ
- **処理**: 対象クリーチャーの `battle_skills` を一時的に無効化

---

## 戦闘行動不可（battle_disable）

### 効果

- **攻撃不可**: ダメージを与えられない
- **アイテム使用不可**: 戦闘中にアイテムを使用できない

### 有効なもの（計算対象に含まれる）

| 項目 | 説明 |
|------|------|
| ランドボーナスHP | 地形レベルによるHP増加 |
| 応援効果 | 隣接クリーチャーからの支援 |
| スペル付与効果 | バイタリティ等の呪いによるステータス変化 |
| 基本ステータス | AP/HP の基本値 |

### 無効なもの

| 項目 | 説明 |
|------|------|
| 攻撃 | ダメージ計算自体が行われない（AP=0扱い？要検討） |
| アイテム | 戦闘中のアイテム選択不可 |

### データ構造

```json
{
  "curse_type": "battle_disable",
  "name": "戦闘行動不可",
  "duration": 3,
  "params": {}
}
```

### 実装ポイント

- **適用タイミング**: `battle_preparation` フェーズ
- **処理案**:
  - `BattleParticipant.can_attack = false` フラグ追加？
  - `BattleParticipant.can_use_item = false` フラグ追加？
  - または `effective_ap = 0` として計算？

---

## 共通仕様

### 呪いの基本仕様（クリーチャー呪い）

| 項目 | 値 |
|------|-----|
| 保存場所 | `creature_data["curse"]` |
| 同時適用 | 1つのみ（上書き） |
| 消滅条件 | 移動、交換、撃破、ターン経過、上書き |

### 対象スペル（候補）

| ID | 名前 | 呪いタイプ | duration |
|----|------|-----------|----------|
| TBD | （仮）能力封じ | `skill_nullify` | 3〜5 |
| TBD | （仮）沈黙 | `battle_disable` | 3〜5 |

---

## 対象カード一覧

### 戦闘能力不可（skill_nullify）

| ID | 名前 | 種別 | 効果 |
|----|------|------|------|
| 2094 | ボーテックス | スペル | 対象領地に呪い"戦闘能力不可"；カードを1枚引く |
| 1004 | ウォーロックディスク | アイテム | 戦闘中能力無効（参考実装：`nullify_all_enemy_abilities`） |

### 戦闘行動不可（battle_disable）

| ID | 名前 | 種別 | 効果 |
|----|------|------|------|
| 2068 | バインドミスト | スペル | 対象領地に呪い"戦闘行動不可" |
| 2057 | ディラニー | スペル | MHP30以下の全クリーチャーに呪い"戦闘行動不可" |
| 2092 | ペナライズ | スペル | 全ブリードクリーチャーをダウンさせ、呪い"戦闘行動不可"をつける |
| 1050 | バインドウィップ | アイテム | AP+30；攻撃成功時、敵に呪い"戦闘行動不可" |
| 132 | ハイド | クリーチャー（水） | 秘術[G50・対象敵領地に呪い戦闘行動不可] |
| 332 | ナイキー | クリーチャー（風） | 先制；攻撃成功時、敵に呪い"戦闘行動不可" |

---

## 検討事項

### 戦闘行動不可の詳細

1. **攻撃不可の実装方法**
   - AP=0として計算？
   - ダメージ計算自体をスキップ？
   - 攻撃フェーズをスキップ？

2. **防御時の挙動**
   - 防御側が戦闘行動不可の場合、攻撃は受ける？
   - HPは通常通り計算される？

3. **アイテム不可の範囲**
   - 武器・防具・巻物全て？
   - 特定カテゴリのみ？

### 両方の呪いが競合した場合

- 後からかけた呪いで上書き（既存仕様通り）

---

## 変更履歴

| 日付 | バージョン | 変更内容 |
|------|-----------|---------|
| 2025/11/26 | 1.0 | 初版作成 |
