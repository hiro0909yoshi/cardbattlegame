# 変身スペル・アルカナアーツ

## 概要
クリーチャーを別のクリーチャーに変身させる。装備アイテムと永続ボーナスは引き継ぐが、刻印は消える。変身後は必ずダウン状態になる。

## 実装ファイル
- `scripts/spells/spell_transform.gd` - 変身処理クラス
- `scripts/game_flow/spell_phase_handler.gd` - effect_type: transform, discord_transform

---

## スペル

| ID | 名前 | コスト | 効果 | 変身先決定方法 |
|----|------|--------|------|----------------|
| 2049 | ターンウォール | 80MP | 対象クリーチャーを同属性の堅守に変える | 属性別固定 |
| 2056 | ディスコード | 80MP+1枚 | 最多配置クリーチャー1種を全てゴブリンに | ゴブリン(414)固定 |

### ターンウォール変身先（属性別固定）

| 属性 | 変身先 | ID |
|------|--------|-----|
| 火 | オールドウィロウ | 5 |
| 水 | アイスウォール | 102 |
| 地 | ストーンウォール | 222 |
| 風 | トルネード | 330 |
| 無 | スタチュー | 421 |

---

## アルカナアーツ変身（9体）

| ID | 名前 | 属性 | コスト | 変身先 | 変身先ID |
|----|------|------|--------|--------|----------|
| 20 | デスサイズ | 火 | 50EP | マミー | 239 |
| 104 | アクアホーン | 水 | 30EP | ミストウィング | 142 |
| 135 | ヒッポカンパス | 水 | 60EP | ケルピー | 121 |
| 142 | ミストウィング | 水 | 30EP | アクアホーン | 104 |
| 224 | スプラウトリング | 地 | 50EP | オールドウィロウ | 5 |
| 236 | ブランチアーミー | 地 | 50EP | マッドマン | 238 |
| 319 | シルフ | 風 | 60EP | ガルーダ | 307 |
| 324 | ソードプリンセス | 風 | 60EP | アームドプリンセス | 300 |
| 417 | シェイプシフター | 無 | 70EP | 対象と同じ | (コピー) |

※ アクアホーン⇔ミストウィングは双方向変身
※ シェイプシフターのみ対象選択型（自分以外のクリーチャーを選択してコピー）

---

## 変身タイプ

| 指定方法 | 説明 | 使用箇所 |
|----------|------|----------|
| `transform_to: ID` | 固定IDへ変身 | アルカナアーツ変身8体 |
| `transform_type: "copy_target"` | 選択対象と同じに | シェイプシフター |
| `transform_type: "same_element_defensive"` | 同属性堅守（属性別固定） | ターンウォール |
| `effect_type: "discord_transform"` | 最多配置種→ゴブリン | ディスコード |

---

## 引き継ぎ仕様

| 項目 | 引き継ぐ | 備考 |
|------|----------|------|
| アイテム装備 | ○ | items配列 |
| 永続ボーナス | ○ | base_up_hp, base_up_ap |
| 土地所有者 | ○ | owner_id |
| 刻印 | × | 変身で消える |
| ダウン状態 | - | 変身後は必ずダウン |

### HP計算
```
変身後HP = 新クリーチャーの基礎HP + 永続ボーナス(base_up_hp)
```

---

## JSONデータ例

### アルカナアーツ（固定ID変身）
```json
"ability_parsed": {
  "keywords": ["アルカナアーツ"],
  "mystic_arts": [{
	"name": "ファラオズギフト変身",
	"cost": 50,
	"target_type": "none",
	"effects": [{
	  "effect_type": "transform",
	  "target": "self",
	  "transform_to": 239
	}]
  }]
}
```

### アルカナアーツ（対象コピー）
```json
"mystic_arts": [{
  "name": "対象と同じクリーチャーに変身",
  "cost": 70,
  "target_type": "creature",
  "target_info": { "owner_filter": "any", "exclude_self": true },
  "effects": [{
	"effect_type": "transform",
	"target": "self",
	"transform_type": "copy_target"
  }]
}]
```

### ターンウォール
```json
"effect_parsed": {
  "target_type": "creature",
  "target_info": { "owner_filter": "any" },
  "effects": [{
	"effect_type": "transform",
	"target": "target",
	"transform_type": "same_element_defensive"
  }]
}
```

### ディスコード
```json
"effect_parsed": {
  "target_type": "none",
  "effects": [{ "effect_type": "discord_transform" }]
}
```

---

## 関連ドキュメント
- 戦闘スキル変身: `docs/design/skills/transform_skill.md`
- アルカナアーツシステム: `docs/design/mystic_arts.md`
