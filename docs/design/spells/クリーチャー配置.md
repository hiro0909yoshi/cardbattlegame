# クリーチャー配置システム 完成図書

**バージョン**: 2.0  
**最終更新**: 2025年11月30日  
**ステータス**: 実装完了

---

## 概要

マップ上の空き地にクリーチャーを配置するスペル・秘術システム。

### 配置方式

| モード | 説明 | 対象スペル/秘術 |
|--------|------|----------------|
| `select` | プレイヤーが配置場所を選択 | グーバクイーン秘術、コンジャラー秘術 |
| `random` | ランダムな空き地に自動配置 | スパルトイ、ワイルドセンス |
| `conditional` | 空地停止時のみ配置 | ゴブリンズレア |
| `adjacent` | 発動者の隣接空き地に配置 | レジェンドファロス秘術 |

### 配置制限

- 特殊タイル（warp, card, checkpoint, start）には配置不可
- 無属性タイル（neutral）には配置可能

---

## 実装済みスペル

| ID | 名前 | 配置対象 | creature_id | 配置方式 | 備考 |
|----|------|---------|-------------|----------|------|
| 2028 | ゴブリンズレア | ゴブリン | 414 | conditional | 復帰[手札] |
| 2043 | スパルトイ | スケルトン | 420 | random | - |
| 2132 | ワイルドセンス | ドロー結果 | 動的 | random | ドロー→クリーチャーなら配置 |

## 実装済み秘術

| ID | クリーチャー | 配置対象 | creature_id | 配置方式 | 備考 |
|----|-------------|---------|-------------|----------|------|
| 12 | コンジャラー | バーアル | 27 | select | 自壊付き |
| 209 | グーバクイーン | グーバ | 208 | select | - |
| 444 | レジェンドファロス | スタチュー | 421 | adjacent | - |

---

## JSON定義例

### スペル

```json
// ゴブリンズレア (2028) - 条件付き配置
{
  "effect_parsed": {
	"target_type": "self",
	"effects": [
	  {
		"effect_type": "place_creature",
		"creature_id": 414,
		"placement_mode": "conditional"
	  }
	],
	"return_to_hand": true
  }
}

// スパルトイ (2043) - ランダム配置
{
  "effect_parsed": {
	"target_type": "none",
	"effects": [
	  {
		"effect_type": "place_creature",
		"creature_id": 420,
		"placement_mode": "random"
	  }
	]
  }
}

// ワイルドセンス (2132) - ドロー＋配置
{
  "effect_parsed": {
	"target_type": "none",
	"effects": [
	  {
		"effect_type": "draw_and_place",
		"draw_count": 1,
		"placement_mode": "random",
		"card_type_filter": "creature"
	  }
	]
  }
}
```

### 秘術

```json
// コンジャラー (12) - 指定配置＋自壊
{
  "ability_parsed": {
	"keywords": ["巻物強打", "秘術"],
	"mystic_arts": [{
	  "name": "バーアル召喚",
	  "cost": 80,
	  "target_type": "land",
	  "target_info": {
		"owner_filter": "any",
		"target_filter": "empty"
	  },
	  "effects": [
		{ "effect_type": "place_creature", "creature_id": 27, "placement_mode": "select" },
		{ "effect_type": "self_destroy", "clear_land": true }
	  ]
	}]
  }
}

// グーバクイーン (209) - 指定配置
{
  "ability_parsed": {
	"keywords": ["秘術"],
	"mystic_arts": [{
	  "name": "グーバ配置",
	  "cost": 20,
	  "target_type": "land",
	  "target_info": { "owner_filter": "any", "target_filter": "empty" },
	  "effects": [
		{ "effect_type": "place_creature", "creature_id": 208, "placement_mode": "select" }
	  ]
	}]
  }
}

// レジェンドファロス (444) - 隣接配置
{
  "ability_parsed": {
	"keywords": ["防御型", "周回回復不可", "秘術"],
	"mystic_arts": [{
	  "name": "スタチュー配置",
	  "cost": 80,
	  "target_type": "self",
	  "effects": [
		{ "effect_type": "place_creature", "creature_id": 421, "placement_mode": "adjacent" }
	  ]
	}]
  }
}
```

---

## 効果タイプ

### place_creature

クリーチャーをマップに配置する。

| パラメータ | 型 | 説明 |
|-----------|-----|------|
| creature_id | int | 配置するクリーチャーのID |
| placement_mode | string | 配置方式（select/random/conditional/adjacent） |
| set_down | bool | 配置後ダウン状態にするか（省略時false） |

### draw_and_place

カードを引き、クリーチャーだった場合に配置する。

| パラメータ | 型 | 説明 |
|-----------|-----|------|
| draw_count | int | 引くカード枚数 |
| placement_mode | string | 配置方式 |
| card_type_filter | string | "creature"=クリーチャーのみ配置 |

### self_destroy

発動者を自壊させる（コンジャラー用）。

| パラメータ | 型 | 説明 |
|-----------|-----|------|
| clear_land | bool | 土地の所有権も解除するか |

---

## 関連ファイル

| ファイル | 役割 |
|---------|------|
| `scripts/spells/spell_creature_place.gd` | 配置処理の実装 |
| `scripts/game_flow/spell_phase_handler.gd` | スペル効果の適用 |
| `scripts/spells/spell_mystic_arts.gd` | 秘術効果の適用 |
| `scripts/game_flow/target_selection_helper.gd` | ターゲット選択・空地フィルター |
| `data/spell_1.json` | ゴブリンズレア、スパルトイ定義 |
| `data/spell_2.json` | ワイルドセンス定義 |
| `data/fire_1.json` | コンジャラー定義 |
| `data/earth_1.json` | グーバクイーン定義 |
| `data/neutral_2.json` | レジェンドファロス定義 |

---

## 変更履歴

| 日付 | バージョン | 内容 |
|------|-----------|------|
| 2025/11/30 | 1.0-1.5 | 設計フェーズ |
| 2025/11/30 | 2.0 | 実装完了・完成図書化 |
