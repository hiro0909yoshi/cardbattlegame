# ãƒ€ãƒ¡ãƒ¼ã‚¸æ“ä½œã‚·ã‚¹ãƒ†ãƒ 

**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: ğŸŸ¡ å®Ÿè£…ä¸­  
**æœ€çµ‚æ›´æ–°**: 2025å¹´11æœˆ27æ—¥

---

## æ¦‚è¦

ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ã«ãƒ€ãƒ¡ãƒ¼ã‚¸ã‚’ä¸ãˆã‚‹ãƒ»å›å¾©ã™ã‚‹ã‚¹ãƒšãƒ«ãƒ»ç§˜è¡“ã®åŠ¹æœã‚·ã‚¹ãƒ†ãƒ ã€‚

---

## å®Ÿè£…çŠ¶æ³

### ã‚·ã‚¹ãƒ†ãƒ å®Ÿè£…

| é …ç›® | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ |
|------|----------|
| å˜ä½“ãƒ€ãƒ¡ãƒ¼ã‚¸ (`_apply_damage_effect`) | âœ… å®Œäº† |
| å…¨ä½“ãƒ€ãƒ¡ãƒ¼ã‚¸ (`SpellCurseBattle.apply_to_all_creatures`) | âœ… å®Œäº† |
| ç§˜è¡“ãƒ€ãƒ¡ãƒ¼ã‚¸ (`spell_mystic_arts._apply_damage`) | âœ… å®Œäº† |

---

## ã‚¹ãƒšãƒ«ä¸€è¦§ï¼ˆ13å€‹ï¼‰

### å˜ä½“ãƒ€ãƒ¡ãƒ¼ã‚¸

| ID | åå‰ | åŠ¹æœ | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ |
|----|------|------|----------|
| 2106 | ãƒã‚¸ãƒƒã‚¯ãƒœãƒ«ãƒˆ | å¯¾è±¡æ•µã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ã®HP-20 | âœ… å®Ÿè£…æ¸ˆ |
| 2033 | ã‚·ãƒ£ã‚¤ãƒ‹ãƒ³ã‚°ã‚¬ã‚¤ã‚¶ãƒ¼ | å¯¾è±¡æ•µã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ã®HP-30ï¼›åˆæˆ[âˆ…ã‚¹ãƒšãƒ«ãƒ»åŠ¹æœã¯HP-40] | âœ… å®Ÿè£…æ¸ˆï¼ˆé€šå¸¸åŠ¹æœã®ã¿ï¼‰ |

### æ¡ä»¶ä»˜ãå˜ä½“ãƒ€ãƒ¡ãƒ¼ã‚¸

| ID | åå‰ | åŠ¹æœ | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ |
|----|------|------|----------|
| 2031 | ã‚µãƒ³ãƒ€ãƒ¼ã‚¯ãƒ©ãƒƒãƒ— | å¯†å‘½ï¼›å¬å–šæ¡ä»¶ã®ã‚ã‚‹å¯¾è±¡æ•µã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ã®HP-30 | âœ… å®Ÿè£…æ¸ˆ |
| 2041 | ã‚¹ãƒˆãƒ¼ãƒ³ãƒ–ãƒ©ã‚¹ãƒˆ | å¯¾è±¡ã€åœ°é¢¨ã®HP-30 | âœ… å®Ÿè£…æ¸ˆ |
| 2088 | ãƒ–ãƒ¬ã‚¤ã‚ºã‚¹ãƒ—ãƒ©ãƒƒã‚·ãƒ¥ | å¯¾è±¡ç«æ°´ã®HP-30 | âœ… å®Ÿè£…æ¸ˆ |

### å…¨ä½“ãƒ€ãƒ¡ãƒ¼ã‚¸ï¼ˆæ¡ä»¶ä»˜ãï¼‰

| ID | åå‰ | åŠ¹æœ | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ |
|----|------|------|----------|
| 2016 | ã‚¨ãƒ¬ãƒ¡ãƒ³ã‚¿ãƒ«ãƒ©ã‚¹ | é ˜åœ°ã¨å±æ€§ã®åˆã‚ãªã„å…¨ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ã®HP-20 | âœ… å®Ÿè£…æ¸ˆ |
| 2023 | ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ãƒãƒ¼ã‚¹ãƒˆ | æœ€å¤šå±æ€§ã®å…¨ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ã®HP-20 | âœ… å®Ÿè£…æ¸ˆ |
| 2053 | ãƒ‡ã‚£ã‚¶ã‚¹ã‚¿ãƒ¼ | ãƒ€ã‚¦ãƒ³ã—ãŸMHP50ä»¥ä¸Šã®å…¨ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ã®HP-30 | âœ… å®Ÿè£…æ¸ˆ |
| 2037 | ã‚¹ã‚¦ã‚©ãƒ¼ãƒ  | HPãŒæ¸›å°‘ã—ã¦ã„ã‚‹å…¨ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ã®HP-20 | âœ… å®Ÿè£…æ¸ˆ |
| 2065 | ãƒãƒ¼ãƒ‹ãƒ³ã‚°ãƒ™ã‚¤ãƒ« | å…¨æ°´é¢¨ã®HP-20 | âœ… å®Ÿè£…æ¸ˆ |
| 2086 | ãƒ•ãƒªãƒ¼ã‚ºã‚µã‚¤ã‚¯ãƒ­ãƒ³ | å…¨ç«åœ°ã®HP-20 | âœ… å®Ÿè£…æ¸ˆ |

### å›å¾©

| ID | åå‰ | åŠ¹æœ | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ |
|----|------|------|----------|
| 2121 | ãƒªã‚¹ãƒˆã‚¢ | å¯¾è±¡ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ã®ãƒ€ã‚¦ãƒ³è§£é™¤ï¼›å¯¾è±¡ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ã®HPã‚’å…¨å›å¾© | [ ] æœªå®Ÿè£… |
| 2116 | ãƒ©ã‚¤ãƒ•ã‚¹ãƒˆãƒªãƒ¼ãƒ  | å…¨è‡ªã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ã®HPã‚’å…¨å›å¾© | [ ] æœªå®Ÿè£… |

---

## ç§˜è¡“ï¼ˆãƒ€ãƒ¡ãƒ¼ã‚¸ãƒ»å›å¾©ç³»ï¼‰ä¸€è¦§

### ãƒ€ãƒ¡ãƒ¼ã‚¸ç³»

| ID | ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ | å±æ€§ | ç§˜è¡“åŠ¹æœ | ã‚³ã‚¹ãƒˆ | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ |
|----|-------------|------|----------|--------|----------|
| 231 | ãƒãƒ¼ãƒ‰ãƒ­ãƒƒã‚¯ãƒ‰ãƒ©ã‚´ãƒ³ | åœ° | å¯¾è±¡æ•µç«é¢¨ã®HP-20 | G60 | [ ] æœªå®Ÿè£… |
| 304 | ã‚¨ãƒ«ãƒ•ã‚¢ãƒ¼ãƒãƒ£ãƒ¼ | é¢¨ | å¯¾è±¡æ•µã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ã®HP-10 | G20 | [ ] æœªå®Ÿè£… |
| 344 | ãƒ©ã‚¤ãƒˆãƒ‹ãƒ³ã‚°ãƒ‰ãƒ©ã‚´ãƒ³ | é¢¨ | å¯¾è±¡æ•µæ°´åœ°ã®HP-20 | G60 | [ ] æœªå®Ÿè£… |
| 404 | ã‚¢ãƒ¼ãƒãƒ¼ãƒ‰ãƒ©ã‚´ãƒ³ | ç„¡ | å¯¾è±¡ç„¡ã®HP-30 | G80 | [ ] æœªå®Ÿè£… |
| 428 | ãƒ‹ãƒ«ãƒ¼ãƒãƒ¼ãƒŠ | ç„¡ | å‘ªã„ã®ã¤ã„ãŸå…¨ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ã®HP-20 | G100 | [ ] æœªå®Ÿè£… |

### å›å¾©ç³»

| ID | ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ | å±æ€§ | ç§˜è¡“åŠ¹æœ | ã‚³ã‚¹ãƒˆ | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ |
|----|-------------|------|----------|--------|----------|
| 233 | ãƒ’ãƒ¼ãƒ©ãƒ¼ | åœ° | å¯¾è±¡è‡ªã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ã®HPã‚’30å›å¾© | G10 | [ ] æœªå®Ÿè£… |

---

## ãƒ‡ãƒ¼ã‚¿æ§‹é€ 

### ã‚¹ãƒšãƒ«JSONï¼ˆå˜ä½“ãƒ€ãƒ¡ãƒ¼ã‚¸ï¼‰

```json
{
  "id": 2106,
  "name": "ãƒã‚¸ãƒƒã‚¯ãƒœãƒ«ãƒˆ",
  "type": "spell",
  "cost": { "mp": 30 },
  "effect_parsed": {
	"target_type": "creature",
	"target_info": {
	  "owner_filter": "enemy"
	},
	"effects": [
	  {
		"effect_type": "damage",
		"value": 20
	  }
	]
  }
}
```

### ã‚¹ãƒšãƒ«JSONï¼ˆå…¨ä½“ãƒ€ãƒ¡ãƒ¼ã‚¸ãƒ»æ¡ä»¶ä»˜ãï¼‰

```json
{
  "id": 2016,
  "name": "ã‚¨ãƒ¬ãƒ¡ãƒ³ã‚¿ãƒ«ãƒ©ã‚¹",
  "type": "spell",
  "cost": { "mp": 50 },
  "effect_parsed": {
	"target_type": "all_creatures",
	"target_info": {
	  "condition": "element_mismatch"
	},
	"effects": [
	  {
		"effect_type": "damage",
		"value": 20
	  }
	]
  }
}
```

### ç§˜è¡“JSONï¼ˆç›´æ¥effectsæ–¹å¼ï¼‰

```json
{
  "mystic_arts": [
	{
	  "name": "ãƒ€ãƒ¡ãƒ¼ã‚¸ãƒœãƒ«ãƒˆ",
	  "cost": 30,
	  "target_type": "creature",
	  "target_info": { "owner_filter": "enemy" },
	  "effects": [{ "effect_type": "damage", "value": 20 }]
	}
  ]
}
```

---

## å®Ÿè£…ãƒ•ãƒ­ãƒ¼

### å˜ä½“ãƒ€ãƒ¡ãƒ¼ã‚¸

```
1. ã‚¿ãƒ¼ã‚²ãƒƒãƒˆé¸æŠUIï¼ˆâ†‘â†“ã§åˆ‡æ›¿ã€Enterã§ç¢ºå®šï¼‰
2. å¯¾è±¡ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ã«ã‚«ãƒ¡ãƒ©ãƒ•ã‚©ãƒ¼ã‚«ã‚¹
3. spell_damage.apply_damage() å‘¼ã³å‡ºã—
4. ãƒ€ãƒ¡ãƒ¼ã‚¸é€šçŸ¥è¡¨ç¤ºï¼ˆHP: ç¾åœ¨/MHP â†’ æ–°HP/MHPï¼‰
5. HP <= 0 ã®å ´åˆã€å€’ã•ã‚ŒãŸé€šçŸ¥ â†’ ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼æ¶ˆå»ï¼ˆãƒ¬ãƒ™ãƒ«ç¶­æŒï¼‰
6. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚¯ãƒªãƒƒã‚¯/ã‚¿ãƒƒãƒ—å¾…ã¡
7. ã‚¹ãƒšãƒ«ãƒ•ã‚§ãƒ¼ã‚ºçµ‚äº†
```

### å…¨ä½“ãƒ€ãƒ¡ãƒ¼ã‚¸

```
1. target_info ã®æ¡ä»¶ã§å¯¾è±¡ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
2. å¯¾è±¡ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼1ä½“ç›®ã«ã‚«ãƒ¡ãƒ©ãƒ•ã‚©ãƒ¼ã‚«ã‚¹
3. spell_damage.apply_damage() å‘¼ã³å‡ºã—
4. ãƒ€ãƒ¡ãƒ¼ã‚¸é€šçŸ¥è¡¨ç¤ºï¼ˆHP: ç¾åœ¨/MHP â†’ æ–°HP/MHPï¼‰
5. HP <= 0 ã®å ´åˆã€å€’ã•ã‚ŒãŸé€šçŸ¥ â†’ ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼æ¶ˆå»ï¼ˆãƒ¬ãƒ™ãƒ«ç¶­æŒï¼‰
6. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚¯ãƒªãƒƒã‚¯/ã‚¿ãƒƒãƒ—å¾…ã¡
7. æ¬¡ã®ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ã¸ï¼ˆ2ã«æˆ»ã‚‹ï¼‰
8. å…¨å“¡çµ‚ã‚ã£ãŸã‚‰ã‚¹ãƒšãƒ«ãƒ•ã‚§ãƒ¼ã‚ºçµ‚äº†
```

### å›å¾©

```
1. ã‚¿ãƒ¼ã‚²ãƒƒãƒˆé¸æŠUIï¼ˆå˜ä½“ï¼‰ã¾ãŸã¯è‡ªå‹•é©ç”¨ï¼ˆå…¨ä½“ï¼‰
2. å¯¾è±¡ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ã«ã‚«ãƒ¡ãƒ©ãƒ•ã‚©ãƒ¼ã‚«ã‚¹
3. spell_damage.apply_heal() / apply_full_heal() å‘¼ã³å‡ºã—
4. å›å¾©é€šçŸ¥è¡¨ç¤ºï¼ˆHP: ç¾åœ¨/MHP â†’ æ–°HP/MHPï¼‰
5. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚¯ãƒªãƒƒã‚¯/ã‚¿ãƒƒãƒ—å¾…ã¡
6. æ¬¡ã®ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ã¸ï¼ˆå…¨ä½“ã®å ´åˆï¼‰ã¾ãŸã¯ã‚¹ãƒšãƒ«ãƒ•ã‚§ãƒ¼ã‚ºçµ‚äº†
```

---

## ãƒ€ãƒ¡ãƒ¼ã‚¸ãƒ»å›å¾©æ¼”å‡º

### è¡¨ç¤ºãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ

**ãƒ€ãƒ¡ãƒ¼ã‚¸ï¼ˆç”Ÿå­˜ï¼‰**:
```
â—‹â—‹ã«20ãƒ€ãƒ¡ãƒ¼ã‚¸ï¼
HP: 30/50 â†’ 10/50

[ã‚¯ãƒªãƒƒã‚¯ã§æ¬¡ã¸]
```

**ãƒ€ãƒ¡ãƒ¼ã‚¸ï¼ˆæ’ƒç ´ï¼‰**:
```
â—‹â—‹ã«20ãƒ€ãƒ¡ãƒ¼ã‚¸ï¼
HP: 10/50 â†’ 0/50
â—‹â—‹ã¯å€’ã•ã‚ŒãŸï¼

[ã‚¯ãƒªãƒƒã‚¯ã§æ¬¡ã¸]
```

**å›å¾©**:
```
â—‹â—‹ã®HPãŒ30å›å¾©ï¼
HP: 20/50 â†’ 50/50

[ã‚¯ãƒªãƒƒã‚¯ã§æ¬¡ã¸]
```

**å…¨å›å¾©**:
```
â—‹â—‹ã®HPãŒå…¨å›å¾©ï¼
HP: 20/50 â†’ 50/50

[ã‚¯ãƒªãƒƒã‚¯ã§æ¬¡ã¸]
```

### æ¼”å‡ºã‚¿ã‚¤ãƒŸãƒ³ã‚°

| å‡¦ç† | ã‚¿ã‚¤ãƒŸãƒ³ã‚° |
|------|-----------|
| ã‚«ãƒ¡ãƒ©ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ | ãƒ€ãƒ¡ãƒ¼ã‚¸/å›å¾©å‰ |
| HPè¨ˆç®—ãƒ»æ›´æ–° | é€šçŸ¥è¡¨ç¤ºã¨åŒæ™‚ |
| æ’ƒç ´åˆ¤å®š | HPæ›´æ–°ç›´å¾Œ |
| ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼æ¶ˆå» | æ’ƒç ´é€šçŸ¥è¡¨ç¤ºã¨åŒæ™‚ï¼ˆ3Dè¡¨ç¤ºã‚‚å‰Šé™¤ï¼‰ |
| æ¬¡ã¸é€²ã‚€ | ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚¯ãƒªãƒƒã‚¯/ã‚¿ãƒƒãƒ—ï¼ˆæœ€å¤§7ç§’ã§ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼‰ |

### å‘¼ã³å‡ºã—å…ƒ

```
spell_phase_handler â†’ spell_damage.apply_damage() / apply_heal()
spell_mystic_arts  â†’ spell_damage.apply_damage() / apply_heal()
```

ç§˜è¡“ã‹ã‚‰ã‚‚ç›´æ¥`spell_damage.gd`ã‚’å‘¼ã³å‡ºã™ï¼ˆã‚·ãƒ³ãƒ—ãƒ«ãªæ§‹é€ ï¼‰ã€‚

---

## ã‚¿ãƒ¼ã‚²ãƒƒãƒˆé¸æŠã‚·ã‚¹ãƒ†ãƒ 

### æ¦‚è¦

`TargetSelectionHelper.get_valid_targets()` ã‚’æ‹¡å¼µã—ã€`target_info` ã®æ¡ä»¶ã§ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã™ã‚‹ã€‚
é¸æŠUIã¯æ—¢å­˜ã®ã‚¹ãƒšãƒ«ï¼ˆãƒã‚¤ã‚¿ãƒªãƒ†ã‚£ç­‰ï¼‰ã¨åŒã˜ã‚‚ã®ã‚’ä½¿ç”¨ã€‚

### target_info ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ä¸€è¦§

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ | å‹ | èª¬æ˜ | ä½¿ç”¨ä¾‹ |
|-----------|-----|------|--------|
| `owner_filter` | String | æ‰€æœ‰è€…ãƒ•ã‚£ãƒ«ã‚¿: `"own"`, `"enemy"`, `"any"` | å…¨ã‚¹ãƒšãƒ«å…±é€š |
| `creature_elements` | Array | ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼å±æ€§åˆ¶é™ | ã‚¹ãƒˆãƒ¼ãƒ³ãƒ–ãƒ©ã‚¹ãƒˆï¼ˆåœ°/é¢¨ï¼‰ |
| `has_curse` | bool | å‘ªã„ä»˜ãã®ã¿ | ãƒ‹ãƒ«ãƒ¼ãƒãƒ¼ãƒŠ |
| `has_summon_condition` | bool | å¬å–šæ¡ä»¶ã‚ã‚Šã®ã¿ | ã‚µãƒ³ãƒ€ãƒ¼ã‚¯ãƒ©ãƒƒãƒ— |
| `hp_reduced` | bool | HPæ¸›å°‘ä¸­ã®ã¿ | ã‚¹ã‚¦ã‚©ãƒ¼ãƒ  |
| `is_down` | bool | ãƒ€ã‚¦ãƒ³ä¸­ã®ã¿ | ãƒ‡ã‚£ã‚¶ã‚¹ã‚¿ãƒ¼ |
| `mhp_check` | Dictionary | MHPæ¡ä»¶ `{operator, value}` | ãƒ‡ã‚£ã‚¶ã‚¹ã‚¿ãƒ¼ï¼ˆMHP>=50ï¼‰ |
| `element_mismatch` | bool | é ˜åœ°å±æ€§ã¨ä¸ä¸€è‡´ | ã‚¨ãƒ¬ãƒ¡ãƒ³ã‚¿ãƒ«ãƒ©ã‚¹ |

### ã‚¹ãƒšãƒ«åˆ¥ target_info è¨­å®š

#### å˜ä½“ãƒ€ãƒ¡ãƒ¼ã‚¸

```json
// ãƒã‚¸ãƒƒã‚¯ãƒœãƒ«ãƒˆ - å¯¾è±¡æ•µã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ã®HP-20
{
  "target_type": "creature",
  "target_info": {
	"owner_filter": "enemy"
  }
}

// ã‚¹ãƒˆãƒ¼ãƒ³ãƒ–ãƒ©ã‚¹ãƒˆ - å¯¾è±¡åœ°é¢¨ã®HP-30
{
  "target_type": "creature",
  "target_info": {
	"owner_filter": "enemy",
	"creature_elements": ["earth", "wind"]
  }
}

// ãƒ–ãƒ¬ã‚¤ã‚ºã‚¹ãƒ—ãƒ©ãƒƒã‚·ãƒ¥ - å¯¾è±¡ç«æ°´ã®HP-30
{
  "target_type": "creature",
  "target_info": {
	"owner_filter": "enemy",
	"creature_elements": ["fire", "water"]
  }
}

// ã‚µãƒ³ãƒ€ãƒ¼ã‚¯ãƒ©ãƒƒãƒ— - å¬å–šæ¡ä»¶ã®ã‚ã‚‹å¯¾è±¡æ•µã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ã®HP-30
{
  "target_type": "creature",
  "target_info": {
	"owner_filter": "enemy",
	"has_summon_condition": true
  }
}
```

#### å…¨ä½“ãƒ€ãƒ¡ãƒ¼ã‚¸

```json
// ã‚¨ãƒ¬ãƒ¡ãƒ³ã‚¿ãƒ«ãƒ©ã‚¹ - é ˜åœ°ã¨å±æ€§ã®åˆã‚ãªã„å…¨ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ã®HP-20
{
  "target_type": "all_creatures",
  "target_info": {
	"element_mismatch": true
  }
}

// ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ãƒãƒ¼ã‚¹ãƒˆ - æœ€å¤šå±æ€§ã®å…¨ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ã®HP-20
{
  "target_type": "all_creatures",
  "target_info": {
	"most_common_element": true
  }
}

// ãƒ‡ã‚£ã‚¶ã‚¹ã‚¿ãƒ¼ - ãƒ€ã‚¦ãƒ³ã—ãŸMHP50ä»¥ä¸Šã®å…¨ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ã®HP-30
{
  "target_type": "all_creatures",
  "target_info": {
	"is_down": true,
	"mhp_check": { "operator": ">=", "value": 50 }
  }
}

// ã‚¹ã‚¦ã‚©ãƒ¼ãƒ  - HPãŒæ¸›å°‘ã—ã¦ã„ã‚‹å…¨ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ã®HP-20
{
  "target_type": "all_creatures",
  "target_info": {
	"hp_reduced": true
  }
}

// ãƒãƒ¼ãƒ‹ãƒ³ã‚°ãƒ™ã‚¤ãƒ« - å…¨æ°´é¢¨ã®HP-20
{
  "target_type": "all_creatures",
  "target_info": {
	"creature_elements": ["water", "wind"]
  }
}

// ãƒ•ãƒªãƒ¼ã‚ºã‚µã‚¤ã‚¯ãƒ­ãƒ³ - å…¨ç«åœ°ã®HP-20
{
  "target_type": "all_creatures",
  "target_info": {
	"creature_elements": ["fire", "earth"]
  }
}
```

#### å›å¾©

```json
// ãƒªã‚¹ãƒˆã‚¢ - å¯¾è±¡ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ã®ãƒ€ã‚¦ãƒ³è§£é™¤ï¼‹HPå…¨å›å¾©
{
  "target_type": "creature",
  "target_info": {
	"owner_filter": "any"
  }
}

// ãƒ©ã‚¤ãƒ•ã‚¹ãƒˆãƒªãƒ¼ãƒ  - å…¨è‡ªã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ã®HPå…¨å›å¾©
{
  "target_type": "all_creatures",
  "target_info": {
	"owner_filter": "own"
  }
}
```

#### ç§˜è¡“

```json
// ã‚¨ãƒ«ãƒ•ã‚¢ãƒ¼ãƒãƒ£ãƒ¼ - å¯¾è±¡æ•µã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ã®HP-10
{
  "target_type": "creature",
  "target_info": {
	"owner_filter": "enemy"
  }
}

// ãƒãƒ¼ãƒ‰ãƒ­ãƒƒã‚¯ãƒ‰ãƒ©ã‚´ãƒ³ - å¯¾è±¡æ•µç«é¢¨ã®HP-20
{
  "target_type": "creature",
  "target_info": {
	"owner_filter": "enemy",
	"creature_elements": ["fire", "wind"]
  }
}

// ãƒ©ã‚¤ãƒˆãƒ‹ãƒ³ã‚°ãƒ‰ãƒ©ã‚´ãƒ³ - å¯¾è±¡æ•µæ°´åœ°ã®HP-20
{
  "target_type": "creature",
  "target_info": {
	"owner_filter": "enemy",
	"creature_elements": ["water", "earth"]
  }
}

// ã‚¢ãƒ¼ãƒãƒ¼ãƒ‰ãƒ©ã‚´ãƒ³ - å¯¾è±¡ç„¡ã®HP-30
{
  "target_type": "creature",
  "target_info": {
	"owner_filter": "enemy",
	"creature_elements": ["neutral"]
  }
}

// ãƒ‹ãƒ«ãƒ¼ãƒãƒ¼ãƒŠ - å‘ªã„ã®ã¤ã„ãŸå…¨ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ã®HP-20
{
  "target_type": "all_creatures",
  "target_info": {
	"has_curse": true
  }
}

// ãƒ’ãƒ¼ãƒ©ãƒ¼ - å¯¾è±¡è‡ªã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ã®HP30å›å¾©
{
  "target_type": "creature",
  "target_info": {
	"owner_filter": "own"
  }
}
```

### ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°å‡¦ç†ï¼ˆget_valid_targets æ‹¡å¼µï¼‰

```gdscript
# TargetSelectionHelper.get_valid_targets() ã® "creature" ã‚±ãƒ¼ã‚¹ã‚’æ‹¡å¼µ

"creature":
	for tile_index in handler.board_system.tile_nodes.keys():
		var tile_info = handler.board_system.get_tile_info(tile_index)
		var creature = tile_info.get("creature", {})
		if creature.is_empty():
			continue
		
		var tile_owner = tile_info.get("owner", -1)
		var tile_element = tile_info.get("element", "")
		
		# owner_filter ãƒã‚§ãƒƒã‚¯
		var owner_filter = target_info.get("owner_filter", "enemy")
		if owner_filter == "own" and tile_owner != handler.current_player_id:
			continue
		if owner_filter == "enemy" and (tile_owner == handler.current_player_id or tile_owner < 0):
			continue
		
		# creature_elements ãƒã‚§ãƒƒã‚¯ï¼ˆã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼å±æ€§ï¼‰
		var creature_elements = target_info.get("creature_elements", [])
		if not creature_elements.is_empty():
			var creature_element = creature.get("element", "")
			if creature_element not in creature_elements:
				continue
		
		# has_curse ãƒã‚§ãƒƒã‚¯
		if target_info.get("has_curse", false):
			var tile = handler.board_system.tile_nodes[tile_index]
			if not tile.has("curses") or tile.curses.is_empty():
				continue
		
		# has_summon_condition ãƒã‚§ãƒƒã‚¯
		if target_info.get("has_summon_condition", false):
			var cost = creature.get("cost", {})
			var has_condition = cost.has("lands_required") or cost.has("cards_sacrifice")
			if not has_condition:
				continue
		
		# hp_reduced ãƒã‚§ãƒƒã‚¯
		if target_info.get("hp_reduced", false):
			var base_hp = creature.get("hp", 0)
			var base_up_hp = creature.get("base_up_hp", 0)
			var max_hp = base_hp + base_up_hp
			var current_hp = creature.get("current_hp", max_hp)
			if current_hp >= max_hp:
				continue
		
		# is_down ãƒã‚§ãƒƒã‚¯
		if target_info.get("is_down", false):
			var tile = handler.board_system.tile_nodes[tile_index]
			if not tile.get("is_down", false):
				continue
		
		# mhp_check ãƒã‚§ãƒƒã‚¯
		var mhp_check = target_info.get("mhp_check", {})
		if not mhp_check.is_empty():
			var base_hp = creature.get("hp", 0)
			var base_up_hp = creature.get("base_up_hp", 0)
			var mhp = base_hp + base_up_hp
			var op = mhp_check.get("operator", "")
			var val = mhp_check.get("value", 0)
			match op:
				">=":
					if mhp < val: continue
				"<=":
					if mhp > val: continue
				">":
					if mhp <= val: continue
				"<":
					if mhp >= val: continue
		
		# element_mismatch ãƒã‚§ãƒƒã‚¯ï¼ˆé ˜åœ°å±æ€§ã¨ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼å±æ€§ã®ä¸ä¸€è‡´ï¼‰
		if target_info.get("element_mismatch", false):
			var creature_element = creature.get("element", "")
			if creature_element == tile_element or creature_element == "neutral":
				continue
		
		# å…¨æ¡ä»¶ã‚’æº€ãŸã—ãŸã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚’è¿½åŠ 
		targets.append({
			"type": "creature",
			"tile_index": tile_index,
			"creature": creature,
			"owner": tile_owner
		})
```

### é¸æŠæ™‚ã®å‹•ä½œ

- æ¡ä»¶ã«åˆã‚ãªã„ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ã¯ã‚¹ã‚­ãƒƒãƒ—ã•ã‚Œã‚‹ï¼ˆé¸æŠä¸å¯ï¼‰
- â†‘â†“ã‚­ãƒ¼ã§æœ‰åŠ¹ãªã‚¿ãƒ¼ã‚²ãƒƒãƒˆé–“ã‚’ç§»å‹•
- Enterã§ç¢ºå®šã€Cã§ã‚­ãƒ£ãƒ³ã‚»ãƒ«

---

## å®Ÿè£…æ–¹é‡

### æ–°è¦ã‚¯ãƒ©ã‚¹ä½œæˆ

**ãƒ•ã‚¡ã‚¤ãƒ«**: `scripts/spells/spell_damage.gd`

ç¾åœ¨ `spell_phase_handler.gd` ã«ç›´æ¥æ›¸ã‹ã‚Œã¦ã„ã‚‹ãƒ€ãƒ¡ãƒ¼ã‚¸å‡¦ç†ã‚’ã€å°‚ç”¨ã‚¯ãƒ©ã‚¹ã«åˆ†é›¢ã™ã‚‹ã€‚

```
scripts/spells/
â”œâ”€â”€ spell_damage.gd          # â˜…æ–°è¦ä½œæˆï¼ˆãƒ€ãƒ¡ãƒ¼ã‚¸ãƒ»å›å¾©å‡¦ç†ï¼‰
â”œâ”€â”€ spell_curse_battle.gd
â”œâ”€â”€ spell_mystic_arts.gd
â”œâ”€â”€ spell_draw.gd
â””â”€â”€ ...
```

### HPæ“ä½œã®æ­£ã—ã„å®Ÿè£…

#### ãƒ€ãƒ¡ãƒ¼ã‚¸å‡¦ç†

```gdscript
## ãƒ€ãƒ¡ãƒ¼ã‚¸ã‚’é©ç”¨ï¼ˆã‚¹ãƒšãƒ«ãƒ»ç§˜è¡“å…±é€šï¼‰
func apply_damage(tile: Node, value: int) -> bool:
	var creature = tile.creature_data
	if creature.is_empty():
		return false
	
	# 1. current_hp ã‚’å–å¾—ï¼ˆå­˜åœ¨ã—ãªã„å ´åˆã¯MHPï¼‰
	var base_hp = creature.get("hp", 0)
	var base_up_hp = creature.get("base_up_hp", 0)
	var max_hp = base_hp + base_up_hp
	var current_hp = creature.get("current_hp", max_hp)
	
	# 2. ãƒ€ãƒ¡ãƒ¼ã‚¸é©ç”¨
	var new_hp = max(0, current_hp - value)
	creature["current_hp"] = new_hp
	
	print("[SpellDamage] %s ã« %d ãƒ€ãƒ¡ãƒ¼ã‚¸ (HP: %d â†’ %d)" % [
		creature.get("name", "Unknown"), value, current_hp, new_hp
	])
	
	# 3. æ’ƒç ´åˆ¤å®š
	if new_hp <= 0:
		_destroy_creature(tile)
	
	return true


## ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ç ´å£Šï¼ˆãƒ¬ãƒ™ãƒ«ç¶­æŒï¼‰
func _destroy_creature(tile: Node) -> void:
	var creature_name = tile.creature_data.get("name", "Unknown")
	var saved_level = tile.level  # â˜…ãƒ¬ãƒ™ãƒ«ä¿å­˜
	
	tile.creature_data = {}
	tile.owner_id = -1
	tile.level = saved_level      # â˜…ãƒ¬ãƒ™ãƒ«ç¶­æŒï¼ˆç©ºãåœ°ã¨ã—ã¦æ®‹ã‚‹ï¼‰
	tile.update_visual()
	
	print("[SpellDamage] ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼æ’ƒç ´: %s (åœŸåœ°ãƒ¬ãƒ™ãƒ« %d ç¶­æŒ)" % [
		creature_name, saved_level
	])
```

#### å›å¾©å‡¦ç†

```gdscript
## HPå›å¾©ã‚’é©ç”¨
func apply_heal(tile: Node, value: int) -> bool:
	var creature = tile.creature_data
	if creature.is_empty():
		return false
	
	# 1. MHPè¨ˆç®—
	var base_hp = creature.get("hp", 0)
	var base_up_hp = creature.get("base_up_hp", 0)
	var max_hp = base_hp + base_up_hp
	var current_hp = creature.get("current_hp", max_hp)
	
	# 2. å›å¾©é©ç”¨ï¼ˆMHPã‚’è¶…ãˆãªã„ï¼‰
	var new_hp = min(current_hp + value, max_hp)
	creature["current_hp"] = new_hp
	
	print("[SpellDamage] %s ã‚’ %d å›å¾© (HP: %d â†’ %d / MHP: %d)" % [
		creature.get("name", "Unknown"), value, current_hp, new_hp, max_hp
	])
	
	return true


## HPå…¨å›å¾©
func apply_full_heal(tile: Node) -> bool:
	var creature = tile.creature_data
	if creature.is_empty():
		return false
	
	var base_hp = creature.get("hp", 0)
	var base_up_hp = creature.get("base_up_hp", 0)
	var max_hp = base_hp + base_up_hp
	var current_hp = creature.get("current_hp", max_hp)
	
	creature["current_hp"] = max_hp
	
	print("[SpellDamage] %s HPå…¨å›å¾© (HP: %d â†’ %d)" % [
		creature.get("name", "Unknown"), current_hp, max_hp
	])
	
	return true
```

### é‡è¦ãƒã‚¤ãƒ³ãƒˆ

| é …ç›® | æ­£ã—ã„æ–¹æ³• | é–“é•ã„ |
|------|-----------|--------|
| HPå–å¾— | `creature.get("current_hp", max_hp)` | `creature.get("hp", 0)` |
| HPä¿å­˜ | `creature["current_hp"] = new_hp` | `creature["hp"] = new_hp` |
| æ’ƒç ´æ™‚ãƒ¬ãƒ™ãƒ« | **ç¶­æŒ**ï¼ˆç©ºãåœ°ã¨ã—ã¦æ®‹ã‚‹ï¼‰ | ãƒªã‚»ãƒƒãƒˆï¼ˆ`level = 1`ï¼‰ |
| å›å¾©ä¸Šé™ | MHPï¼ˆ`hp + base_up_hp`ï¼‰ | ç„¡åˆ¶é™ |

### å®Ÿè£…å®Œäº†äº‹é …

- âœ… `spell_damage.gd` ã§çµ±ä¸€çš„ã«ãƒ€ãƒ¡ãƒ¼ã‚¸ãƒ»å›å¾©å‡¦ç†ã‚’å®Ÿè£…
- âœ… `spell_phase_handler._apply_damage_effect` â†’ `spell_damage.apply_damage()` ã‚’å‘¼ã³å‡ºã—
- âœ… `spell_mystic_arts._apply_damage` â†’ `spell_damage.apply_damage()` ã‚’å‘¼ã³å‡ºã—
- âœ… æ’ƒç ´æ™‚ã¯ `tile.remove_creature()` ã§3Dè¡¨ç¤ºã‚‚å‰Šé™¤
- âœ… é€šçŸ¥UIã¯ã‚¯ãƒªãƒƒã‚¯å¾…ã¡ï¼ˆ7ç§’ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆä»˜ãï¼‰

---

## é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«

```
scripts/spells/spell_damage.gd            # â˜…æ–°è¦ä½œæˆï¼ˆãƒ€ãƒ¡ãƒ¼ã‚¸ãƒ»å›å¾©å‡¦ç†ï¼‰
scripts/game_flow/spell_phase_handler.gd  # spell_damage ã‚’å‘¼ã³å‡ºã™
scripts/spells/spell_curse_battle.gd      # apply_to_all_creatures()
scripts/spells/spell_mystic_arts.gd       # spell_damage ã‚’å‘¼ã³å‡ºã™
data/spell_2.json                         # ã‚¹ãƒšãƒ«å®šç¾©
docs/design/hp_structure.md               # HPç®¡ç†ä»•æ§˜
```

---

## å®Ÿè£…äºˆå®šé †åº

### Phase 1: å˜ä½“ãƒ€ãƒ¡ãƒ¼ã‚¸åŸºæœ¬
1. [x] ãƒã‚¸ãƒƒã‚¯ãƒœãƒ«ãƒˆ (2106) - æœ€ã‚‚ã‚·ãƒ³ãƒ—ãƒ« âœ…
2. [x] ã‚·ãƒ£ã‚¤ãƒ‹ãƒ³ã‚°ã‚¬ã‚¤ã‚¶ãƒ¼ (2033) - é€šå¸¸åŠ¹æœã®ã¿ âœ…

### Phase 2: æ¡ä»¶ä»˜ãå˜ä½“
3. [x] ã‚¹ãƒˆãƒ¼ãƒ³ãƒ–ãƒ©ã‚¹ãƒˆ (2041) - å±æ€§é™å®šï¼ˆåœ°/é¢¨ï¼‰ âœ…
4. [x] ãƒ–ãƒ¬ã‚¤ã‚ºã‚¹ãƒ—ãƒ©ãƒƒã‚·ãƒ¥ (2088) - å±æ€§é™å®šï¼ˆç«/æ°´ï¼‰ âœ…
5. [x] ã‚µãƒ³ãƒ€ãƒ¼ã‚¯ãƒ©ãƒƒãƒ— (2031) - å¯†å‘½ï¼‹å¬å–šæ¡ä»¶åˆ¤å®š âœ…

### Phase 3: å…¨ä½“ãƒ€ãƒ¡ãƒ¼ã‚¸
6. [x] ãƒãƒ¼ãƒ‹ãƒ³ã‚°ãƒ™ã‚¤ãƒ« (2065) - å±æ€§ãƒ•ã‚£ãƒ«ã‚¿ï¼ˆæ°´/é¢¨ï¼‰ âœ…
7. [x] ãƒ•ãƒªãƒ¼ã‚ºã‚µã‚¤ã‚¯ãƒ­ãƒ³ (2086) - å±æ€§ãƒ•ã‚£ãƒ«ã‚¿ï¼ˆç«/åœ°ï¼‰ âœ…
8. [x] ã‚¹ã‚¦ã‚©ãƒ¼ãƒ  (2037) - HPæ¸›å°‘åˆ¤å®š âœ…
9. [x] ã‚¨ãƒ¬ãƒ¡ãƒ³ã‚¿ãƒ«ãƒ©ã‚¹ (2016) - å±æ€§ä¸ä¸€è‡´åˆ¤å®š âœ…
10. [x] ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ãƒãƒ¼ã‚¹ãƒˆ (2023) - æœ€å¤šå±æ€§åˆ¤å®š âœ…
11. [x] ãƒ‡ã‚£ã‚¶ã‚¹ã‚¿ãƒ¼ (2053) - ãƒ€ã‚¦ãƒ³ï¼‹MHPåˆ¤å®š âœ…

---

### Phase 4: å›å¾©
12. [ ] ãƒªã‚¹ãƒˆã‚¢ (2121) - ãƒ€ã‚¦ãƒ³è§£é™¤ï¼‹HPå…¨å›å¾©
13. [ ] ãƒ©ã‚¤ãƒ•ã‚¹ãƒˆãƒªãƒ¼ãƒ  (2116) - å…¨è‡ªã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼HPå…¨å›å¾©

### Phase 5: ç§˜è¡“
14. [ ] ã‚¨ãƒ«ãƒ•ã‚¢ãƒ¼ãƒãƒ£ãƒ¼ (304) - å¯¾è±¡æ•µHP-10
15. [ ] ãƒãƒ¼ãƒ‰ãƒ­ãƒƒã‚¯ãƒ‰ãƒ©ã‚´ãƒ³ (231) - å¯¾è±¡æ•µç«é¢¨HP-20
16. [ ] ãƒ©ã‚¤ãƒˆãƒ‹ãƒ³ã‚°ãƒ‰ãƒ©ã‚´ãƒ³ (344) - å¯¾è±¡æ•µæ°´åœ°HP-20
17. [ ] ã‚¢ãƒ¼ãƒãƒ¼ãƒ‰ãƒ©ã‚´ãƒ³ (404) - å¯¾è±¡ç„¡HP-30
18. [ ] ãƒ‹ãƒ«ãƒ¼ãƒãƒ¼ãƒŠ (428) - å‘ªã„ä»˜ãå…¨ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼HP-20
19. [ ] ãƒ’ãƒ¼ãƒ©ãƒ¼ (233) - å¯¾è±¡è‡ªHP30å›å¾©

---

## å¤‰æ›´å±¥æ­´

| æ—¥ä»˜ | å†…å®¹ |
|------|------|
| 2025/11/27 | åˆç‰ˆä½œæˆ |
| 2025/11/27 | å®Ÿè£…æ–¹é‡è¿½åŠ ï¼ˆspell_damage.gdæ–°è¦ä½œæˆã€HPæ“ä½œã®æ­£ã—ã„å®Ÿè£…ã€ãƒ¬ãƒ™ãƒ«ç¶­æŒï¼‰ |
| 2025/11/27 | å›å¾©ã‚¹ãƒšãƒ«ãƒ»ç§˜è¡“è¿½åŠ ï¼ˆãƒªã‚¹ãƒˆã‚¢ã€ãƒ©ã‚¤ãƒ•ã‚¹ãƒˆãƒªãƒ¼ãƒ ã€ãƒ’ãƒ¼ãƒ©ãƒ¼ï¼‰ |
| 2025/11/27 | ã‚¿ãƒ¼ã‚²ãƒƒãƒˆé¸æŠã‚·ã‚¹ãƒ†ãƒ è¿½åŠ ï¼ˆtarget_infoæ‹¡å¼µãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã€ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°å‡¦ç†ï¼‰ |
| 2025/11/27 | æ¼”å‡ºãƒ•ãƒ­ãƒ¼è¿½åŠ ï¼ˆãƒ€ãƒ¡ãƒ¼ã‚¸/å›å¾©é€šçŸ¥ã€ã‚¯ãƒªãƒƒã‚¯å¾…ã¡ã€HPè¡¨ç¤ºãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼‰ |
| 2025/11/27 | Phase 1å®Œäº†ï¼ˆãƒã‚¸ãƒƒã‚¯ãƒœãƒ«ãƒˆã€ã‚·ãƒ£ã‚¤ãƒ‹ãƒ³ã‚°ã‚¬ã‚¤ã‚¶ãƒ¼å®Ÿè£…ï¼‰ã€ã‚¯ãƒªãƒƒã‚¯å¾…ã¡7ç§’ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¿½åŠ  |
| 2025/11/27 | Phase 2å®Œäº†ï¼ˆã‚¹ãƒˆãƒ¼ãƒ³ãƒ–ãƒ©ã‚¹ãƒˆã€ãƒ–ãƒ¬ã‚¤ã‚ºã‚¹ãƒ—ãƒ©ãƒƒã‚·ãƒ¥ã€ã‚µãƒ³ãƒ€ãƒ¼ã‚¯ãƒ©ãƒƒãƒ—å®Ÿè£…ï¼‰ |
| 2025/11/27 | Phase 3å®Œäº†ï¼ˆå…¨ä½“ãƒ€ãƒ¡ãƒ¼ã‚¸6ç¨®å®Ÿè£…ã€most_common_elementãƒ•ã‚£ãƒ«ã‚¿è¿½åŠ ï¼‰ |
