# é€šè¡Œæ–™å‘ªã„ã‚¹ãƒšãƒ«è¨­è¨ˆ

**æœ€çµ‚æ›´æ–°**: 2025å¹´11æœˆ13æ—¥ | **å®Ÿè£…çŠ¶æ³**: ğŸš§ è¨­è¨ˆä¸­

---

## æ¦‚è¦

ã‚»ãƒ—ã‚¿ãƒ¼ã«å¯¾ã—ã¦é€šè¡Œæ–™ã«é–¢é€£ã™ã‚‹å‘ªã„ã‚’ä»˜ä¸ã™ã‚‹ã‚¹ãƒšãƒ«ã€‚  
ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚·ã‚¹ãƒ†ãƒ ã«ç›´æ¥ä½œç”¨ã™ã‚‹å‘ªã„ã€‚

**ç‰¹å¾´**:
- ã‚»ãƒ—ã‚¿ãƒ¼ï¼ˆãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼‰ã‚’å¯¾è±¡
- é€šè¡Œæ–™ã®ç²å¾—ãƒ»å–ªå¤±ãƒ»å¤‰å‹•ã«å½±éŸ¿
- æ•°ã‚¿ãƒ¼ãƒ³æŒç¶š
- durationç®¡ç†ã§è‡ªå‹•å‰Šé™¤

---

## å®Ÿè£…ã‚¹ãƒšãƒ«ä¸€è¦§

| ID | åå‰ | ã‚³ã‚¹ãƒˆ | åŠ¹æœ | å¯¾è±¡ | æœŸé–“ |
|----|------|--------|------|------|------|
| 2061 | ãƒ‰ãƒªãƒ¼ãƒ ãƒˆãƒ¬ã‚¤ãƒ³ | 40MP | ä»–ã®ã‚»ãƒ—ã‚¿ãƒ¼ã®é€šè¡Œæ–™50%ã‚’ç²å¾— | ä½¿ç”¨è€… | 5T |
| 2084 | ãƒ–ãƒ©ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ | 40MP | é€šè¡Œæ–™ã‚’å–ã‚Œãªã„ | æ•µã‚»ãƒ—ã‚¿ãƒ¼ | 2T |
| 2115 | ãƒ¦ãƒ‹ãƒ•ã‚©ãƒ¼ãƒŸãƒ†ã‚£ | 60MP | é€šè¡Œæ–™ã‚’200Gã«å›ºå®š | æ•µã‚»ãƒ—ã‚¿ãƒ¼ | 3T |

---

## å‘ªã„ã‚¿ã‚¤ãƒ—è©³ç´°

### toll_shareï¼ˆé€šè¡Œæ–™å…±æœ‰ï¼‰

**ã‚¹ãƒšãƒ«**: ãƒ‰ãƒªãƒ¼ãƒ ãƒˆãƒ¬ã‚¤ãƒ³ (ID: 2061)

**åŠ¹æœ**: ä»–ã®ã‚»ãƒ—ã‚¿ãƒ¼ãŒå¾—ãŸé€šè¡Œæ–™ã®50%ã‚’ç²å¾—

**ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**:
- `ratio`: ç²å¾—ç‡ï¼ˆä¾‹: 0.5 = 50%ï¼‰
- `duration`: ã‚¿ãƒ¼ãƒ³æ•°ï¼ˆ5ï¼‰

---

### toll_disableï¼ˆé€šè¡Œæ–™ç„¡åŠ¹ï¼‰

**ã‚¹ãƒšãƒ«**: ãƒ–ãƒ©ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ (ID: 2084)

**åŠ¹æœ**: é€šè¡Œæ–™ã‚’å–ã‚Œãªã„

**ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**:
- `duration`: ã‚¿ãƒ¼ãƒ³æ•°ï¼ˆ2ï¼‰

---

### toll_fixedï¼ˆé€šè¡Œæ–™å›ºå®šï¼‰

**ã‚¹ãƒšãƒ«**: ãƒ¦ãƒ‹ãƒ•ã‚©ãƒ¼ãƒŸãƒ†ã‚£ (ID: 2115)

**åŠ¹æœ**: é€šè¡Œæ–™ã‚’å›ºå®šå€¤ã«è¨­å®š

**ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**:
- `value`: å›ºå®šå€¤ï¼ˆ200Gï¼‰
- `duration`: ã‚¿ãƒ¼ãƒ³æ•°ï¼ˆ3ï¼‰

---

## å¯¾è±¡ã¨é©ç”¨

### ã‚»ãƒ—ã‚¿ãƒ¼å‘ªã„ã®ç‰¹æ€§

| å‘ªã„ã‚¿ã‚¤ãƒ— | å¯¾è±¡ | ä¿å­˜å ´æ‰€ | å‰Šé™¤æ¡ä»¶ |
|-----------|------|---------|---------|
| toll_share | ä½¿ç”¨è€… | `player.curse` | ã‚¿ãƒ¼ãƒ³çµ‚äº†æ™‚ï¼ˆduration=0ï¼‰ |
| toll_disable | æ•µ | `player.curse` | ã‚¿ãƒ¼ãƒ³çµ‚äº†æ™‚ï¼ˆduration=0ï¼‰ |
| toll_fixed | æ•µ | `player.curse` | ã‚¿ãƒ¼ãƒ³çµ‚äº†æ™‚ï¼ˆduration=0ï¼‰ |

---

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### ã‚¯ãƒ©ã‚¹æ§‹æˆ

**SpellCurse** (`spell_curse.gd`):
- `curse_player()` - ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«å‘ªã„ã‚’ä»˜ä¸
- `get_player_curse()` - ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å‘ªã„ã‚’å–å¾—
- `remove_curse_from_player()` - ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å‘ªã„ã‚’å‰Šé™¤
- `update_player_curse()` - ã‚¿ãƒ¼ãƒ³çµ‚äº†æ™‚ã®å‡¦ç†

**SpellToll** (`scripts/spells/spell_toll.gd`):
- é€šè¡Œæ–™å‘ªã„ã®å®Ÿè£…
- SpellCurseã‚’ä½¿ç”¨ã—ã¦å‘ªã„ã‚’ä»˜ä¸

**MovementController**:
- ã‚¹ã‚¿ãƒ¼ãƒˆé€šéæ™‚ã«é€šè¡Œæ–™ã®è¨ˆç®—ãƒ»ä»˜ä¸
- å‘ªã„ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦åŠ¹æœã‚’åæ˜ 

---

## å®Ÿè£…ãƒ•ãƒ­ãƒ¼

### ã‚¹ãƒšãƒ«ä½¿ç”¨æ™‚

```
SpellPhaseHandler._apply_single_effect()
  â†“
SpellToll.apply_toll_curse(player_id, curse_type, effect)
  â†“
SpellCurse.curse_player(player_id, curse_type, duration, params)
  â†“
player.curse = {
  "curse_type": "toll_share",
  "name": "é€šè¡Œæ–™ä¿ƒé€²",
  "duration": 5,
  "params": {"ratio": 0.5}
}
```

### ã‚¹ã‚¿ãƒ¼ãƒˆé€šéæ™‚ï¼ˆå‘ªã„åˆ¤å®šï¼‰

```
MovementController.handle_start_pass()
  â†“
é€šè¡Œæ–™è¨ˆç®—
  â†“
// å‘ªã„ã‚’ãƒã‚§ãƒƒã‚¯
if player.curse.get("curse_type") == "toll_disable":
  é€šè¡Œæ–™ = 0
elif player.curse.get("curse_type") == "toll_fixed":
  é€šè¡Œæ–™ = params.get("value")
else:
  é€šè¡Œæ–™ = é€šå¸¸ã®è¨ˆç®—
  â†“
// ä»–ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‹ã‚‰å¾´å
for other_player in players:
  if other_player.curse.get("curse_type") == "toll_share":
	other_player.add_gold(toll_amount * ratio)
```

---

## ã‚¹ãƒšãƒ«JSONè¨­è¨ˆ

### ãƒ‰ãƒªãƒ¼ãƒ ãƒˆãƒ¬ã‚¤ãƒ³ï¼ˆID: 2061ï¼‰

```json
{
  "id": 2061,
  "name": "ãƒ‰ãƒªãƒ¼ãƒ ãƒˆãƒ¬ã‚¤ãƒ³",
  "cost": {"mp": 40},
  "effect_parsed": {
	"target_type": "player",
	"target_filter": "self",
	"effects": [
	  {
		"effect_type": "toll_share",
		"name": "é€šè¡Œæ–™ä¿ƒé€²",
		"ratio": 0.5,
		"duration": 5
	  }
	]
  }
}
```

### ãƒ–ãƒ©ãƒƒã‚¯ã‚¢ã‚¦ãƒˆï¼ˆID: 2084ï¼‰

```json
{
  "id": 2084,
  "name": "ãƒ–ãƒ©ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ",
  "cost": {"mp": 40},
  "effect_parsed": {
	"target_type": "player",
	"target_filter": "enemy",
	"effects": [
	  {
		"effect_type": "toll_disable",
		"name": "é€šè¡Œæ–™ç„¡åŠ¹",
		"duration": 2
	  }
	]
  }
}
```

### ãƒ¦ãƒ‹ãƒ•ã‚©ãƒ¼ãƒŸãƒ†ã‚£ï¼ˆID: 2115ï¼‰

```json
{
  "id": 2115,
  "name": "ãƒ¦ãƒ‹ãƒ•ã‚©ãƒ¼ãƒŸãƒ†ã‚£",
  "cost": {"mp": 60},
  "effect_parsed": {
	"target_type": "player",
	"target_filter": "enemy",
	"effects": [
	  {
		"effect_type": "toll_fixed",
		"name": "é€šè¡Œæ–™200",
		"value": 200,
		"duration": 3
	  }
	]
  }
}
```

---

## å®Ÿè£…ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### Phase 1: SpellTollåŸºç›¤
- [ ] `scripts/spells/spell_toll.gd` ä½œæˆ
- [ ] `apply_toll_share()` å®Ÿè£…
- [ ] `apply_toll_disable()` å®Ÿè£…
- [ ] `apply_toll_fixed()` å®Ÿè£…

### Phase 2: SpellPhaseHandlerçµ±åˆ
- [ ] `_apply_single_effect()` ã« toll_* å‡¦ç†è¿½åŠ 
- [ ] ã‚¿ãƒ¼ã‚²ãƒƒãƒˆé¸æŠï¼ˆself/enemyï¼‰

### Phase 3: MovementControllerçµ±åˆ
- [ ] `handle_start_pass()` ã§å‘ªã„ãƒã‚§ãƒƒã‚¯
- [ ] é€šè¡Œæ–™è¨ˆç®—ã«åæ˜ 
- [ ] toll_share ã®é…åˆ†å‡¦ç†

### Phase 4: ãƒ†ã‚¹ãƒˆ
- [ ] ãƒ‰ãƒªãƒ¼ãƒ ãƒˆãƒ¬ã‚¤ãƒ³ - é€šè¡Œæ–™50%ç²å¾—ç¢ºèª
- [ ] ãƒ–ãƒ©ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ - é€šè¡Œæ–™0ç¢ºèª
- [ ] ãƒ¦ãƒ‹ãƒ•ã‚©ãƒ¼ãƒŸãƒ†ã‚£ - é€šè¡Œæ–™200å›ºå®šç¢ºèª

---

## å¤‰æ›´å±¥æ­´

| æ—¥ä»˜ | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | å¤‰æ›´å†…å®¹ |
|------|-----------|---------|
| 2025/11/13 | 1.0 | åˆç‰ˆä½œæˆ - 3ã¤ã®ã‚»ãƒ—ã‚¿ãƒ¼å‘ªã„ã‚¹ãƒšãƒ«ã®åŸºæœ¬è¨­è¨ˆ |

---

**ä½œæˆæ—¥**: 2025å¹´11æœˆ13æ—¥
