# CPU ドミニオオーダー AI 仕様書

## 概要

CPUのドミニオオーダー判断。利益スコアを計算し、最も有利な行動を選択。

**ファイル**: `scripts/cpu_ai/cpu_territory_ai.gd`

---

## 判断フロー

```
止まったタイル
│
├─ 空き地
│   ├─ 属性一致クリーチャーあり → 召喚（スコア290）
│   ├─ 手札6枚以上 → 召喚して手札削減
│   └─ それ以外 → ドミニオオーダー検討
│
├─ 敵ドミニオ
│   ├─ 倒せる → 侵略スコア vs ドミニオオーダースコア比較
│   ├─ 倒せない & 危機モード → レベルアップ最優先
│   └─ 倒せない → ドミニオオーダー検討
│
└─ 自ドミニオ/特殊 → ドミニオオーダー検討
```

---

## 利益スコア計算

### 基準スコア

| 行動 | スコア |
|------|--------|
| 空き地に属性一致召喚 | 290 |
| 空き地に属性不一致召喚 | 100 |

### 侵略（敵ドミニオで戦闘）

```
score = (敵土地レベル × 連鎖ボーナス × 100 + 属性一致ボーナス50) × 2
```

### 移動侵略（敵地を奪う）

```
score = 敵土地レベル × 連鎖ボーナス × 100 + 属性一致ボーナス50
```

### 移動侵略（空き地に移動）

```
score = 属性一致ボーナス150 + 連鎖数 × 50
```

### レベルアップ

```
score = 手持ちEPで上げられる分の合計コスト
```

**条件**: 土地とクリーチャーの属性が一致していること

### クリーチャー交換

```
score = (新コスト - 現コスト) × 2 + 属性ボーナス + 土地レベル × 20
```

- 属性一致になる: +150
- 属性不一致になる: -500

### 属性変更

```
score = 100 + 無属性ボーナス100 - コスト × 0.3
```

**優先度最低**（他の方法で解決できない場合のみ）

---

## 危機モード

### 発動条件

```
通行料支払い後の残りEP < 100G
```

### 行動

最大連鎖数の属性の土地を、可能な最大レベルまでレベルアップ。

**スコア: 9999（最優先）**

---

## 共通ルール

### EP温存

レベルアップ・属性変更ではEPを全て使い切らない：

```
使用可能EP = 手持ちEP - max(手持ちEP × 0.3, 100)
```

**危機モードは例外（全EP使用可能）**

### 移動侵略の制約

以下の土地からは移動不可：
- レベル2以上
- 属性一致済み

### ダウン状態

- ダウン中クリーチャーはドミニオオーダー対象外
- 全クリーチャーダウン → ドミニオオーダー不可
